#define _DEFAULT_SOURCE
#include "fd_bn254.h"
#include "../../util/fd_util.h"

int main( int     argc,
          char ** argv ) {
  fd_boot( &argc, &argv );

  static const fd_bn254_point_g1_t g1 = { .v={
    45, 206, 255, 166, 152, 55, 128, 138, 79, 217, 145, 164, 25, 74, 120, 234, 234, 217,
    68, 149, 162, 44, 133, 120, 184, 205, 12, 44, 175, 98, 168, 172, 20, 24, 216, 15, 209,
    175, 106, 75, 147, 236, 90, 101, 123, 219, 245, 151, 209, 202, 218, 104, 148, 8, 32,
    254, 243, 191, 218, 122, 42, 81, 193, 84
  } };

  FD_TEST(fd_bn254_g1_check(&g1));
  
  fd_bn254_point_g1_compressed_t g1c;
  fd_bn254_g1_compress(&g1, &g1c);
  FD_TEST(memcmp(g1.v, g1c.v, sizeof(g1c)) == 0);

  fd_bn254_point_g1_t g1_2;
  fd_bn254_g1_decompress(&g1c, &g1_2);
  FD_TEST(memcmp(g1.v, g1_2.v, sizeof(g1)) == 0);
    
  static const fd_bn254_point_g2_t g2 = { .v={
      40, 57, 233, 205, 180, 46, 35, 111, 215, 5, 23, 93, 12, 71, 118, 225, 7, 46, 247, 147,
      47, 130, 106, 189, 184, 80, 146, 103, 141, 52, 242, 25, 0, 203, 124, 176, 110, 34, 151,
      212, 66, 180, 238, 151, 236, 189, 133, 209, 17, 137, 205, 183, 168, 196, 92, 159, 75,
      174, 81, 168, 18, 86, 176, 56, 16, 26, 210, 20, 18, 81, 122, 142, 104, 62, 251, 169,
      98, 141, 21, 253, 50, 130, 182, 15, 33, 109, 228, 31, 79, 183, 88, 147, 174, 108, 4,
      22, 14, 129, 168, 6, 80, 246, 254, 100, 218, 131, 94, 49, 247, 211, 3, 245, 22, 200,
      177, 91, 60, 144, 147, 174, 90, 17, 19, 189, 62, 147, 152, 18,
  } };

  FD_TEST(fd_bn254_g2_check(&g2));
  
  fd_bn254_point_g2_compressed_t g2c;
  fd_bn254_g2_compress(&g2, &g2c);
  FD_TEST(memcmp(g2.v, g2c.v, sizeof(g2c)) == 0);

  fd_bn254_point_g2_t g2_2;
  fd_bn254_g2_decompress(&g2c, &g2_2);
  FD_TEST(memcmp(g2.v, g2_2.v, sizeof(g2)) == 0);

  {
    static const fd_bn254_point_g1_t x = { .v={ 24, 177, 138, 207,
        180, 194, 195, 2, 118, 219, 84, 17, 54, 142, 113, 133, 179,
        17, 221, 18, 70, 145, 97, 12, 93, 59, 116, 3, 78, 9, 61, 201,
        6, 60, 144, 156, 71, 32, 132, 12, 181, 19, 76, 185, 245, 159,
        167, 73, 117, 87, 150, 129, 150, 88, 211, 46, 252, 13, 40,
        129, 152, 243, 114, 102 } };
    static const fd_bn254_point_g1_t y = { .v={ 7, 194, 183, 245, 138,
        132, 189, 97, 69, 240, 12, 156, 43, 192, 187, 26, 24, 127, 32,
        255, 44, 146, 150, 58, 136, 1, 158, 124, 106, 1, 78, 237, 6,
        97, 78, 32, 193, 71, 233, 64, 242, 215, 13, 163, 247, 76, 154,
        23, 223, 54, 23, 6, 164, 72, 92, 116, 43, 214, 120, 132, 120,
        250, 23, 215 } };
    static const fd_bn254_point_g1_t z = { .v={ 34, 67, 82, 92, 94,
        253, 75, 156, 61, 60, 69, 172, 12, 163, 254, 77, 216, 94, 131, 10,
        76, 230, 182, 95, 161, 238, 174, 226, 2, 131, 151, 3, 48, 29, 29,
        51, 190, 109, 168, 229, 9, 223, 33, 204, 53, 150, 71, 35, 24, 14,
        237, 117, 50, 83, 125, 185, 174, 94, 125, 72, 241, 149, 201, 21 } };
    fd_bn254_point_g1_t z2;
    fd_bn254_g1_add(&x, &y, &z2);
    FD_TEST(memcmp(z.v, z2.v, sizeof(z)) == 0);
  }
    
  {
    static const fd_bn254_point_g1_t x = { .v={ 7, 10, 141, 106, 152,
        33, 83, 202, 228, 190, 41, 212, 52, 232, 250, 239, 138, 71, 178,
        116, 160, 83, 245, 164, 238, 42, 108, 156, 19, 195, 30, 92, 3, 27,
        140, 233, 20, 235, 163, 169, 255, 185, 137, 249, 205, 213, 176,
        240, 25, 67, 7, 75, 244, 240, 243, 21, 105, 14, 195, 206, 198,
        152, 26, 252 } };
    static const fd_bn254_bigint_t y = { .v={ 48, 100, 78, 114, 225,
        49, 160, 41, 184, 80, 69, 182, 129, 129, 88, 93, 151, 129, 106,
        145, 104, 113, 202, 141, 60, 32, 140, 22, 216, 124, 253, 70 } };
    static const fd_bn254_point_g1_t z = { .v={ 2, 90, 111, 65, 129,
        210, 180, 234, 139, 114, 66, 144, 255, 180, 1, 86, 235, 10, 219,
        81, 76, 104, 133, 86, 235, 121, 205, 234, 7, 82, 194, 187, 46,
        255, 63, 49, 222, 162, 21, 241, 235, 134, 2, 58, 19, 58, 153, 110,
        182, 48, 11, 68, 218, 102, 77, 100, 37, 29, 5, 56, 27, 184, 160,
        46 } };
    fd_bn254_point_g1_t z2;
    fd_bn254_g1_mult(&x, &y, &z2);
    FD_TEST(memcmp(z.v, z2.v, sizeof(z)) == 0);
  }
    
  FD_LOG_NOTICE(( "pass" ));
  fd_halt();
  return 0;
}
