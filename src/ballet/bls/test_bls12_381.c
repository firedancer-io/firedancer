#include "../fd_ballet.h"
#include "fd_bls12_381.h"
#include "../hex/fd_hex.h"

void
log_bench( char const * descr,
           ulong        iter,
           long         dt ) {
  float khz = 1e6f *(float)iter/(float)dt;
  float tau = (float)dt /(float)iter;
  FD_LOG_NOTICE(( "%-34s %10.3fK/s/core %12.3f ns/call", descr, (double)khz, (double)tau ));
}

static void
test_g1_val( FD_FN_UNUSED fd_rng_t * rng ) {
  // test correctness
  //
  uchar in[96] = { 0 };
  uchar * r = in;

  {
    const char * tests[] = {
      // test 0
      "16a3fa43c5a867c98021aa604a282d5a69b5f47c806b1b8e9e60002e901b3dcd41268da5377172172469fc7393100c270b1335d76b805e44162e4ab3ece8dc1e30a9551046701a254968cbbd2a608d5aa7293d52b8505d70cc8ce1f56782b8c2",
      "ok",
      // test 1
      "400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      "ok",
      // test 2
      "17f1d3a73197d7942695638c4fa9ac0fc3688c4f9774b905a14e3a3f171bac586c55e83ff97a1aeffb3af00adb22c6bb08b3f481e3aaa0f1a09e30ed741d8ae4fcf5e095d5d00af600db18cb2c04b3edd03cc744a2888ae40caa232946c5e7e1",
      "ok",
      // test 3
      "16a3fa43c5a867c98021aa604a282d5a69b5f47c806b1b8e9e60002e901b3dcd41268da5377172172469fc7393100c270b1335d76b805e44162e4ab3ece8dc1e30a9551046701a254968cbbd2a608d5aa7293d52b8505d70cc8ce1f56782b8c7",
      "",
      // test 4
      "1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaaab08b3f481e3aaa0f1a09e30ed741d8ae4fcf5e095d5d00af600db18cb2c04b3edd03cc744a2888ae40caa232946c5e7e1",
      "",
    };

    for( ulong i=0; i<sizeof(tests)/8/2; i++ ) {
      ulong in_sz = strlen( tests[2*i] ) / 2;

      fd_hex_decode( in, tests[2*i], in_sz );

      if( strlen( tests[2*i+1] )==0 ) {
        FD_TEST( fd_bls12_381_g1_validate_syscall( r, 1 /*BE*/ )==-1 );
        continue;
      }
      FD_TEST( fd_bls12_381_g1_validate_syscall( r, 1 /*BE*/ )==0 );
    }
  }
  {
    const char * tests[] = {
      // test 1
      "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      "ok",
      // test 2
      "bbc622db0af03afbef1a7af93fe8556c58ac1b173f3a4ea105b974974f8c68c30faca94f8c63952694d79731a7d3f117e1e7c5462923aa0ce48a88a244c73cd0edb3042ccb18db00f60ad0d595e0f5fce48a1d74ed309ea0f1a0aae381f4b308",
      "ok",
      // test 3
      "270c109373fc692417727137a58d2641cd3d1b902e00609e8e1b6b807cf4b5695a2d284a60aa2180c967a8c543faa316c7b88267f5e18ccc705d50b8523d29a75a8d602abdcb6849251a70461055a9301edce8ecb34a2e16445e806bd735130b",
      "",
      // test 4
      "abaafffffffffeb9ffff53b1feffab1e24f6b0f6a0d23067bf1285f3844b7764d7ac4b43b6a71b4b9ae67f39ea11011ae1e7c5462923aa0ce48a88a244c73cd0edb3042ccb18db00f60ad0d595e0f5fce48a1d74ed309ea0f1a0aae381f4b308",
      "",
      // test 0
      "270c109373fc692417727137a58d2641cd3d1b902e00609e8e1b6b807cf4b5695a2d284a60aa2180c967a8c543faa316c2b88267f5e18ccc705d50b8523d29a75a8d602abdcb6849251a70461055a9301edce8ecb34a2e16445e806bd735130b",
      "ok",
    };

    for( ulong i=0; i<sizeof(tests)/8/2; i++ ) {
      ulong in_sz = strlen( tests[2*i] ) / 2;

      fd_hex_decode( in, tests[2*i], in_sz );

      if( strlen( tests[2*i+1] )==0 ) {
        FD_TEST( fd_bls12_381_g1_validate_syscall( r, 0 /*LE*/ )==-1 );
        continue;
      }
      FD_TEST( fd_bls12_381_g1_validate_syscall( r, 0 /*LE*/ )==0 );
    }
  }
  {
    ulong iter = 1000UL;
    long dt = fd_log_wallclock();
    for( ulong rem=iter; rem; rem-- ) {
      fd_bls12_381_g1_validate_syscall( r, 0 /*LE*/ );
    }
    dt = fd_log_wallclock() - dt;
    log_bench( "fd_bls12_381_g1_validate_syscall", iter, dt );
  }
}

static void
test_g1_dec( FD_FN_UNUSED fd_rng_t * rng ) {
  // test correctness
  //
  uchar in[48] = { 0 };
  uchar re[96] = { 0 };
  uchar * a = in;
  uchar r[96] = { 0 };

  {
    const char * tests[] = {
      // test 0
      "af9ff5448e60bc9a718f463ac102bd6f8772e6460c19076a6c89d5806e5a8ef44b6f3b8af09e37a4e564987a26b9deda",
      "0f9ff5448e60bc9a718f463ac102bd6f8772e6460c19076a6c89d5806e5a8ef44b6f3b8af09e37a4e564987a26b9deda124f01f63e23a2ea926d07552c680afa9e1fb5f475c11b35b84fa0eda83329c83a046b5ff6abf1ca78e4878764327b3a",
      // test 1
      "c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      "400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      // test 2
      "97f1d3a73197d7942695638c4fa9ac0fc3688c4f9774b905a14e3a3f171bac586c55e83ff97a1aeffb3af00adb22c6bb",
      "17f1d3a73197d7942695638c4fa9ac0fc3688c4f9774b905a14e3a3f171bac586c55e83ff97a1aeffb3af00adb22c6bb08b3f481e3aaa0f1a09e30ed741d8ae4fcf5e095d5d00af600db18cb2c04b3edd03cc744a2888ae40caa232946c5e7e1",
      // test 3
      "af9ff5448e60bc9a718f463ac102bd6f8772e6460c19076a6c89d5806e5a8ef44b6f3b8af09e37a4e564987a26b9dedb",
      "",
      // test 4
      "9a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaaab",
      "",
    };

    for( ulong i=0; i<sizeof(tests)/8/2; i++ ) {
      ulong in_sz = strlen( tests[2*i] ) / 2;

      fd_hex_decode( in, tests[2*i], in_sz );
      ulong out_sz = strlen( tests[2*i+1] ) / 2;

      if( out_sz==0 ) {
        FD_TEST( fd_bls12_381_g1_decompress_syscall( r, a, 1 /*BE*/ )==-1 );
        continue;
      }
      FD_TEST( fd_bls12_381_g1_decompress_syscall( r, a, 1 /*BE*/ )==0 );

      fd_hex_decode( re, tests[2*i+1], out_sz );
      if( !fd_memeq( r, re, out_sz ) ) {
        FD_LOG_HEXDUMP_WARNING(( "res", r, out_sz ));
        FD_LOG_HEXDUMP_WARNING(( "exp", re, out_sz ));
        FD_LOG_ERR(( "FAIL: fd_bls12_381_g1_decompress_syscall big_endian=1 %lu, %s", i, "res != exp" ));
      }
    }
  }
  {
    const char * tests[] = {
      // test 1
      "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0",
      "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      // test 2
      "bbc622db0af03afbef1a7af93fe8556c58ac1b173f3a4ea105b974974f8c68c30faca94f8c63952694d79731a7d3f197",
      "bbc622db0af03afbef1a7af93fe8556c58ac1b173f3a4ea105b974974f8c68c30faca94f8c63952694d79731a7d3f117e1e7c5462923aa0ce48a88a244c73cd0edb3042ccb18db00f60ad0d595e0f5fce48a1d74ed309ea0f1a0aae381f4b308",
      // test 3
      "dbdeb9267a9864e5a4379ef08a3b6f4bf48e5a6e80d5896c6a07190c46e672876fbd02c13a468f719abc608e44f59faf",
      "",
      // test 4
      "abaafffffffffeb9ffff53b1feffab1e24f6b0f6a0d23067bf1285f3844b7764d7ac4b43b6a71b4b9ae67f39ea11019a",
      "",
      // test 0
      "dadeb9267a9864e5a4379ef08a3b6f4bf48e5a6e80d5896c6a07190c46e672876fbd02c13a468f719abc608e44f59faf",
      "dadeb9267a9864e5a4379ef08a3b6f4bf48e5a6e80d5896c6a07190c46e672876fbd02c13a468f719abc608e44f59f0f3a7b32648787e478caf1abf65f6b043ac82933a8eda04fb8351bc175f4b51f9efa0a682c55076d92eaa2233ef6014f12",
    };

    for( ulong i=0; i<sizeof(tests)/8/2; i++ ) {
      ulong in_sz = strlen( tests[2*i] ) / 2;

      fd_hex_decode( in, tests[2*i], in_sz );
      ulong out_sz = strlen( tests[2*i+1] ) / 2;

      if( out_sz==0 ) {
        FD_TEST( fd_bls12_381_g1_decompress_syscall( r, a, 0 /*LE*/ )==-1 );
        continue;
      }
      FD_TEST( fd_bls12_381_g1_decompress_syscall( r, a, 0 /*LE*/ )==0 );

      fd_hex_decode( re, tests[2*i+1], out_sz );
      if( !fd_memeq( r, re, out_sz ) ) {
        FD_LOG_HEXDUMP_WARNING(( "res", r, out_sz ));
        FD_LOG_HEXDUMP_WARNING(( "exp", re, out_sz ));
        FD_LOG_ERR(( "FAIL: fd_bls12_381_g1_decompress_syscall big_endian=0 %lu, %s", i, "res != exp" ));
      }
    }
  }
  {
    ulong iter = 1000UL;
    long dt = fd_log_wallclock();
    for( ulong rem=iter; rem; rem-- ) {
      fd_bls12_381_g1_decompress_syscall( r, a, 0 /*LE*/ );
    }
    dt = fd_log_wallclock() - dt;
    log_bench( "fd_bls12_381_g1_decompress_syscall", iter, dt );
  }
}

static void
test_g1_add( FD_FN_UNUSED fd_rng_t * rng ) {
  // test correctness
  //
  uchar in[96*2] = { 0 };
  uchar re[96] = { 0 };
  uchar * a = in;
  uchar * b = in+96;
  uchar r[96] = { 0 };

  {
    const char * tests[] = {
      // test 0
      "0956a9d4ecf511657fb7380d6364b785396b60dcc6c502d7e1afd439a88f687f75f2b4c8a287489b589a3a5a3a2ef8b00ace1970f00139590a1ea55ea4fcdbe185d6a10476b17b353935e9ff7075f1f7b9c3e8247b1fdd0639b0fba3c32723af0d203dd7537cbabd52004ff443a7153230e5086b330f132f4b4df6b93f428f6dedd39992a3af4a4532c6ebda09aae12e16d37454207382e06afacd8fee734acfeec1e8103b8c14fc0722902f8938beaaebbdee2d613ac7ca2da48bc8bed7093b",
      "173eff899dbc6256c06688abbb319b53cc85d99089670f04744b7f411d59df9320a15b6860d3ef66e95f3082cf9a13bd127066912449111b2f60742d381910bf381556d885f5cf479e1f1d3354b9868a404437a13799d69bfa15e904037529ef",
      // test 1
      "0956a9d4ecf511657fb7380d6364b785396b60dcc6c502d7e1afd439a88f687f75f2b4c8a287489b589a3a5a3a2ef8b00ace1970f00139590a1ea55ea4fcdbe185d6a10476b17b353935e9ff7075f1f7b9c3e8247b1fdd0639b0fba3c32723af0956a9d4ecf511657fb7380d6364b785396b60dcc6c502d7e1afd439a88f687f75f2b4c8a287489b589a3a5a3a2ef8b00ace1970f00139590a1ea55ea4fcdbe185d6a10476b17b353935e9ff7075f1f7b9c3e8247b1fdd0639b0fba3c32723af",
      "14673e7a2b8871c549e78b4470a0659e6590ab002cd0c141a41db171d508f90310f07dfaf61a1d5bc83cfc80c5b6c4351700fec75600968a207694b7dcf41b177b8ab65a1887260d5584735c34f53758144328bc7866736fc05be9cce148356c",
      // test 2
      "0956a9d4ecf511657fb7380d6364b785396b60dcc6c502d7e1afd439a88f687f75f2b4c8a287489b589a3a5a3a2ef8b00ace1970f00139590a1ea55ea4fcdbe185d6a10476b17b353935e9ff7075f1f7b9c3e8247b1fdd0639b0fba3c32723af400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      "0956a9d4ecf511657fb7380d6364b785396b60dcc6c502d7e1afd439a88f687f75f2b4c8a287489b589a3a5a3a2ef8b00ace1970f00139590a1ea55ea4fcdbe185d6a10476b17b353935e9ff7075f1f7b9c3e8247b1fdd0639b0fba3c32723af",
      // test 3
      "400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      "400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      // test - ec0
      "4000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000956a9d4ecf511657fb7380d6364b785396b60dcc6c502d7e1afd439a88f687f75f2b4c8a287489b589a3a5a3a2ef8b00ace1970f00139590a1ea55ea4fcdbe185d6a10476b17b353935e9ff7075f1f7b9c3e8247b1fdd0639b0fba3c32723af",
      "0956a9d4ecf511657fb7380d6364b785396b60dcc6c502d7e1afd439a88f687f75f2b4c8a287489b589a3a5a3a2ef8b00ace1970f00139590a1ea55ea4fcdbe185d6a10476b17b353935e9ff7075f1f7b9c3e8247b1fdd0639b0fba3c32723af",
    };

    for( ulong i=0; i<sizeof(tests)/8/2; i++ ) {
      ulong in_sz = strlen( tests[2*i] ) / 2;

      fd_hex_decode( in, tests[2*i], in_sz );

      FD_TEST( fd_bls12_381_g1_add_syscall( r, a, b, 1 /*BE*/ )==0 );

      ulong out_sz = strlen( tests[2*i+1] ) / 2;
      fd_hex_decode( re, tests[2*i+1], out_sz );
      if( !fd_memeq( r, re, out_sz ) ) {
        FD_LOG_HEXDUMP_WARNING(( "res", r, out_sz ));
        FD_LOG_HEXDUMP_WARNING(( "exp", re, out_sz ));
        FD_LOG_ERR(( "FAIL: fd_bls12_381_g1_add_syscall big_endian=1 %lu, %s", i, "res != exp" ));
      }
    }
  }
  {
    const char * tests[] = {
      // test 1
      "b0f82e3a5a3a9a589b4887a2c8b4f2757f688fa839d4afe1d702c5c6dc606b3985b764630d38b77f6511f5ecd4a95609af2327c3a3fbb03906dd1f7b24e8c3b9f7f17570ffe93539357bb17604a1d685e1dbfca45ea51e0a593901f07019ce0ab0f82e3a5a3a9a589b4887a2c8b4f2757f688fa839d4afe1d702c5c6dc606b3985b764630d38b77f6511f5ecd4a95609af2327c3a3fbb03906dd1f7b24e8c3b9f7f17570ffe93539357bb17604a1d685e1dbfca45ea51e0a593901f07019ce0a",
      "35c4b6c580fc3cc85b1d1af6fa7df01003f908d571b11da441c1d02c00ab90659e65a070448be749c571882b7a3e67146c3548e1cce95bc06f736678bc2843145837f5345c7384550d2687185ab68a7b171bf4dcb79476208a960056c7fe0017",
      // test 2
      "b0f82e3a5a3a9a589b4887a2c8b4f2757f688fa839d4afe1d702c5c6dc606b3985b764630d38b77f6511f5ecd4a95609af2327c3a3fbb03906dd1f7b24e8c3b9f7f17570ffe93539357bb17604a1d685e1dbfca45ea51e0a593901f07019ce0a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      "b0f82e3a5a3a9a589b4887a2c8b4f2757f688fa839d4afe1d702c5c6dc606b3985b764630d38b77f6511f5ecd4a95609af2327c3a3fbb03906dd1f7b24e8c3b9f7f17570ffe93539357bb17604a1d685e1dbfca45ea51e0a593901f07019ce0a",
      // test 3
      "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      // test - ec0
      "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b0f82e3a5a3a9a589b4887a2c8b4f2757f688fa839d4afe1d702c5c6dc606b3985b764630d38b77f6511f5ecd4a95609af2327c3a3fbb03906dd1f7b24e8c3b9f7f17570ffe93539357bb17604a1d685e1dbfca45ea51e0a593901f07019ce0a",
      "b0f82e3a5a3a9a589b4887a2c8b4f2757f688fa839d4afe1d702c5c6dc606b3985b764630d38b77f6511f5ecd4a95609af2327c3a3fbb03906dd1f7b24e8c3b9f7f17570ffe93539357bb17604a1d685e1dbfca45ea51e0a593901f07019ce0a",
      // test 0
      "b0f82e3a5a3a9a589b4887a2c8b4f2757f688fa839d4afe1d702c5c6dc606b3985b764630d38b77f6511f5ecd4a95609af2327c3a3fbb03906dd1f7b24e8c3b9f7f17570ffe93539357bb17604a1d685e1dbfca45ea51e0a593901f07019ce0a2ee1aa09daebc632454aafa39299d3ed6d8f423fb9f64d4b2f130f336b08e5303215a743f44f0052bdba7c53d73d200d3b09d7bec88ba42dcac73a612deebdebaabe38892f902207fc148c3b10e8c1eecf4a73ee8fcdfa6ae08273205474d316",
      "bd139acf82305fe966efd360685ba12093df591d417f4b74040f678990d985cc539b31bbab8866c05662bc9d89ff3e17ef29750304e915fa9bd69937a13744408a86b954331d1f9e47cff585d8561538bf1019382d74602f1b11492491667012",
    };

    for( ulong i=0; i<sizeof(tests)/8/2; i++ ) {
      ulong in_sz = strlen( tests[2*i] ) / 2;

      fd_hex_decode( in, tests[2*i], in_sz );

      FD_TEST( fd_bls12_381_g1_add_syscall( r, a, b, 0 /*LE*/ )==0 );

      ulong out_sz = strlen( tests[2*i+1] ) / 2;
      fd_hex_decode( re, tests[2*i+1], out_sz );
      if( !fd_memeq( r, re, out_sz ) ) {
        FD_LOG_HEXDUMP_WARNING(( "res", r, out_sz ));
        FD_LOG_HEXDUMP_WARNING(( "exp", re, out_sz ));
        FD_LOG_ERR(( "FAIL: fd_bls12_381_g1_add_syscall big_endian=0 %lu, %s", i, "res != exp" ));
      }
    }
  }
  {
    ulong iter = 10000UL;
    long dt = fd_log_wallclock();
    for( ulong rem=iter; rem; rem-- ) {
      fd_bls12_381_g1_add_syscall( r, a, b, 0 /*LE*/ );
    }
    dt = fd_log_wallclock() - dt;
    log_bench( "fd_bls12_381_g1_add_syscall", iter, dt );
  }
}

static void
test_g1_sub( FD_FN_UNUSED fd_rng_t * rng ) {
  // test correctness
  //
  uchar in[96*2] = { 0 };
  uchar re[96] = { 0 };
  uchar * a = in;
  uchar * b = in+96;
  uchar r[96] = { 0 };

  {
    const char * tests[] = {
      // test 0
      "067e43b1dda8db9311206d70cc5fcfb3e3ca20fa762bc369b02fbc2bb5e27b7784f061ace1f7b44c3ae5bc79f71cf5c611805eefce0a0a1494bae2ca0cc44748a72c574018d6eeda06a671a5b208dd00159a48a09e462ef47f04fa9e1f0282980cad836a11aca92ecde45319ccd876df106634ebcaffb75b634e8da90ef4a11cf020d62e005d6a4929b0dca0fb25126e0f5643d2897247dca779b1e08e97981dce0c23062e3c357f544ee758315fdb24e0b600fd88733b0f50e588671bd3785a",
      "0d90837443e588a58792b5bfc5d7447e679ee732316908f335d1631027b1d36380a425658bba0ee154d27810cb73a0310af344f157c1bab357d658277b7e881fb286cbde7fcedaf087b75d918894aeee9f0075d4abf794c5ce07e151724a3fc9",
      // test 1
      "067e43b1dda8db9311206d70cc5fcfb3e3ca20fa762bc369b02fbc2bb5e27b7784f061ace1f7b44c3ae5bc79f71cf5c611805eefce0a0a1494bae2ca0cc44748a72c574018d6eeda06a671a5b208dd00159a48a09e462ef47f04fa9e1f028298067e43b1dda8db9311206d70cc5fcfb3e3ca20fa762bc369b02fbc2bb5e27b7784f061ace1f7b44c3ae5bc79f71cf5c611805eefce0a0a1494bae2ca0cc44748a72c574018d6eeda06a671a5b208dd00159a48a09e462ef47f04fa9e1f028298",
      "400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      // test 2
      "400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000067e43b1dda8db9311206d70cc5fcfb3e3ca20fa762bc369b02fbc2bb5e27b7784f061ace1f7b44c3ae5bc79f71cf5c611805eefce0a0a1494bae2ca0cc44748a72c574018d6eeda06a671a5b208dd00159a48a09e462ef47f04fa9e1f028298",
      "067e43b1dda8db9311206d70cc5fcfb3e3ca20fa762bc369b02fbc2bb5e27b7784f061ace1f7b44c3ae5bc79f71cf5c60880b2fa6b75dc85b660c4ec3687658ebd4af444daae23e5608a60fb44a819240911b75e130dd10b3afa0561e0fd2813",
      // test 3
      "067e43b1dda8db9311206d70cc5fcfb3e3ca20fa762bc369b02fbc2bb5e27b7784f061ace1f7b44c3ae5bc79f71cf5c611805eefce0a0a1494bae2ca0cc44748a72c574018d6eeda06a671a5b208dd00159a48a09e462ef47f04fa9e1f028298400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      "067e43b1dda8db9311206d70cc5fcfb3e3ca20fa762bc369b02fbc2bb5e27b7784f061ace1f7b44c3ae5bc79f71cf5c611805eefce0a0a1494bae2ca0cc44748a72c574018d6eeda06a671a5b208dd00159a48a09e462ef47f04fa9e1f028298",
      // test - ec0
      "400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      "400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
    };

    for( ulong i=0; i<sizeof(tests)/8/2; i++ ) {
      ulong in_sz = strlen( tests[2*i] ) / 2;

      fd_hex_decode( in, tests[2*i], in_sz );

      FD_TEST( fd_bls12_381_g1_sub_syscall( r, a, b, 1 /*BE*/ )==0 );

      ulong out_sz = strlen( tests[2*i+1] ) / 2;
      fd_hex_decode( re, tests[2*i+1], out_sz );
      if( !fd_memeq( r, re, out_sz ) ) {
        FD_LOG_HEXDUMP_WARNING(( "res", r, out_sz ));
        FD_LOG_HEXDUMP_WARNING(( "exp", re, out_sz ));
        FD_LOG_ERR(( "FAIL: fd_bls12_381_g1_sub_syscall big_endian=1 %lu, %s", i, "res != exp" ));
      }
    }
  }
  {
    const char * tests[] = {
      // test 1
      "c6f51cf779bce53a4cb4f7e1ac61f084777be2b52bbc2fb069c32b76fa20cae3b3cf5fcc706d201193dba8ddb1437e069882021f9efa047ff42e469ea0489a1500dd08b2a571a606daeed61840572ca74847c40ccae2ba94140a0aceef5e8011c6f51cf779bce53a4cb4f7e1ac61f084777be2b52bbc2fb069c32b76fa20cae3b3cf5fcc706d201193dba8ddb1437e069882021f9efa047ff42e469ea0489a1500dd08b2a571a606daeed61840572ca74847c40ccae2ba94140a0aceef5e8011",
      "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      // test 2
      "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c6f51cf779bce53a4cb4f7e1ac61f084777be2b52bbc2fb069c32b76fa20cae3b3cf5fcc706d201193dba8ddb1437e069882021f9efa047ff42e469ea0489a1500dd08b2a571a606daeed61840572ca74847c40ccae2ba94140a0aceef5e8011",
      "c6f51cf779bce53a4cb4f7e1ac61f084777be2b52bbc2fb069c32b76fa20cae3b3cf5fcc706d201193dba8ddb1437e061328fde06105fa3a0bd10d135eb711092419a844fb608a60e523aeda44f44abd8e658736ecc460b685dc756bfab28008",
      // test 3
      "c6f51cf779bce53a4cb4f7e1ac61f084777be2b52bbc2fb069c32b76fa20cae3b3cf5fcc706d201193dba8ddb1437e069882021f9efa047ff42e469ea0489a1500dd08b2a571a606daeed61840572ca74847c40ccae2ba94140a0aceef5e8011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      "c6f51cf779bce53a4cb4f7e1ac61f084777be2b52bbc2fb069c32b76fa20cae3b3cf5fcc706d201193dba8ddb1437e069882021f9efa047ff42e469ea0489a1500dd08b2a571a606daeed61840572ca74847c40ccae2ba94140a0aceef5e8011",
      // test - ec0
      "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      // test 0
      "c6f51cf779bce53a4cb4f7e1ac61f084777be2b52bbc2fb069c32b76fa20cae3b3cf5fcc706d201193dba8ddb1437e069882021f9efa047ff42e469ea0489a1500dd08b2a571a606daeed61840572ca74847c40ccae2ba94140a0aceef5e80116e1225fba0dcb029496a5d002ed620f01ca1f40ea98d4e635bb7ffcaeb346610df76d8cc1953e4cd2ea9ac116a83ad0c5a78d31b6788e5500f3b7388fd00b6e024db5f3158e74e547f353c2e06230cce1d98978ee0b179a7dc477289d243560f",
      "31a073cb1078d254e10eba8b6525a48063d3b1271063d135f308693132e79e677e44d7c5bfb59287a588e5437483900dc93f4a7251e107cec594f7abd475009feeae9488915db787f0dace7fdecb86b21f887e7b2758d657b3bac157f144f30a",
    };

    for( ulong i=0; i<sizeof(tests)/8/2; i++ ) {
      ulong in_sz = strlen( tests[2*i] ) / 2;

      fd_hex_decode( in, tests[2*i], in_sz );

      FD_TEST( fd_bls12_381_g1_sub_syscall( r, a, b, 0 /*LE*/ )==0 );

      ulong out_sz = strlen( tests[2*i+1] ) / 2;
      fd_hex_decode( re, tests[2*i+1], out_sz );
      if( !fd_memeq( r, re, out_sz ) ) {
        FD_LOG_HEXDUMP_WARNING(( "res", r, out_sz ));
        FD_LOG_HEXDUMP_WARNING(( "exp", re, out_sz ));
        FD_LOG_ERR(( "FAIL: fd_bls12_381_g1_sub_syscall big_endian=0 %lu, %s", i, "res != exp" ));
      }
    }
  }
  {
    ulong iter = 10000UL;
    long dt = fd_log_wallclock();
    for( ulong rem=iter; rem; rem-- ) {
      fd_bls12_381_g1_sub_syscall( r, a, b, 0 /*LE*/ );
    }
    dt = fd_log_wallclock() - dt;
    log_bench( "fd_bls12_381_g1_sub_syscall", iter, dt );
  }
}

static void
test_g1_mul( FD_FN_UNUSED fd_rng_t * rng ) {
  // test correctness
  //
  uchar in[96+32] = { 0 };
  uchar re[96] = { 0 };
  uchar * a = in;
  uchar * b = in+96;
  uchar r[96] = { 0 };

  {
    const char * tests[] = {
      // test 0
      "1412e9c96ece3820082c8c7925c49d38b486a421b48293071aefb7a3db558fc5f7f375fcc9ab9c5ad2072b5c5982a5e005651836bd16494c9188633b33ff7c2b3d08791e765afe0c7e5c984e2ce77e38dc23367502afbe698abcca24ab0ce7e11dc06f97bb256d5b81dfbce1750378a26b429fff3d802920f25fe8ca6abc9a93",
      "166548ff03f727daea75d05b9e727e37a647e3cd067c37ffa7429aed538f08b362b9a2a4aa3e8d0401b329315fd48be3127df50aa9c9abac980169519fa0fcb8503ba5aab972f8d0e46fe5c8ddcc0978998e58f0e4a49d4f483777ef3868363a",
      // test 1
      "1412e9c96ece3820082c8c7925c49d38b486a421b48293071aefb7a3db558fc5f7f375fcc9ab9c5ad2072b5c5982a5e005651836bd16494c9188633b33ff7c2b3d08791e765afe0c7e5c984e2ce77e38dc23367502afbe698abcca24ab0ce7e10000000000000000000000000000000000000000000000000000000000000000",
      "400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      // test 2
      "1412e9c96ece3820082c8c7925c49d38b486a421b48293071aefb7a3db558fc5f7f375fcc9ab9c5ad2072b5c5982a5e005651836bd16494c9188633b33ff7c2b3d08791e765afe0c7e5c984e2ce77e38dc23367502afbe698abcca24ab0ce7e10000000000000000000000000000000000000000000000000000000000000001",
      "1412e9c96ece3820082c8c7925c49d38b486a421b48293071aefb7a3db558fc5f7f375fcc9ab9c5ad2072b5c5982a5e005651836bd16494c9188633b33ff7c2b3d08791e765afe0c7e5c984e2ce77e38dc23367502afbe698abcca24ab0ce7e1",
      // test 3
      "1412e9c96ece3820082c8c7925c49d38b486a421b48293071aefb7a3db558fc5f7f375fcc9ab9c5ad2072b5c5982a5e005651836bd16494c9188633b33ff7c2b3d08791e765afe0c7e5c984e2ce77e38dc23367502afbe698abcca24ab0ce7e173eda753299d7d483339d80809a1d80553bda402fffe5bfeffffffff00000000",
      "1412e9c96ece3820082c8c7925c49d38b486a421b48293071aefb7a3db558fc5f7f375fcc9ab9c5ad2072b5c5982a5e0149bf9b37c699d4db993447b0f4c30ac276ed2667d2a14b2e8d43a52c9c977eb4288c989aea441962f4235db54f2c2ca",
      // test 4
      "4000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001dc06f97bb256d5b81dfbce1750378a26b429fff3d802920f25fe8ca6abc9a93",
      "400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
    };

    for( ulong i=0; i<sizeof(tests)/8/2; i++ ) {
      ulong in_sz = strlen( tests[2*i] ) / 2;

      fd_hex_decode( in, tests[2*i], in_sz );

      FD_TEST( fd_bls12_381_g1_mul_syscall( r, a, b, 1 /*BE*/ )==0 );

      ulong out_sz = strlen( tests[2*i+1] ) / 2;
      fd_hex_decode( re, tests[2*i+1], out_sz );
      if( !fd_memeq( r, re, out_sz ) ) {
        FD_LOG_HEXDUMP_WARNING(( "res", r, out_sz ));
        FD_LOG_HEXDUMP_WARNING(( "exp", re, out_sz ));
        FD_LOG_ERR(( "FAIL: fd_bls12_381_g1_mul_syscall big_endian=1 %lu, %s", i, "res != exp" ));
      }
    }
  }
  {
    const char * tests[] = {
      // test 1
      "e0a582595c2b07d25a9cabc9fc75f3f7c58f55dba3b7ef1a079382b421a486b4389dc425798c2c082038ce6ec9e91214e1e70cab24cabc8a69beaf02753623dc387ee72c4e985c7e0cfe5a761e79083d2b7cff333b6388914c4916bd361865050000000000000000000000000000000000000000000000000000000000000000",
      "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      // test 2
      "e0a582595c2b07d25a9cabc9fc75f3f7c58f55dba3b7ef1a079382b421a486b4389dc425798c2c082038ce6ec9e91214e1e70cab24cabc8a69beaf02753623dc387ee72c4e985c7e0cfe5a761e79083d2b7cff333b6388914c4916bd361865050100000000000000000000000000000000000000000000000000000000000000",
      "e0a582595c2b07d25a9cabc9fc75f3f7c58f55dba3b7ef1a079382b421a486b4389dc425798c2c082038ce6ec9e91214e1e70cab24cabc8a69beaf02753623dc387ee72c4e985c7e0cfe5a761e79083d2b7cff333b6388914c4916bd36186505",
      // test 3
      "e0a582595c2b07d25a9cabc9fc75f3f7c58f55dba3b7ef1a079382b421a486b4389dc425798c2c082038ce6ec9e91214e1e70cab24cabc8a69beaf02753623dc387ee72c4e985c7e0cfe5a761e79083d2b7cff333b6388914c4916bd3618650500000000fffffffffe5bfeff02a4bd5305d8a10908d83933487d9d2953a7ed73",
      "e0a582595c2b07d25a9cabc9fc75f3f7c58f55dba3b7ef1a079382b421a486b4389dc425798c2c082038ce6ec9e91214cac2f254db35422f9641a4ae89c98842eb77c9c9523ad4e8b2142a7d66d26e27ac304c0f7b4493b94d9d697cb3f99b14",
      // test - ec0
      "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000939abc6acae85ff22029803dff9f426ba2780375e1bcdf815b6d25bb976fc01d",
      "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      // test 0
      "e0a582595c2b07d25a9cabc9fc75f3f7c58f55dba3b7ef1a079382b421a486b4389dc425798c2c082038ce6ec9e91214e1e70cab24cabc8a69beaf02753623dc387ee72c4e985c7e0cfe5a761e79083d2b7cff333b6388914c4916bd36186505939abc6acae85ff22029803dff9f426ba2780375e1bcdf815b6d25bb976fc01d",
      "e38bd45f3129b301048d3eaaa4a2b962b3088f53ed9a42a7ff377c06cde347a6377e729e5bd075eada27f703ff4865163a366838ef7737484f9da4e4f0588e997809ccddc8e56fe4d0f872b9aaa53b50b8fca09f51690198acabc9a90af57d12",
    };

    for( ulong i=0; i<sizeof(tests)/8/2; i++ ) {
      ulong in_sz = strlen( tests[2*i] ) / 2;

      fd_hex_decode( in, tests[2*i], in_sz );

      FD_TEST( fd_bls12_381_g1_mul_syscall( r, a, b, 0 /*LE*/ )==0 );

      ulong out_sz = strlen( tests[2*i+1] ) / 2;
      fd_hex_decode( re, tests[2*i+1], out_sz );
      if( !fd_memeq( r, re, out_sz ) ) {
        FD_LOG_HEXDUMP_WARNING(( "res", r, out_sz ));
        FD_LOG_HEXDUMP_WARNING(( "exp", re, out_sz ));
        FD_LOG_ERR(( "FAIL: fd_bls12_381_g1_mul_syscall big_endian=0 %lu, %s", i, "res != exp" ));
      }
    }
  }
  {
    ulong iter = 100UL;
    long dt = fd_log_wallclock();
    for( ulong rem=iter; rem; rem-- ) {
      fd_bls12_381_g1_mul_syscall( r, a, b, 0 /*LE*/ );
    }
    dt = fd_log_wallclock() - dt;
    log_bench( "fd_bls12_381_g1_mul_syscall", iter, dt );
  }
}


static void
test_g2_val( FD_FN_UNUSED fd_rng_t * rng ) {
  // test correctness
  //
  uchar in[96*2] = { 0 };
  uchar * r = in;

  {
    const char * tests[] = {
      // test 0
      "004fcf735b480050313bcbbdb2f0128ddf933e4f628393216797890ca00d4eb40ddd59efb2f98d0826891747d5021c0d18a8330622b8e416ad0be0a80e679a12a633ff9a2de6fd959110fb6bf83735962583858a9cc346ca8390a6a450fbb3a70836bc990aeb530ed35fd43678af9453fd6a35b29d76d06e00bb6f0e8cf68bc8cdb24824438c2764a3688c4e5b7b82c50cb04668412b68e866eee573fd3e3dcf74dff5cefaa31ec84c655d45d8f0bdc6fd1bc720d7e00c324ecc6a2875442c71",
      "ok",
      // test 1
      "400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      "ok",
      // test 2
      "004fcf735b480050313bcbbdb2f0128ddf933e4f628393216797890ca00d4eb40ddd59efb2f98d0826891747d5021c0d18a8330622b8e416ad0be0a80e679a12a633ff9a2de6fd959110fb6bf83735962583858a9cc346ca8390a6a450fbb3a70836bc990aeb530ed35fd43678af9453fd6a35b29d76d06e00bb6f0e8cf68bc8cdb24824438c2764a3688c4e5b7b82c50cb04668412b68e866eee573fd3e3dcf74dff5cefaa31ec84c655d45d8f0bdc6fd1bc720d7e00c324ecc6a2875442c76",
      "",
      // test 3
      "13e02b6052719f607dacd3a088274f65596bd0d09920b61ab5da61bbdc7f5049334cf11213945d57e5ac7d055d042b7e1a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaaab0606c4a02ea734cc32acd2b02bc28b99cb3e287e85a763af267492ab572e99ab3f370d275cec1da1aaa9075ff05f79be0ce5d527727d6e118cc9cdc6da2e351aadfd9baa8cbdd3a76d429a695160d12c923ac9cc3baca289e193548608b82801",
      "",
    };

    for( ulong i=0; i<sizeof(tests)/8/2; i++ ) {
      ulong in_sz = strlen( tests[2*i] ) / 2;

      fd_hex_decode( in, tests[2*i], in_sz );

      if( strlen( tests[2*i+1] )==0 ) {
        FD_TEST( fd_bls12_381_g2_validate_syscall( r, 1 /*BE*/ )==-1 );
        continue;
      }
      FD_TEST( fd_bls12_381_g2_validate_syscall( r, 1 /*BE*/ )==0 );
    }
  }
  {
    const char * tests[] = {
      // test 1
      "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      "ok",
      // test 2
      "a7b3fb50a4a69083ca46c39c8a858325963537f86bfb109195fde62d9aff33a6129a670ea8e00bad16e4b8220633a8180d1c02d547178926088df9b2ef59dd0db44e0da00c899767219383624f3e93df8d12f0b2bdcb3b315000485b73cf4f00762c4475286acc4e320ce0d720c71bfdc6bdf0d8455d654cc81ea3facef5df74cf3d3efd73e5ee66e8682b416846b00cc5827b5b4e8c68a364278c432448b2cdc88bf68c0e6fbb006ed0769db2356afd5394af7836d45fd30e53eb0a99bc3608",
      "",
      // test 3
      "abaafffffffffeb9ffff53b1feffab1e24f6b0f6a0d23067bf1285f3844b7764d7ac4b43b6a71b4b9ae67f39ea11011a7e2b045d057dace5575d941312f14c3349507fdcbb61dab51ab62099d0d06b59654f2788a0d3ac7d609f7152602be0130128b808865493e189a2ac3bccc93a922cd16051699a426da7d3bd8caa9bfdad1a352edac6cdc98c116e7d7227d5e50cbe795ff05f07a9aaa11dec5c270d373fab992e57ab927426af63a7857e283ecb998bc22bb0d2ac32cc34a72ea0c40606",
      "",
      // test 0
      "a7b3fb50a4a69083ca46c39c8a858325963537f86bfb109195fde62d9aff33a6129a670ea8e00bad16e4b8220633a8180d1c02d547178926088df9b2ef59dd0db44e0da00c899767219383624f3e93df8d12f0b2bdcb3b315000485b73cf4f00712c4475286acc4e320ce0d720c71bfdc6bdf0d8455d654cc81ea3facef5df74cf3d3efd73e5ee66e8682b416846b00cc5827b5b4e8c68a364278c432448b2cdc88bf68c0e6fbb006ed0769db2356afd5394af7836d45fd30e53eb0a99bc3608",
      "ok",
    };

    for( ulong i=0; i<sizeof(tests)/8/2; i++ ) {
      ulong in_sz = strlen( tests[2*i] ) / 2;

      fd_hex_decode( in, tests[2*i], in_sz );

      if( strlen( tests[2*i+1] )==0 ) {
        FD_TEST( fd_bls12_381_g2_validate_syscall( r, 0 /*LE*/ )==-1 );
        continue;
      }
      FD_TEST( fd_bls12_381_g2_validate_syscall( r, 0 /*LE*/ )==0 );
    }
  }
  {
    ulong iter = 1000UL;
    long dt = fd_log_wallclock();
    for( ulong rem=iter; rem; rem-- ) {
      fd_bls12_381_g2_validate_syscall( r, 0 /*LE*/ );
    }
    dt = fd_log_wallclock() - dt;
    log_bench( "fd_bls12_381_g2_validate_syscall", iter, dt );
  }
}

static void
test_g2_dec( FD_FN_UNUSED fd_rng_t * rng ) {
  // test correctness
  //
  uchar in[48*2] = { 0 };
  uchar re[96*2] = { 0 };
  uchar * a = in;
  uchar r[96*2] = { 0 };

  {
    const char * tests[] = {
      // test 0
      "8f6a12dc289804e48b236892b34acdac92890b6a4a2a878935f940fbade830d17dde0dd179eeb9b36f6947df2730c3681718aa3b6f6aa733e7bae0b6ac490f12d38f3b0273bec4a36f0b24855660bc871025d8af47b6de1fcf9b10ff704ef26f",
      "0f6a12dc289804e48b236892b34acdac92890b6a4a2a878935f940fbade830d17dde0dd179eeb9b36f6947df2730c3681718aa3b6f6aa733e7bae0b6ac490f12d38f3b0273bec4a36f0b24855660bc871025d8af47b6de1fcf9b10ff704ef26f0bd9f453c96fb6a8abcdb776c755829d5f459f7e7a1b5c54fd9360b04a390de4b26ff69d4a78aeff925c20d6a438ce900d3b6ffbaa559fdb6cbb1f0f6ab040bf384dd95790c494150cab63798078bbe0c06b68b24bcd7640eaa8d60b7d993705",
      // test 1
      "c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      "400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      // test 2
      "93e02b6052719f607dacd3a088274f65596bd0d09920b61ab5da61bbdc7f5049334cf11213945d57e5ac7d055d042b7e024aa2b2f08f0a91260805272dc51051c6e47ad4fa403b02b4510b647ae3d1770bac0326a805bbefd48056c8c121bdb8",
      "13e02b6052719f607dacd3a088274f65596bd0d09920b61ab5da61bbdc7f5049334cf11213945d57e5ac7d055d042b7e024aa2b2f08f0a91260805272dc51051c6e47ad4fa403b02b4510b647ae3d1770bac0326a805bbefd48056c8c121bdb80606c4a02ea734cc32acd2b02bc28b99cb3e287e85a763af267492ab572e99ab3f370d275cec1da1aaa9075ff05f79be0ce5d527727d6e118cc9cdc6da2e351aadfd9baa8cbdd3a76d429a695160d12c923ac9cc3baca289e193548608b82801",
      // test 3
      "8f6a12dc289804e48b236892b34acdac92890b6a4a2a878935f940fbade830d17dde0dd179eeb9b36f6947df2730c3681718aa3b6f6aa733e7bae0b6ac490f12d38f3b0273bec4a36f0b24855660bc871025d8af47b6de1fcf9b10ff704ef270",
      "",
      // test 4
      "8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001a0111ea397fe69a4b1ba7b6434bacd764774b84f38512bf6730d2a0f6b0f6241eabfffeb153ffffb9feffffffffaaab",
      "",
    };

    for( ulong i=0; i<sizeof(tests)/8/2; i++ ) {
      ulong in_sz = strlen( tests[2*i] ) / 2;

      fd_hex_decode( in, tests[2*i], in_sz );
      ulong out_sz = strlen( tests[2*i+1] ) / 2;

      if( out_sz==0 ) {
        FD_TEST( fd_bls12_381_g2_decompress_syscall( r, a, 1 /*BE*/ )==-1 );
        continue;
      }
      FD_TEST( fd_bls12_381_g2_decompress_syscall( r, a, 1 /*BE*/ )==0 );

      fd_hex_decode( re, tests[2*i+1], out_sz );
      if( !fd_memeq( r, re, out_sz ) ) {
        FD_LOG_HEXDUMP_WARNING(( "res", r, out_sz ));
        FD_LOG_HEXDUMP_WARNING(( "exp", re, out_sz ));
        FD_LOG_ERR(( "FAIL: fd_bls12_381_g2_decompress_syscall big_endian=1 %lu, %s", i, "res != exp" ));
      }
    }
  }
  {
    const char * tests[] = {
      // test 1
      "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0",
      "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      // test 2
      "b8bd21c1c85680d4efbb05a82603ac0b77d1e37a640b51b4023b40fad47ae4c65110c52d27050826910a8ff0b2a24a027e2b045d057dace5575d941312f14c3349507fdcbb61dab51ab62099d0d06b59654f2788a0d3ac7d609f7152602be093",
      "b8bd21c1c85680d4efbb05a82603ac0b77d1e37a640b51b4023b40fad47ae4c65110c52d27050826910a8ff0b2a24a027e2b045d057dace5575d941312f14c3349507fdcbb61dab51ab62099d0d06b59654f2788a0d3ac7d609f7152602be0130128b808865493e189a2ac3bccc93a922cd16051699a426da7d3bd8caa9bfdad1a352edac6cdc98c116e7d7227d5e50cbe795ff05f07a9aaa11dec5c270d373fab992e57ab927426af63a7857e283ecb998bc22bb0d2ac32cc34a72ea0c40606",
      // test 3
      "70f24e70ff109bcf1fdeb647afd8251087bc605685240b6fa3c4be73023b8fd3120f49acb6e0bae733a76a6f3baa181768c33027df47696fb3b9ee79d10dde7dd130e8adfb40f93589872a4a6a0b8992accd4ab39268238be4049828dc126a8f",
      "",
      // test 4
      "abaafffffffffeb9ffff53b1feffab1e24f6b0f6a0d23067bf1285f3844b7764d7ac4b43b6a71b4b9ae67f39ea11011a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000080",
      "",
      // test 0
      "6ff24e70ff109bcf1fdeb647afd8251087bc605685240b6fa3c4be73023b8fd3120f49acb6e0bae733a76a6f3baa181768c33027df47696fb3b9ee79d10dde7dd130e8adfb40f93589872a4a6a0b8992accd4ab39268238be4049828dc126a8f",
      "6ff24e70ff109bcf1fdeb647afd8251087bc605685240b6fa3c4be73023b8fd3120f49acb6e0bae733a76a6f3baa181768c33027df47696fb3b9ee79d10dde7dd130e8adfb40f93589872a4a6a0b8992accd4ab39268238be4049828dc126a0f0537997d0bd6a8ea4076cd4bb2686bc0e0bb78807963ab0c1594c49057d94d38bf40b06a0f1fbb6cdb9f55aafb6f3b0d90ce38a4d6205c92ffae784a9df66fb2e40d394ab06093fd545c1b7a7e9f455f9d8255c776b7cdaba8b66fc953f4d90b",
    };

    for( ulong i=0; i<sizeof(tests)/8/2; i++ ) {
      ulong in_sz = strlen( tests[2*i] ) / 2;

      fd_hex_decode( in, tests[2*i], in_sz );
      ulong out_sz = strlen( tests[2*i+1] ) / 2;

      if( out_sz==0 ) {
        FD_TEST( fd_bls12_381_g2_decompress_syscall( r, a, 0 /*LE*/ )==-1 );
        continue;
      }
      FD_TEST( fd_bls12_381_g2_decompress_syscall( r, a, 0 /*LE*/ )==0 );

      fd_hex_decode( re, tests[2*i+1], out_sz );
      if( !fd_memeq( r, re, out_sz ) ) {
        FD_LOG_HEXDUMP_WARNING(( "res", r, out_sz ));
        FD_LOG_HEXDUMP_WARNING(( "exp", re, out_sz ));
        FD_LOG_ERR(( "FAIL: fd_bls12_381_g2_decompress_syscall big_endian=0 %lu, %s", i, "res != exp" ));
      }
    }
  }
  {
    ulong iter = 1000UL;
    long dt = fd_log_wallclock();
    for( ulong rem=iter; rem; rem-- ) {
      fd_bls12_381_g2_decompress_syscall( r, a, 0 /*LE*/ );
    }
    dt = fd_log_wallclock() - dt;
    log_bench( "fd_bls12_381_g2_decompress_syscall", iter, dt );
  }
}

static void
test_g2_add( FD_FN_UNUSED fd_rng_t * rng ) {
  // test correctness
  //
  uchar in[96*2*2] = { 0 };
  uchar re[96*2] = { 0 };
  uchar * a = in;
  uchar * b = in+96*2;
  uchar r[96*2] = { 0 };

  {
    const char * tests[] = {
      // test 0
      "0b53153e04ae7b83a3133ed8c03019b839cf5046fd3381a957b68e019466cb63566fcf37cc75528ac75983cf9ef4cc8b1297d6c99e2765fcbd35fbeccd1b98a3e86535c512eef146b6716ff9637a2adc377f37f7aca4b7a992e5dab990b056ae1584961df1f1d74d0c4bee67175abdbf5548b5d655fdb7969e08fab2dca9d7f392d5960c0628bcc538d22e7d57051107181ba01663720907f46cb3c9262199db0ad302d44a5f97dfc86079a60aba7a28de5722e331a6c38b25dd2ce35677be290e6eb4ae2e4a917d5e1c27cd6b7e35bc2445a262694f319488e50580c5bb00ea8dc9f6df674bb121024b5a218b989c59195b9e64140c8782bfb505295ec35924b56fee18bbb2b38f11b544cbb886b9c3b01b5a021da5d1108f0be0fb3fbcda2917475b5aca6c50a0c8c2a26dc86005669cf52bf7dd8b94fefdb7a153fdf71647855d247fa2f83140adc911d208d6124107de0b0478115531cd5f84d098885c13c3b088275acf11c30ed721bfe83b03564e4e95a5b391a1bef743f3fc89012747",
      "159d0afb9c3818ae185b62c92125444c29a10ca61080a11f6c1f5cd838c5c642d206406a9a608739aa77dcd2ee4962530f924a7a4628ba7bbf8b0bf9dd140c3e5125bf16f8714e7c1d9de4dcbb06fc0f3bec62c6fccdb0bec0c79ad55c7ebd37026d080f80be1f6ab48260d77d320b7c4777531c41d1802f072ed49de6c733628fdc9dfeb3cbba74294c231c7bcf361105f824f7c1c97476cac97dc9c80d44f427cf46ce0c75cec009e83e218958491079be8b5b9e5093cf7d17b15de3846759",
      // test 1
      "0b53153e04ae7b83a3133ed8c03019b839cf5046fd3381a957b68e019466cb63566fcf37cc75528ac75983cf9ef4cc8b1297d6c99e2765fcbd35fbeccd1b98a3e86535c512eef146b6716ff9637a2adc377f37f7aca4b7a992e5dab990b056ae1584961df1f1d74d0c4bee67175abdbf5548b5d655fdb7969e08fab2dca9d7f392d5960c0628bcc538d22e7d57051107181ba01663720907f46cb3c9262199db0ad302d44a5f97dfc86079a60aba7a28de5722e331a6c38b25dd2ce35677be290b53153e04ae7b83a3133ed8c03019b839cf5046fd3381a957b68e019466cb63566fcf37cc75528ac75983cf9ef4cc8b1297d6c99e2765fcbd35fbeccd1b98a3e86535c512eef146b6716ff9637a2adc377f37f7aca4b7a992e5dab990b056ae1584961df1f1d74d0c4bee67175abdbf5548b5d655fdb7969e08fab2dca9d7f392d5960c0628bcc538d22e7d57051107181ba01663720907f46cb3c9262199db0ad302d44a5f97dfc86079a60aba7a28de5722e331a6c38b25dd2ce35677be29",
      "1530e89c2912b7761679a292a428089239f047c47d3656ea16abf60fe5e7f3e50fc5f95f38de7ccb1c2b5fdd7aed524d0eaeb83d207093219506de0b08f0e4e9a4dc47a7a9862b0108e128b2d805f0cbfd9a7aaa5f302637102ce607f0cbbdce174d83a7b7176827d5bc9513c76c88cdbb0befd3eefea516bb06fc46b15da1bf8d48a8420c8725ee96d2d25d5ca205d6027b96fc85a504b88078dddb68a57c9038f77673b9064095bf4f9adbbd18ae7834b7ed5a212eb7238781f6a096511f30",
      // test 2
      "0b53153e04ae7b83a3133ed8c03019b839cf5046fd3381a957b68e019466cb63566fcf37cc75528ac75983cf9ef4cc8b1297d6c99e2765fcbd35fbeccd1b98a3e86535c512eef146b6716ff9637a2adc377f37f7aca4b7a992e5dab990b056ae1584961df1f1d74d0c4bee67175abdbf5548b5d655fdb7969e08fab2dca9d7f392d5960c0628bcc538d22e7d57051107181ba01663720907f46cb3c9262199db0ad302d44a5f97dfc86079a60aba7a28de5722e331a6c38b25dd2ce35677be29400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      "0b53153e04ae7b83a3133ed8c03019b839cf5046fd3381a957b68e019466cb63566fcf37cc75528ac75983cf9ef4cc8b1297d6c99e2765fcbd35fbeccd1b98a3e86535c512eef146b6716ff9637a2adc377f37f7aca4b7a992e5dab990b056ae1584961df1f1d74d0c4bee67175abdbf5548b5d655fdb7969e08fab2dca9d7f392d5960c0628bcc538d22e7d57051107181ba01663720907f46cb3c9262199db0ad302d44a5f97dfc86079a60aba7a28de5722e331a6c38b25dd2ce35677be29",
      // test 3
      "400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      "400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      // test - ec0
      "4000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b53153e04ae7b83a3133ed8c03019b839cf5046fd3381a957b68e019466cb63566fcf37cc75528ac75983cf9ef4cc8b1297d6c99e2765fcbd35fbeccd1b98a3e86535c512eef146b6716ff9637a2adc377f37f7aca4b7a992e5dab990b056ae1584961df1f1d74d0c4bee67175abdbf5548b5d655fdb7969e08fab2dca9d7f392d5960c0628bcc538d22e7d57051107181ba01663720907f46cb3c9262199db0ad302d44a5f97dfc86079a60aba7a28de5722e331a6c38b25dd2ce35677be29",
      "0b53153e04ae7b83a3133ed8c03019b839cf5046fd3381a957b68e019466cb63566fcf37cc75528ac75983cf9ef4cc8b1297d6c99e2765fcbd35fbeccd1b98a3e86535c512eef146b6716ff9637a2adc377f37f7aca4b7a992e5dab990b056ae1584961df1f1d74d0c4bee67175abdbf5548b5d655fdb7969e08fab2dca9d7f392d5960c0628bcc538d22e7d57051107181ba01663720907f46cb3c9262199db0ad302d44a5f97dfc86079a60aba7a28de5722e331a6c38b25dd2ce35677be29",
    };

    for( ulong i=0; i<sizeof(tests)/8/2; i++ ) {
      ulong in_sz = strlen( tests[2*i] ) / 2;

      fd_hex_decode( in, tests[2*i], in_sz );

      FD_TEST( fd_bls12_381_g2_add_syscall( r, a, b, 1 /*BE*/ )==0 );

      ulong out_sz = strlen( tests[2*i+1] ) / 2;
      fd_hex_decode( re, tests[2*i+1], out_sz );
      if( !fd_memeq( r, re, out_sz ) ) {
        FD_LOG_HEXDUMP_WARNING(( "res", r, out_sz ));
        FD_LOG_HEXDUMP_WARNING(( "exp", re, out_sz ));
        FD_LOG_ERR(( "FAIL: fd_bls12_381_g2_add_syscall big_endian=1 %lu, %s", i, "res != exp" ));
      }
    }
  }
  {
    const char * tests[] = {
      // test 1
      "ae56b090b9dae592a9b7a4acf7377f37dc2a7a63f96f71b646f1ee12c53565e8a3981bcdecfb35bdfc65279ec9d697128bccf49ecf8359c78a5275cc37cf6f5663cb6694018eb657a98133fd4650cf39b81930c0d83e13a3837bae043e15530b29be7756e32cdd258bc3a631e32257de287aba0aa67960c8df975f4ad402d30adb992126c9b36cf40709726316a01b18071105577d2ed238c5bc28060c96d592f3d7a9dcb2fa089e96b7fd55d6b54855bfbd5a1767ee4b0c4dd7f1f11d968415ae56b090b9dae592a9b7a4acf7377f37dc2a7a63f96f71b646f1ee12c53565e8a3981bcdecfb35bdfc65279ec9d697128bccf49ecf8359c78a5275cc37cf6f5663cb6694018eb657a98133fd4650cf39b81930c0d83e13a3837bae043e15530b29be7756e32cdd258bc3a631e32257de287aba0aa67960c8df975f4ad402d30adb992126c9b36cf40709726316a01b18071105577d2ed238c5bc28060c96d592f3d7a9dcb2fa089e96b7fd55d6b54855bfbd5a1767ee4b0c4dd7f1f11d968415",
      "cebdcbf007e62c103726305faa7a9afdcbf005d8b228e108012b86a9a747dca4e9e4f0080bde0695219370203db8ae0e4d52ed7add5f2b1ccb7cde385ff9c50fe5f3e7e50ff6ab16ea56367dc447f039920828a492a2791676b712299ce83015301f5196a0f6818723b72e215aedb73478ae18bddb9a4fbf954006b97376f738907ca568dbdd7880b804a585fc967b02d605a25c5dd2d296ee25870c42a8488dbfa15db146fc06bb16a5feeed3ef0bbbcd886cc71395bcd5276817b7a7834d17",
      // test 2
      "ae56b090b9dae592a9b7a4acf7377f37dc2a7a63f96f71b646f1ee12c53565e8a3981bcdecfb35bdfc65279ec9d697128bccf49ecf8359c78a5275cc37cf6f5663cb6694018eb657a98133fd4650cf39b81930c0d83e13a3837bae043e15530b29be7756e32cdd258bc3a631e32257de287aba0aa67960c8df975f4ad402d30adb992126c9b36cf40709726316a01b18071105577d2ed238c5bc28060c96d592f3d7a9dcb2fa089e96b7fd55d6b54855bfbd5a1767ee4b0c4dd7f1f11d968415000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      "ae56b090b9dae592a9b7a4acf7377f37dc2a7a63f96f71b646f1ee12c53565e8a3981bcdecfb35bdfc65279ec9d697128bccf49ecf8359c78a5275cc37cf6f5663cb6694018eb657a98133fd4650cf39b81930c0d83e13a3837bae043e15530b29be7756e32cdd258bc3a631e32257de287aba0aa67960c8df975f4ad402d30adb992126c9b36cf40709726316a01b18071105577d2ed238c5bc28060c96d592f3d7a9dcb2fa089e96b7fd55d6b54855bfbd5a1767ee4b0c4dd7f1f11d968415",
      // test 3
      "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      // test - ec0
      "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ae56b090b9dae592a9b7a4acf7377f37dc2a7a63f96f71b646f1ee12c53565e8a3981bcdecfb35bdfc65279ec9d697128bccf49ecf8359c78a5275cc37cf6f5663cb6694018eb657a98133fd4650cf39b81930c0d83e13a3837bae043e15530b29be7756e32cdd258bc3a631e32257de287aba0aa67960c8df975f4ad402d30adb992126c9b36cf40709726316a01b18071105577d2ed238c5bc28060c96d592f3d7a9dcb2fa089e96b7fd55d6b54855bfbd5a1767ee4b0c4dd7f1f11d968415",
      "ae56b090b9dae592a9b7a4acf7377f37dc2a7a63f96f71b646f1ee12c53565e8a3981bcdecfb35bdfc65279ec9d697128bccf49ecf8359c78a5275cc37cf6f5663cb6694018eb657a98133fd4650cf39b81930c0d83e13a3837bae043e15530b29be7756e32cdd258bc3a631e32257de287aba0aa67960c8df975f4ad402d30adb992126c9b36cf40709726316a01b18071105577d2ed238c5bc28060c96d592f3d7a9dcb2fa089e96b7fd55d6b54855bfbd5a1767ee4b0c4dd7f1f11d968415",
      // test 0
      "ae56b090b9dae592a9b7a4acf7377f37dc2a7a63f96f71b646f1ee12c53565e8a3981bcdecfb35bdfc65279ec9d697128bccf49ecf8359c78a5275cc37cf6f5663cb6694018eb657a98133fd4650cf39b81930c0d83e13a3837bae043e15530b29be7756e32cdd258bc3a631e32257de287aba0aa67960c8df975f4ad402d30adb992126c9b36cf40709726316a01b18071105577d2ed238c5bc28060c96d592f3d7a9dcb2fa089e96b7fd55d6b54855bfbd5a1767ee4b0c4dd7f1f11d96841529dabc3ffbe00b8f10d1a51d025a1bb0c3b986b8cb44b5118fb3b2bb18ee6fb52459c35e2905b5bf82870c14649e5b19599c988b215a4b0221b14b67dff6c98dea00bbc58005e58894314f6962a24524bc357e6bcd271c5e7d914a2eaeb46e0e47270189fcf343f7bea191b3a5954e4e56033be8bf21d70ec311cf5a2788b0c3135c8898d0845fcd31551178040bde074112d608d211c9ad4031f8a27f245d854716f7fd53a1b7fdfe948bddf72bf59c660560c86da2c2c8a0506cca5a5b4717",
      "37bd7e5cd59ac7c0beb0cdfcc662ec3b0ffc06bbdce49d1d7c4e71f816bf25513e0c14ddf90b8bbf7bba28467a4a920f536249eed2dc77aa3987609a6a4006d242c6c538d85c1f6c1fa18010a60ca1294c442521c9625b18ae18389cfb0a9d15596784e35db1177dcf93509e5b8bbe7910495889213ee809c0ce750cce46cf27f4440dc8c97dc9ca7674c9c1f724f8051136cf7b1c234c2974bacbb3fe9ddc8f6233c7e69dd42e072f80d1411c5377477c0b327dd76082b46a1fbe800f086d02",
    };

    for( ulong i=0; i<sizeof(tests)/8/2; i++ ) {
      ulong in_sz = strlen( tests[2*i] ) / 2;

      fd_hex_decode( in, tests[2*i], in_sz );

      FD_TEST( fd_bls12_381_g2_add_syscall( r, a, b, 0 /*LE*/ )==0 );

      ulong out_sz = strlen( tests[2*i+1] ) / 2;
      fd_hex_decode( re, tests[2*i+1], out_sz );
      if( !fd_memeq( r, re, out_sz ) ) {
        FD_LOG_HEXDUMP_WARNING(( "res", r, out_sz ));
        FD_LOG_HEXDUMP_WARNING(( "exp", re, out_sz ));
        FD_LOG_ERR(( "FAIL: fd_bls12_381_g2_add_syscall big_endian=0 %lu, %s", i, "res != exp" ));
      }
    }
  }
  {
    ulong iter = 10000UL;
    long dt = fd_log_wallclock();
    for( ulong rem=iter; rem; rem-- ) {
      fd_bls12_381_g2_add_syscall( r, a, b, 0 /*LE*/ );
    }
    dt = fd_log_wallclock() - dt;
    log_bench( "fd_bls12_381_g2_add_syscall", iter, dt );
  }
}

static void
test_g2_sub( FD_FN_UNUSED fd_rng_t * rng ) {
  // test correctness
  //
  uchar in[96*2*2] = { 0 };
  uchar re[96*2] = { 0 };
  uchar * a = in;
  uchar * b = in+96*2;
  uchar r[96*2] = { 0 };

  {
    const char * tests[] = {
      // test 0
      "016f712aa580c21a828e3ac63df471401960c40cd337d5556dd2d3b160300f7a9bada610715ffd45c40fbbc9cfff51b00f4d18c74e8e17b137763ef87b29d548a9b105b0c59e3e0105dbbe5c242575a2ca09e7c70d486624f6f13444b92cee171701c01c3d67ec4a2e1c4043c2f3d0ba2ec98e07a68b72d765ea6cb85d873db09ad01c4fd2846015c70b49d228f16bd708cb9c02d321cbc47cac94e879746de20f0d93f114461c0a11338f8c237f6d07cadcd0610ba7775ec05ca5d7e6a010380e496559d3550573945152d88d9432ae1156f6922ae6b5fa2840f87906a775bedb6039507fea8db39a6d0552e9fe0730056cfdc41090518cfcb8ecc161c881df841c877981813c214d2bb5b43ce06c7fcf70364251b9a67836a937ee20dbacd418a56acf144482e9be4bb1119d70ae58bdb67edb7288430fa78532ac7c5e0895cbe823da908e4a965eb6216a6f78cb3b0a794ff876a5e839573c2adf62689eee44983b13ac5914ee3f31cc8a6cc30ae9514fd76b2bc5bee70f0efbcbb3cde0c3",
      "0fc0dceaf67e8da36ba22b75ab9ec384c4d6ed85628570f8a19403a3141a3188a1f424b3edcc3a16336a0004eff4f259050e951f4ed54699932b5413df64eb3dac4288c90b51a888cf2ec6d0ab90bb234d3aba93bff3090ce016e62470f672130d74ba3e9eb0c996bb0d20878c6cb2ae5ad432b8ee11e5a7c368b39ca6fb6373851990652d4613565bf7ec5dfc0e6ad40f2a3e68a2d808b49c34feb31d5f5e10f5d7a5437332babee3d5477e1d51d92b9d0c6469d3ac65d4498c956dfcb46216",
      // test 1
      "016f712aa580c21a828e3ac63df471401960c40cd337d5556dd2d3b160300f7a9bada610715ffd45c40fbbc9cfff51b00f4d18c74e8e17b137763ef87b29d548a9b105b0c59e3e0105dbbe5c242575a2ca09e7c70d486624f6f13444b92cee171701c01c3d67ec4a2e1c4043c2f3d0ba2ec98e07a68b72d765ea6cb85d873db09ad01c4fd2846015c70b49d228f16bd708cb9c02d321cbc47cac94e879746de20f0d93f114461c0a11338f8c237f6d07cadcd0610ba7775ec05ca5d7e6a01038016f712aa580c21a828e3ac63df471401960c40cd337d5556dd2d3b160300f7a9bada610715ffd45c40fbbc9cfff51b00f4d18c74e8e17b137763ef87b29d548a9b105b0c59e3e0105dbbe5c242575a2ca09e7c70d486624f6f13444b92cee171701c01c3d67ec4a2e1c4043c2f3d0ba2ec98e07a68b72d765ea6cb85d873db09ad01c4fd2846015c70b49d228f16bd708cb9c02d321cbc47cac94e879746de20f0d93f114461c0a11338f8c237f6d07cadcd0610ba7775ec05ca5d7e6a01038",
      "400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      // test 2
      "400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000016f712aa580c21a828e3ac63df471401960c40cd337d5556dd2d3b160300f7a9bada610715ffd45c40fbbc9cfff51b00f4d18c74e8e17b137763ef87b29d548a9b105b0c59e3e0105dbbe5c242575a2ca09e7c70d486624f6f13444b92cee171701c01c3d67ec4a2e1c4043c2f3d0ba2ec98e07a68b72d765ea6cb85d873db09ad01c4fd2846015c70b49d228f16bd708cb9c02d321cbc47cac94e879746de20f0d93f114461c0a11338f8c237f6d07cadcd0610ba7775ec05ca5d7e6a01038",
      "016f712aa580c21a828e3ac63df471401960c40cd337d5556dd2d3b160300f7a9bada610715ffd45c40fbbc9cfff51b00f4d18c74e8e17b137763ef87b29d548a9b105b0c59e3e0105dbbe5c242575a2ca09e7c70d486624f6f13444b92cee1702ff51cdfc17fa501cff67728057dc1d35adbd7d4cf99fe8014665e89929b87383dbe3aedecf9fe9f2f3b62dd70e3ed4113575e7665e1ad5ce6f12cdc9d73ef55569b793df3ef6b555fd4314d331891c53cf2f9da5ac88a0f9a25a28195f9a73",
      // test 3
      "016f712aa580c21a828e3ac63df471401960c40cd337d5556dd2d3b160300f7a9bada610715ffd45c40fbbc9cfff51b00f4d18c74e8e17b137763ef87b29d548a9b105b0c59e3e0105dbbe5c242575a2ca09e7c70d486624f6f13444b92cee171701c01c3d67ec4a2e1c4043c2f3d0ba2ec98e07a68b72d765ea6cb85d873db09ad01c4fd2846015c70b49d228f16bd708cb9c02d321cbc47cac94e879746de20f0d93f114461c0a11338f8c237f6d07cadcd0610ba7775ec05ca5d7e6a01038400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      "016f712aa580c21a828e3ac63df471401960c40cd337d5556dd2d3b160300f7a9bada610715ffd45c40fbbc9cfff51b00f4d18c74e8e17b137763ef87b29d548a9b105b0c59e3e0105dbbe5c242575a2ca09e7c70d486624f6f13444b92cee171701c01c3d67ec4a2e1c4043c2f3d0ba2ec98e07a68b72d765ea6cb85d873db09ad01c4fd2846015c70b49d228f16bd708cb9c02d321cbc47cac94e879746de20f0d93f114461c0a11338f8c237f6d07cadcd0610ba7775ec05ca5d7e6a01038",
      // test - ec0
      "400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      "400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
    };

    for( ulong i=0; i<sizeof(tests)/8/2; i++ ) {
      ulong in_sz = strlen( tests[2*i] ) / 2;

      fd_hex_decode( in, tests[2*i], in_sz );

      FD_TEST( fd_bls12_381_g2_sub_syscall( r, a, b, 1 /*BE*/ )==0 );

      ulong out_sz = strlen( tests[2*i+1] ) / 2;
      fd_hex_decode( re, tests[2*i+1], out_sz );
      if( !fd_memeq( r, re, out_sz ) ) {
        FD_LOG_HEXDUMP_WARNING(( "res", r, out_sz ));
        FD_LOG_HEXDUMP_WARNING(( "exp", re, out_sz ));
        FD_LOG_ERR(( "FAIL: fd_bls12_381_g2_sub_syscall big_endian=1 %lu, %s", i, "res != exp" ));
      }
    }
  }
  {
    const char * tests[] = {
      // test 1
      "17ee2cb94434f1f62466480dc7e709caa27525245cbedb05013e9ec5b005b1a948d5297bf83e7637b1178e4ec7184d0fb051ffcfc9bb0fc445fd5f7110a6ad9b7a0f3060b1d3d26d55d537d30cc460194071f43dc63a8e821ac280a52a716f013810a0e6d7a55cc05e77a70b61d0dcca076d7f238c8f33110a1c4614f1930d0fe26d7479e894ac7cc4cb21d3029ccb08d76bf128d2490bc7156084d24f1cd09ab03d875db86cea65d7728ba6078ec92ebad0f3c243401c2e4aec673d1cc0011717ee2cb94434f1f62466480dc7e709caa27525245cbedb05013e9ec5b005b1a948d5297bf83e7637b1178e4ec7184d0fb051ffcfc9bb0fc445fd5f7110a6ad9b7a0f3060b1d3d26d55d537d30cc460194071f43dc63a8e821ac280a52a716f013810a0e6d7a55cc05e77a70b61d0dcca076d7f238c8f33110a1c4614f1930d0fe26d7479e894ac7cc4cb21d3029ccb08d76bf128d2490bc7156084d24f1cd09ab03d875db86cea65d7728ba6078ec92ebad0f3c243401c2e4aec673d1cc00117",
      "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      // test 2
      "00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000017ee2cb94434f1f62466480dc7e709caa27525245cbedb05013e9ec5b005b1a948d5297bf83e7637b1178e4ec7184d0fb051ffcfc9bb0fc445fd5f7110a6ad9b7a0f3060b1d3d26d55d537d30cc460194071f43dc63a8e821ac280a52a716f013810a0e6d7a55cc05e77a70b61d0dcca076d7f238c8f33110a1c4614f1930d0fe26d7479e894ac7cc4cb21d3029ccb08d76bf128d2490bc7156084d24f1cd09ab03d875db86cea65d7728ba6078ec92ebad0f3c243401c2e4aec673d1cc00117",
      "17ee2cb94434f1f62466480dc7e709caa27525245cbedb05013e9ec5b005b1a948d5297bf83e7637b1178e4ec7184d0fb051ffcfc9bb0fc445fd5f7110a6ad9b7a0f3060b1d3d26d55d537d30cc460194071f43dc63a8e821ac280a52a716f01739a5f19285aa2f9a088aca59d2fcf531c8931d31443fd55b5f63edf93b76955f53ed7c9cd126fced51a5e66e7753511d43e0ed72db6f3f2e99fcfdeaee3db8373b82999e8654601e89ff94c7dbdad351ddc57807267ff1c50fa17fccd51ff02",
      // test 3
      "17ee2cb94434f1f62466480dc7e709caa27525245cbedb05013e9ec5b005b1a948d5297bf83e7637b1178e4ec7184d0fb051ffcfc9bb0fc445fd5f7110a6ad9b7a0f3060b1d3d26d55d537d30cc460194071f43dc63a8e821ac280a52a716f013810a0e6d7a55cc05e77a70b61d0dcca076d7f238c8f33110a1c4614f1930d0fe26d7479e894ac7cc4cb21d3029ccb08d76bf128d2490bc7156084d24f1cd09ab03d875db86cea65d7728ba6078ec92ebad0f3c243401c2e4aec673d1cc00117000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      "17ee2cb94434f1f62466480dc7e709caa27525245cbedb05013e9ec5b005b1a948d5297bf83e7637b1178e4ec7184d0fb051ffcfc9bb0fc445fd5f7110a6ad9b7a0f3060b1d3d26d55d537d30cc460194071f43dc63a8e821ac280a52a716f013810a0e6d7a55cc05e77a70b61d0dcca076d7f238c8f33110a1c4614f1930d0fe26d7479e894ac7cc4cb21d3029ccb08d76bf128d2490bc7156084d24f1cd09ab03d875db86cea65d7728ba6078ec92ebad0f3c243401c2e4aec673d1cc00117",
      // test - ec0
      "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      // test 0
      "17ee2cb94434f1f62466480dc7e709caa27525245cbedb05013e9ec5b005b1a948d5297bf83e7637b1178e4ec7184d0fb051ffcfc9bb0fc445fd5f7110a6ad9b7a0f3060b1d3d26d55d537d30cc460194071f43dc63a8e821ac280a52a716f013810a0e6d7a55cc05e77a70b61d0dcca076d7f238c8f33110a1c4614f1930d0fe26d7479e894ac7cc4cb21d3029ccb08d76bf128d2490bc7156084d24f1cd09ab03d875db86cea65d7728ba6078ec92ebad0f3c243401c2e4aec673d1cc00117d4acdb20ee37a93678a6b951423670cf7f6ce03cb4b52b4d213c818179871c84df81c861c1ecb8fc8c519010c4fd6c053007fee952056d9ab38dea7f503960dbbe75a70679f84028fab5e62a92f65611ae32948dd8525194730555d35965490ec3e0cdb3cbfb0e0fe7bec52b6bd74f51e90ac36c8acc313fee1459ac133b9844ee9e6862df2a3c5739e8a576f84f790a3bcb786f6a21b65e964a8e90da23e8cb95085e7cac3285a70f438872db7eb6bd58ae709d11b14bbee9824414cf6aa518",
      "1372f67024e616e00c09f3bf93ba3a4d23bb90abd0c62ecf88a8510bc98842ac3deb64df13542b939946d54e1f950e0559f2f4ef04006a33163accedb324f4a188311a14a30394a1f870856285edd6c484c39eab752ba26ba38d7ef6eadcc00f1662b4fc6d958c49d465acd369640c9d2bd9511d7e47d5e3beba327343a5d7f5105e5f1db3fe349cb408d8a2683e2a0fd46a0efc5decf75b5613462d659019857363fba69cb368c3a7e511eeb832d45aaeb26c8c87200dbb96c9b09e3eba740d",
    };

    for( ulong i=0; i<sizeof(tests)/8/2; i++ ) {
      ulong in_sz = strlen( tests[2*i] ) / 2;

      fd_hex_decode( in, tests[2*i], in_sz );

      FD_TEST( fd_bls12_381_g2_sub_syscall( r, a, b, 0 /*LE*/ )==0 );

      ulong out_sz = strlen( tests[2*i+1] ) / 2;
      fd_hex_decode( re, tests[2*i+1], out_sz );
      if( !fd_memeq( r, re, out_sz ) ) {
        FD_LOG_HEXDUMP_WARNING(( "res", r, out_sz ));
        FD_LOG_HEXDUMP_WARNING(( "exp", re, out_sz ));
        FD_LOG_ERR(( "FAIL: fd_bls12_381_g2_sub_syscall big_endian=0 %lu, %s", i, "res != exp" ));
      }
    }
  }
  {
    ulong iter = 10000UL;
    long dt = fd_log_wallclock();
    for( ulong rem=iter; rem; rem-- ) {
      fd_bls12_381_g2_sub_syscall( r, a, b, 0 /*LE*/ );
    }
    dt = fd_log_wallclock() - dt;
    log_bench( "fd_bls12_381_g2_sub_syscall", iter, dt );
  }
}

static void
test_g2_mul( FD_FN_UNUSED fd_rng_t * rng ) {
  // test correctness
  //
  uchar in[96*2+32] = { 0 };
  uchar re[96*2] = { 0 };
  uchar * a = in;
  uchar * b = in+96*2;
  uchar r[96*2] = { 0 };

  {
    const char * tests[] = {
      // test 0
      "015f105a75b9fd4c1944366f9aa17dcb79049a43cd9d4c0980e02551d6e2473be0bb9899c73e3a4a89f52e659b11d440058600b91384cd654dcc763f47acd01dd23d3304bebfd3af69f5cc393854d2b8eba9e7a18053fceae3ffa6dbc9b0a91014dacb26b562d559987be6c9045f2a561d8943e9e6a1cee7c9b04f0cc538d424ebd8a01bdd637cdc854c7bd1c84e7a2410ab12f76f6f8426f0b71b4c87d388ca375df6ebbf92b7a16e81043aee3b4df23858609692f789e68923096c5f7f4b4e1dc06f97bb256d5b81dfbce1750378a26b429fff3d802920f25fe8ca6abc9a93",
      "0a5c58c01ac82680bc94fe10ca27aefc216f2979d309d18a2b687ad604fb2251245c8f1397d56ff0640f214a7b8fb599066b52608d933fc80d1f4205b8871852bdf03afa303d840d17f01feefc21bff1265addc9a489625c94f6e116ef6361b314fb27720e9ca5b63ae96429223b776728ce32afdf7e9211a10e542b953ad4c5fa0fd07a210457db52c90c0b2c4c3bb6124c26b8af0bd30440852968b9993ff627912671a2b74d023386f3c44a6fb7a9dee4bf358135ba5e61901f75dacfd6bd",
      // test 1
      "015f105a75b9fd4c1944366f9aa17dcb79049a43cd9d4c0980e02551d6e2473be0bb9899c73e3a4a89f52e659b11d440058600b91384cd654dcc763f47acd01dd23d3304bebfd3af69f5cc393854d2b8eba9e7a18053fceae3ffa6dbc9b0a91014dacb26b562d559987be6c9045f2a561d8943e9e6a1cee7c9b04f0cc538d424ebd8a01bdd637cdc854c7bd1c84e7a2410ab12f76f6f8426f0b71b4c87d388ca375df6ebbf92b7a16e81043aee3b4df23858609692f789e68923096c5f7f4b4e0000000000000000000000000000000000000000000000000000000000000000",
      "400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      // test 2
      "015f105a75b9fd4c1944366f9aa17dcb79049a43cd9d4c0980e02551d6e2473be0bb9899c73e3a4a89f52e659b11d440058600b91384cd654dcc763f47acd01dd23d3304bebfd3af69f5cc393854d2b8eba9e7a18053fceae3ffa6dbc9b0a91014dacb26b562d559987be6c9045f2a561d8943e9e6a1cee7c9b04f0cc538d424ebd8a01bdd637cdc854c7bd1c84e7a2410ab12f76f6f8426f0b71b4c87d388ca375df6ebbf92b7a16e81043aee3b4df23858609692f789e68923096c5f7f4b4e0000000000000000000000000000000000000000000000000000000000000001",
      "015f105a75b9fd4c1944366f9aa17dcb79049a43cd9d4c0980e02551d6e2473be0bb9899c73e3a4a89f52e659b11d440058600b91384cd654dcc763f47acd01dd23d3304bebfd3af69f5cc393854d2b8eba9e7a18053fceae3ffa6dbc9b0a91014dacb26b562d559987be6c9045f2a561d8943e9e6a1cee7c9b04f0cc538d424ebd8a01bdd637cdc854c7bd1c84e7a2410ab12f76f6f8426f0b71b4c87d388ca375df6ebbf92b7a16e81043aee3b4df23858609692f789e68923096c5f7f4b4e",
      // test 3
      "015f105a75b9fd4c1944366f9aa17dcb79049a43cd9d4c0980e02551d6e2473be0bb9899c73e3a4a89f52e659b11d440058600b91384cd654dcc763f47acd01dd23d3304bebfd3af69f5cc393854d2b8eba9e7a18053fceae3ffa6dbc9b0a91014dacb26b562d559987be6c9045f2a561d8943e9e6a1cee7c9b04f0cc538d424ebd8a01bdd637cdc854c7bd1c84e7a2410ab12f76f6f8426f0b71b4c87d388ca375df6ebbf92b7a16e81043aee3b4df23858609692f789e68923096c5f7f4b4e73eda753299d7d483339d80809a1d80553bda402fffe5bfeffffffff00000000",
      "015f105a75b9fd4c1944366f9aa17dcb79049a43cd9d4c0980e02551d6e2473be0bb9899c73e3a4a89f52e659b11d440058600b91384cd654dcc763f47acd01dd23d3304bebfd3af69f5cc393854d2b8eba9e7a18053fceae3ffa6dbc9b0a910052646c3841d1140b29fc0ed3eec828146ee079b0ce343d79d808394317821ff32d35fe2d3f0832334b2842e37b130870955fef2ca1062735a648c69bb78240d2d19549933f25b1df8afce660875a831e6539f681e5c761930dbf693a0805f5d",
      // test 4
      "4000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001dc06f97bb256d5b81dfbce1750378a26b429fff3d802920f25fe8ca6abc9a93",
      "400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
    };

    for( ulong i=0; i<sizeof(tests)/8/2; i++ ) {
      ulong in_sz = strlen( tests[2*i] ) / 2;

      fd_hex_decode( in, tests[2*i], in_sz );

      FD_TEST( fd_bls12_381_g2_mul_syscall( r, a, b, 1 /*BE*/ )==0 );

      ulong out_sz = strlen( tests[2*i+1] ) / 2;
      fd_hex_decode( re, tests[2*i+1], out_sz );
      if( !fd_memeq( r, re, out_sz ) ) {
        FD_LOG_HEXDUMP_WARNING(( "res", r, out_sz ));
        FD_LOG_HEXDUMP_WARNING(( "exp", re, out_sz ));
        FD_LOG_ERR(( "FAIL: fd_bls12_381_g2_mul_syscall big_endian=1 %lu, %s", i, "res != exp" ));
      }
    }
  }
  {
    const char * tests[] = {
      // test 1
      "10a9b0c9dba6ffe3eafc5380a1e7a9ebb8d2543839ccf569afd3bfbe04333dd21dd0ac473f76cc4d65cd8413b900860540d4119b652ef5894a3a3ec79998bbe03b47e2d65125e080094c9dcd439a0479cb7da19a6f3644194cfdb9755a105f014e4b7f5f6c092389e689f79296605838f24d3bee3a04816ea1b792bfebf65d37ca88d3874c1bb7f026846f6ff712ab10247a4ec8d17b4c85dc7c63dd1ba0d8eb24d438c50c4fb0c9e7cea1e6e943891d562a5f04c9e67b9859d562b526cbda140000000000000000000000000000000000000000000000000000000000000000",
      "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      // test 2
      "10a9b0c9dba6ffe3eafc5380a1e7a9ebb8d2543839ccf569afd3bfbe04333dd21dd0ac473f76cc4d65cd8413b900860540d4119b652ef5894a3a3ec79998bbe03b47e2d65125e080094c9dcd439a0479cb7da19a6f3644194cfdb9755a105f014e4b7f5f6c092389e689f79296605838f24d3bee3a04816ea1b792bfebf65d37ca88d3874c1bb7f026846f6ff712ab10247a4ec8d17b4c85dc7c63dd1ba0d8eb24d438c50c4fb0c9e7cea1e6e943891d562a5f04c9e67b9859d562b526cbda140100000000000000000000000000000000000000000000000000000000000000",
      "10a9b0c9dba6ffe3eafc5380a1e7a9ebb8d2543839ccf569afd3bfbe04333dd21dd0ac473f76cc4d65cd8413b900860540d4119b652ef5894a3a3ec79998bbe03b47e2d65125e080094c9dcd439a0479cb7da19a6f3644194cfdb9755a105f014e4b7f5f6c092389e689f79296605838f24d3bee3a04816ea1b792bfebf65d37ca88d3874c1bb7f026846f6ff712ab10247a4ec8d17b4c85dc7c63dd1ba0d8eb24d438c50c4fb0c9e7cea1e6e943891d562a5f04c9e67b9859d562b526cbda14",
      // test 3
      "10a9b0c9dba6ffe3eafc5380a1e7a9ebb8d2543839ccf569afd3bfbe04333dd21dd0ac473f76cc4d65cd8413b900860540d4119b652ef5894a3a3ec79998bbe03b47e2d65125e080094c9dcd439a0479cb7da19a6f3644194cfdb9755a105f014e4b7f5f6c092389e689f79296605838f24d3bee3a04816ea1b792bfebf65d37ca88d3874c1bb7f026846f6ff712ab10247a4ec8d17b4c85dc7c63dd1ba0d8eb24d438c50c4fb0c9e7cea1e6e943891d562a5f04c9e67b9859d562b526cbda1400000000fffffffffe5bfeff02a4bd5305d8a10908d83933487d9d2953a7ed73",
      "10a9b0c9dba6ffe3eafc5380a1e7a9ebb8d2543839ccf569afd3bfbe04333dd21dd0ac473f76cc4d65cd8413b900860540d4119b652ef5894a3a3ec79998bbe03b47e2d65125e080094c9dcd439a0479cb7da19a6f3644194cfdb9755a105f015d5f80a093f6db3019765c1e689f53e631a8750866ceaff81d5bf2339954192d0d2478bb698c645a736210caf2fe55098730b1372e84b2342383f0d3e25fd332ff2178319483809dd743e30c9b07ee468182ec3eedc09fb240111d84c3462605",
      // test - ec0
      "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000939abc6acae85ff22029803dff9f426ba2780375e1bcdf815b6d25bb976fc01d",
      "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      // test 0
      "10a9b0c9dba6ffe3eafc5380a1e7a9ebb8d2543839ccf569afd3bfbe04333dd21dd0ac473f76cc4d65cd8413b900860540d4119b652ef5894a3a3ec79998bbe03b47e2d65125e080094c9dcd439a0479cb7da19a6f3644194cfdb9755a105f014e4b7f5f6c092389e689f79296605838f24d3bee3a04816ea1b792bfebf65d37ca88d3874c1bb7f026846f6ff712ab10247a4ec8d17b4c85dc7c63dd1ba0d8eb24d438c50c4fb0c9e7cea1e6e943891d562a5f04c9e67b9859d562b526cbda14939abc6acae85ff22029803dff9f426ba2780375e1bcdf815b6d25bb976fc01d",
      "b36163ef16e1f6945c6289a4c9dd5a26f1bf21fcee1ff0170d843d30fa3af0bd521887b805421f0dc83f938d60526b0699b58f7b4a210f64f06fd597138f5c245122fb04d67a682b8ad109d379296f21fcae27ca10fe94bc8026c81ac0585c0abdd6cfda751f90615eba358135bfe4dea9b76f4ac4f38633024db7a271269127f63f99b96829854004d30bafb8264c12b63b4c2c0b0cc952db5704217ad00ffac5d43a952b540ea111927edfaf32ce2867773b222964e93ab6a59c0e7227fb14",
    };

    for( ulong i=0; i<sizeof(tests)/8/2; i++ ) {
      ulong in_sz = strlen( tests[2*i] ) / 2;

      fd_hex_decode( in, tests[2*i], in_sz );

      FD_TEST( fd_bls12_381_g2_mul_syscall( r, a, b, 0 /*LE*/ )==0 );

      ulong out_sz = strlen( tests[2*i+1] ) / 2;
      fd_hex_decode( re, tests[2*i+1], out_sz );
      if( !fd_memeq( r, re, out_sz ) ) {
        FD_LOG_HEXDUMP_WARNING(( "res", r, out_sz ));
        FD_LOG_HEXDUMP_WARNING(( "exp", re, out_sz ));
        FD_LOG_ERR(( "FAIL: fd_bls12_381_g2_mul_syscall big_endian=0 %lu, %s", i, "res != exp" ));
      }
    }
  }
  {
    ulong iter = 100UL;
    long dt = fd_log_wallclock();
    for( ulong rem=iter; rem; rem-- ) {
      fd_bls12_381_g2_mul_syscall( r, a, b, 0 /*LE*/ );
    }
    dt = fd_log_wallclock() - dt;
    log_bench( "fd_bls12_381_g2_mul_syscall", iter, dt );
  }
}

static void
test_pairing( FD_FN_UNUSED fd_rng_t * rng ) {
  // test correctness
  //
  uchar in[96*3*4] = { 0 };
  uchar re[48*12] = { 0 };
  // uchar a[ 96*4 ] = { 0 };
  // uchar b[ 96*2*4 ] = { 0 };
  uchar * a = in;
  uchar * b = NULL;
  uchar r[48*12] = { 0 };
  ulong n;

  {
    const char * tests[] = {
      // test 0
      "",
      "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001",
      // test 1
      "03a16836f27410320f712a266c0b7f402bf93285690885ee2206bd7799244b4157f95a6d85c8cb197f44fbf30ed2cc23127c950544b239e6fd9ac0a3059290640766094c43fb932d1b6fccd5db8d3a0beb6406dc4de6e8c8d2c803b80a5017a408f9da9ae87dfab9993c849bbc7732cd204cb8b5a49e400cb3b5965fe209af33a9b922b2f9a11ba4d26babcbf60b9e560e87c5e1072c5ef3d8c864c7760e6ab558cacf9ce3657eec2ebdee49dc769749fff96767ffb95b52d4946e13d46fc7c504901991c48ecdfc555530f3d13e39d42c955171ab3cc149280b2478133e021916e8e332234baccd02251b41b6064a2b01ef6981b862d7510f13ab27fc39b0abb5477cfb35cad5213aaf342959e6d9b1201852a6f0e8df188d46791933ad1e06",
      "0e39a48076e53ac2a3b3079b131bc3b8f7f6534c3f4778488f8202c023fb24e8e57a447e36e4c5f970ea5d8285f64b290d1fe8e169dbb469e1b82b39b80ae493f5e32844d7d90fa40ee777867821d234402f272aabdde13af9f7cca11410670100a86d9ddf3c930b4c025f56ae04647d7ce21f9fc7a031624c7cdd6506d56f2c18ac4e2ad8895b44d328d2acf21d73dc0b9cf975760c3b3b5789d9be903ef967f4f79870ee1f7a88270931d716b4a478a6733e8204d8399b08d67409dea822f2132fb77cc4de3a874b61f2e7beeea2327ce6e5ac9c8cc4a3d5319990a7767aa746cb9178ed2e878200cc8b3d160af3e80f26a1926a8a56c608a7e57d5f1c783317a1fa697db1a9a8610500e78f8d165c8f945f42979a37a9005b6b053bfc088c00c34087c5e2ebaa7fb0d907b4ebde3ac3ddc082568f00c7e13539b5979851b7fcfb057c3da485a90e14ce243801c5d6170a20df8057a6213d1dbe5a9652796dffd34f2e3930d57d085d0a97a2898581ed654d27555eea2b5565f0e95d39ab0d12261f1d29a9c1316c77e782612d23fc957d7440a346288fa00e0f5ba8cf4d284ad072324077d8b660da00b94569c267138121ccfaedbf8f7a38ea3e08e001f26e0ac2b2c6dc97a7eaebcf945df9dd990f56594c311d124a00f62a8f593c306017add1d59c509a9fa10cb2e1e24d63f99af66e60b04f5a02be3fbd7baace778e8a0f5dbfe6649f8e3277cc9dc9e65d39037d60c3f7c34c18b06358ce563fcc25adb67433f00f9bc7c7c6b72cf1fbec23b224086b5299901c1de5969d25d86074",
      // test 2
      "175a43b5fe41d4c82fda24056e7a619b70d696a20f79bc741c75d061e1b08ac0f403697e210b010439db8355d0d80d7d089a02374427c924b351810e28b5e28ee154f5aac6db4946b7a028f2f8061edc9b95e08cdea0d6467866025687a64f0a15a846c4c74f9865abed2351cc5115f057f4e2e49953107c8bd47cfff311b4c39f13713d982ef2e901ccf29a80f816a20b5c9c986f714412c0ac5a2d57cd3603bd610b0a059091a3c440fd0846d0fa40aeccc507f17b26f84e081621996d9da310372e978ef56f3b48ba20d9fea571435900e6a8d6efdbb593f863f03d47aeb63859da16c3777148735992ba08e687c211c28ef231375b6b4d15fe8732e18c20d87ce93adb11f7cd6e18150ac2fa49fed1e955ab77bbb0ba91800cc2cc063044163cab96ec515f603aa1362d0742bb67091159b4ab56f31e2642e2004cffdadd5327b0d272bf12f0ac21dacc6932afd217a9953cd7717ba6a3f415025ccefaa99eaa5d5233713a5354bd5e775de6c340da25e2a91c9ca2e934a9f53f96569522171d23a93e201136ad66ea9ba535ea9a0d995fe2f669d04a90ca9fd463887478d65045aab23c76c85926ff3d9d53ac48138beb244bca9d19ae2b397e13e19bcbc846c074b214906d29a2f97950b02676c9dfecf6fa089373c7de72c1f4ccb6300fd8abfa0df3fcbb73ff032db194fac69a1bed6ead04156179b28f243556a83128e030b1222704cf3a03197321d326450a37c6e88b795a51691517481b268b8c8fd004d42cc40cb150435a4b8d78e35b089ea2f2b9c86b5ff749a63619ba3ddc",
      "12b900a55ac5e082ab9c7b6e9a4181d0add318c12dfc90ca33072ecbf30086b5e9193cb3d6b86df9c3c027388f937db50e70258382006a389e1bb045df24b43b87481961f39debd37c724926845d3800589d179b0f08da2eb4db527c7d6923fa06c8ec4eb5718b82cf955c37722e2bcdd78ddc5a5f2be4287c327f9bad389e3e99f0a8dae6ca9dbe0d1ff6098d786e6013455dcf38a6ed344ee1a857c939a7afcd3c982707a9c36efcaba340b4b510c29882baff5ca7792a7d1c5fe0942401b200aaf05bb3ee4f27bde60bda9e23a0253460c2443abd60a7c7d09e742730e304c36527c7faeea54a793544a5587f261001b8c08b9a4390daa9a8c764a9d0895e34d01e4dc79c0688412f97b121a0300d285fe957496ae3bd9aa9bf14fa766ce8144f9fc4c3fb2c3e82c1ecb9098cef4516ae4cd0896b8572129e8346e96569441ff870e4aed21ad42ce9cede16a3b86609cc8cfe35e36c7f5553cc85ac26efe52420845cf352cb67a56c55d74b77ad904bb850a1b5b0bf236c37f8ac6061a8b40b4e2949507a1f2b5b1f71df93e619631b977c7f36087367c452cf0ecf081c5511ac1336b1999dd9c458c7ee9c4596e900258cd9824ce5c13be86938dc16716c37666e61598f215147f1559a4a3518f64e451685949742bc2afa786e1277577e07dda5ade21d49a256ae3511b3348a9e107b9db6690f6630a7b9954157c84775ea3518332b8306dd36b7ac9f918f755809abbc2d199aeb7a78c49643fa60f27d8156d9c67efba69556c22942724d67b34be49cbf497783e83e73adff41ea7774",
      // test 3
      "035205fc0226821e7af21ef2760c2f3f9538b9612200c5e502e10cff141938f8cf72d99f1aa4f770ea0bca10c57ae692177049bd989d92a7681e40b7be1505318be023e7b877b1a40ae9c3738058d99c69156f6a075d30ee7803226638b722fd052244350368122b5ae34e1efde626ee9e162ece751d668031c51314caab2c4eb01e58c3bec9b7abffaae5731247710103a41cf2c11bdb262b41505f3bcc78f5a8d1afb2c9ca5391a1b9895a947cd01f3f3b5c214fdc4fd978cf188d8919215a03abf112c9bd7a812d546f48d0cbeed2b6b446f360a2de1642e9892a8c35f8547de30d19036785fbd2a425bdc35d9788187182e38c97334b6416dacd3fc9110e8f59c3d14aad8bdb2fc6133a7a7c0ea0d107e254e1d1cd9e5b73dd9535ecc185139c94c3e88cbe70a9c6a711718638530a0c3a14bad3bdf2f45f6c960b57a6543fd2560d81ab2727a8715e85eb89cc8c036de17081b505a8af4bcd656868844c72bc49a956740fc60d405817579a3ce330551a86324abb61b0ef123d58f6568e0f8939d7682eb54aa24c382b9a3cf1c8cd10bb0763f386cca6e94f8aac8559eb5b34c9ba0d0287bc6ba8414d359af6aa06dde73759f2491eee944c090ec86d3c986c277e5e99f578efbfc87a10c20e7b7e8872686b13d3a5fca47e5c592fa8cf1580ada0cb4fa0e128ba53dc9b8c85b84abab9d3c3d5574830de38519af09e720f01a1ccb5830031815afb2082ac9b85065ceba1a4160b29a5f062f573219cd1755f7581f94d3137e3c755d4b9573598dda0cc1eb0f54ababa2907b7854cbaa214ea9e99d2caaf2c67a7b07d0c79bf17027b0e12b74b7d24358b010e6973402341a94616c566e428324f2141594263f7105d8b606b0863d2f8d3adad634d36f941d9cf66392f8fdadfad338bf296cb1a84ded68d28e108e98c124f127c43f1ef006c9342a18aff9b069144699209421d28432586b3ec48d8d244dad7d1496c1b38e4ffbb2a0168c8ba8c078d310f5d3903150b7c9d055ac91fb1f9708fbfbb97773d37e0fef87d00f4ed5e9a043e56b445a74d0f240bbfd096d4370d8d399603013048fb8d578df3996f0d36b6d0a2224c51ad6592b96b8f33a0689a823f306af244c474b2c157b230fdd20a22abf60f0704c6b79716d44865d0433dd92cb023115deea9d5c9e2881a6c3f3bb3dca960dd9346b5f5facfa191c652b23c60d511",
      "0e3b7891cce242f16fcf2e78d791f59207737e819746aca96a2371cffa7e4a73a7d23e72deca87ffbc0e1016d3006ef3158a4930b3d9da7421b1bb4c41e1fa6d0e95a2c83f033252e277fcc8d67fb88f0bfdcc202decd2d865f85a33207cc53215dfec6a9043eb3c25a6c148c0208d898d8c357883f8ed66a0cb70115d8142f7464bfadde1e7d6cb8bbfc416d7895cff0c998d077822fd9dce6edae91b84cc5dd7ec8accc1ed262d356f803a2fbbb2bfefd283de4b450ea61c08a867776ec54808a5ea36bc38d039d9bac15207dcd817eaa06e054a5b2ba1ec45e8ff8d320eb8c7aa0dba07854c90a5618d08af32717a02803f583c027353813f31fc27d53472c8be0044b80af0510dfdba8647cfaa1f0e0913a870ef79f02762e0f0401e31b113aa3947932f24bdd50b5909c425edda718be31158693d78fcd41e0d548bf379aa5f48c24542ed3de38dc248e30a919709d97b7d46624318005f4beeebe09cd7bc85d4d50ddb0377b2ea79d11d6ff8aa2d283d7f7cd8b93d1b15fefe5c689fb911c262e76d7641c2941b93a921ff0bde9d20093184491f01fa2683098b97a4255d0684eb5d3a673b9b2ae84984e1d0ac10526c144bfb88850392593ebabd5efe82ba62620366144e6bd9dbaddaaebd1ede0e640d1ee414b4a3fd0b1f7b9f68e400b88cde2734b2c4eb3a25ce87bcdd7af1cc8ea9a5812b7993c4cdc152cf2f7847e32671a543bd58955fb54b7edf220e168962731fd01590691fa946d2f2e820bfee8171828fc23b61c42405cf03b95fe522e66974f64566df2e7c2a259bba69",
      // test 4
      "078a6418c36679852e5a51ca7fd65f4da7107c9ec3a5c0e8d4a6936b71cd23ba0a43fd07291d6cf36679f33187d5bb4905653739cfb255ccd445e8fa6c7577aef45f6fabff2f3a14affcb842db0aeb74bfd88d0ee86ca39604d63d3fb068176b0959667706bd196ec697709826c41de56b0d359f6bc817c2f71a1f9e14cc0587d6250a74268590c32b4b0c94e060304a12898f2b5d2b209e0f106ed181855c6cff75f53b294d4e2bc78450d36647ce8e3cc1db7701e9f4d0e0810f04893c42cc092263d88bc5d1abe0a208c518664e67a3d0995515b336d289a93ac3b41141db8786fa905c1564066a7c9cc29dee6be40b5fcfb53db89a61cf4c80e9a8c599b18150c044d63b0bd9744170da2e6e1bba1deb1780eafea375524b5f22619c257e0847d288ea5cbf20afbbd596927f9253e885968d376dd826968ef04cab07a158b9b1972e48eacf6f17e808bbbc5083bc137d020734a77b6bf5fc94020b73a3e1461694e0158bcbd77182809d0f6ca0449e98a1800986a7bc50f0a917f1dbaf230b6642fc8faac09e31b3a09f661caa7bdb3ad330e11359906fd63d1dbae6c13392cc5d8f6cffca69d560bdef7ef2537a0187ddc7f81b2307b8da714a9ca0f9c8924c511877fc0b321543813af722aaa640473fd9741e77825ec1eeeceb1a51090cbe0acbc3cd4feaf4ada883e688f9c10ff297a6b784337c19bf4eb37c651a7d7c186d9c8e2092f29ba2637a828dc4640b973460d8028919ef505d66e2a7587740f5475ff7dfa8623d3b977c7aa0422a491878cd3ca2597e6afcc644cb365232",
      "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001",
    };

    for( ulong i=0; i<sizeof(tests)/8/2; i++ ) {
      ulong in_sz = strlen( tests[2*i] ) / 2;

      fd_hex_decode( in, tests[2*i], in_sz );

      n = in_sz / (96*3);
      b = in + 96*n;

      FD_TEST( fd_bls12_381_pairing_syscall( r, a, b, n, 1 /*BE*/ )==0 );

      ulong out_sz = strlen( tests[2*i+1] ) / 2;
      fd_hex_decode( re, tests[2*i+1], out_sz );
      if( !fd_memeq( r, re, out_sz ) ) {
        FD_LOG_HEXDUMP_WARNING(( "res", r, out_sz ));
        FD_LOG_HEXDUMP_WARNING(( "exp", re, out_sz ));
        FD_LOG_ERR(( "FAIL: fd_bls12_381_pairing_syscall big_endian=1 %lu, %s", i, "res != exp" ));
      }
    }
  }
  {
    const char * tests[] = {
      // test 0
      "",
      "010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
      // test 1
      "e93fba93c8e6e1f844b1a50926388747cb172468070a0a84378f61d3dac2091f7797d5c22d1b410c413596aea5b36d0e2d8467067810a054a0df239cd82f5a4b71f53a0ced4c6c0d653028fd270132a60cf3628710d96f73f90234a02585bf15cdf6c606e0ab8d9b03ef00b05f381eb39e7afa3edfbcc143f9ea120e8759260450a5ebbf5dc0b828894556cb3642b50d6b5ac9dcd0bf3433b1c33ed429768d860db384b45c31f577387505e666ec9d3e92d378388a7942cd25c925cd4e351c0f62668b5aca64461649ac3ff49ec468b33d4a1592905c12b621260590c9c19193e512b80b8fc019668fd4c5bd2d43971834afea22e79996fb7ca7af6d8d7165fe3e121702b319db9fc772c30a40bc3b3ed1cb91d216b63b07399b859731fb9f06",
      "8bd973f0797c21dd5bbae262491ec998f678f525826cdc5b70859b6c9d54bcb67722eb31ad2ad276584e71fb362eee18412e26ee675e99c90753843bee317172d1cb3ea6b6c1230a89c309a62fd4c02ad34be999192231c42b7ede50fbdb7c0fa3834b0eb123fb674e4e9b344a6f844bc85b5a56ad37f3db70c6ac2adf9b4a1730a627c61d6c9c135d77aa214070580fc8900d6627f3392c1968739741e5473a7168e18633d5cb0c3ad247d16f72a2e67ce7832fc4bf256e29f179ee971e4c00807040046141c05665914784d1eb3ece7bdc7b29de65d3152533fc77e0aee41acba33c2a8a7b5c41d5025ef342a0ff09d231f42c6b9cf01d6b7e683370479978af1257feebd1b14a37ad9bbded5ad74997feaef80841e5bd8ba682e7f6c859072dc94ed2923801250e386010f9987d24fb03e682a01ef984daaa18339fdd6bbf8a45181fc3f745cb1ba22499c4a1f31096e97c6f5ecc55928e53092cf2ed29436fec9d118ede686c0655f49d4bdd8ca48d9e915a2e0e6f0f2cfa790242e1bc147964d6b824e3fbf4258ead873adcfa8791038a6fcbada6fd2926a958ff5d6361c64fd6231b04d4d5d733eed5a06acb08928e189a7322f7fe352d84213ed107914bb85f29916fb1dd3c8834657486d842cb873094544eb0f77c3339675fc64d0b9d09a390d6a5dbb718200cf56807c4f4c58305191bc9b894364512820ea6a267f7cdf38f8ce6f032301824922679b40111b993acd40cf092480fb9cf5b008720db39e89397cfe756e05a1a02bd4092d71eb46f90f05f189a88f2d1e13935640e",
      // test 2
      "96cea8927ead0d6936492f1438736d88b4c43242815ffc438f1c8e41ab284f4e1f044b133d0f1f99bf7b3c32f80517090f61285ad13b345093227200e77b8e1da008d098e9fe7c7efb3457f3edab5cd4bd5219fae86c7394258b67062e712e0ce72c6fbedf8c646e62b589adfff663d16a768dfc4f7698f40072ce1b798d1b3956e87ad3813ebb295cee8b11869e8f185d1e0596f326062308498ce861e2a335fda0942ad414376646ff1657494eed34685d8e68ebd9da22b646641662cb7208a5510cc6bfeecea848ff43e54e2a6a1bc7ed2ae7712e581a6e06c7e4bd657e762d92f8fca1e7a06f8a0006d754095c12c75eb43b7b776fed094d9c04e574d7d568ab3373d7eb5b2e5d553a260c10ac71bf2080dd8b5fccdeae45938eeb58510f193b2fb270f056c59ac2cf26742805bdb0dec31f33096b6a2faf3ad39a86f98cc2bb30b2cf0e97ea922353a8c0ee7a08352e206dbf7fe571b6c67b30615f2aa5fb21a3e8175536374e0924fcfe947b8689f6b2e473e977f5e8e494969b69c7108784d0535488a3ca8bbc78466326833e50820beb8eaa05e4c58bec5b2433ed8242ac1050de4cfac5ef8c4bc6cb33e0005f6b6f00e44b9c375c82f3c75ab15554b70540de988b3f66613b08a3da35fe26096529c2a11eb6a60cddc25b41e23c00788790e3c155f0b3710a0a357a5f172d5db47edbe158123b23f967d131ae4c5d46a5e601639741c09d612bd58f724f073df4de993757a3498ce011376c523767e46607e78facea0e5b3daa86e1f36994b17c6b6bfbf2f8334e275499b70d5514",
      "cb375c6750109c8f6c2475d676d5aa28788df00322d5943543b1428ffda6fa24629ad270b38f6a35ec2e6a137b078d15d8df070f6ae1174c48abb2ae513c91fa4e831e8c91cfc60859a7ea925afbcdb27a91a271ea658f54a7cecc38ababfa01482c346271e4341bea1dc8e892313a3e6ca080456c432e59dbe190ab59cf1b268a5d33f835dba4e084e0ef713f02d31331a7831b2336d50b1dba00c002b3050bb0070e3a475384dd1b703c6f00d36f93da4f012609cd1adfabccc3a23a88d813bee531eb854e3c7253a21395e39aff8e365309eccf2452168f8b7234f1375da6fd68395579c78948d0262685e49afb1490730e3078cad7f08aeb4b6a9726d5be7c44c73a4debc4c5ef394b0a2722c43127c40eebf4a5611fd224ff1b8e6f1c19f2660959078423e346da5f316ac1feabecc4897e7233d3ef1f607aa25424a061adb62a585ca54f034ba3f53da01c3e06fe8e2bd3ccd08bc59900f506d3c0aa25f4587d1148e6c138ddb610f7d7200fd7f6a68a5bdf7878befc8d1ceb72d0d908c8f2077e2c67e69b9a993729254742bdfc79f0b8f99f6ae765be1287791e028e3ad9df6159b289789919c5d00350f103d5df5406a0dd2cd1a633673ef92c766267892d26bf4a7a1e1af623646a0689ad5a5aabced991ffe2c372bcd99161e1042e94ff8cde731d1bb5ea9072a1a630ca7327dbb042d9dbda6b450931677ecf09e3a4ad463d1a6a2d55b91e848258a9087fc7724b021c58bde32b6adb7d1ed6599b7d595e3e731afda5348e9ef116fe65987122f07d63f5e441de6dc0939b5517",
      // test 3
      "d1a5c2e432a0421786278af0b261a522bb2af2580c922011ec8703dc14be47211681db1156f86f135c48260c96de7c07116196d5f4f876ccec49b248cead60ea1f0346fbee3bd1e805f796f795f88666afb3ced0c8879db75cf79921de8f9506482fcd378141a10552fde4c8be3dc37fb398dc55cd381e30f45b08f1c838044b32acb1f808252449122e4c8a4d078703dcd8de2cf4b7e82d21e394bd97fe297457ec783f92689b2a6ba758071a9f9e4df3550c581ced942d02de084df89ff604a8542d38bbc347b7673bd878fdc5775d0ba7ab7b025b13cec7eb486b0109615253afb943dc21c30aeadb7e4ee3defb0984f1f425eb8ed94a5dd63d6d9afd0ce76afc07f603bd39e9e615a841044219724900bee29e9a918c7e304858793f7f0dd8c50f0e7bd6814213d23c7ea65df4505516fb43e3feb29d3040bf33406d720f30aba3e8da3dbd86d3230379168cfc1241eff8bdcc92afacbd0b4c00b0ef9ef5b0a8b64115d6037485737ab326080af2548a8f224c637c802c0ee683eb0c3a0c53e88c4b3e3a0c7e0d6c6e991bb0f0b3e1d73b72f54c06999805d38eb195179c82deeadf68363114e8428776769f9805f3270a660dc9c50dbf5b34bbf47f4f44180502af83e8ae959a4765eb2bd083ee01ff6ab99877849646347e9bbe1ad108fd45711bca38c109ab51e2ea16d0084382130f570adfb3e4583ed10a5ae7f573f106a4a27b7f5927385460a4ba91ae0113255a946b6c872bf0b4da95cb4aa5ab4341288337d90f819a0bb6997eca76e432124e7d3340eda52b96dd92f4d7ae051bd5771457a92be0255cc864a619895485c5971985d894f79e6e05c3cf7f71323600f6d02fe7e10e30c6a246e3c6bb0c8abcd3663069dc877e79afe7434378123908a9794b8d02dc8100ecf668eee7dce8510aae37cdc5743da3ca36f0c1090d72c48a8f151fcc8dc060b4852e03fbe908f472b990ae51d77aa3570aa8444b3074b78cce6f3264ea00a1c663155d1e0bb3947e3bd80beb5cd3f3f5f41720add508d7e08a8065f41412d1e52244d419d35a7e8560e55b8d16aa5f59af18949d162cc66e4a86e1170dd8b8c716d2dcc526cbdfd6fbfb1a2ad51778b9e5e4c387250645ccc3f935399ae9a3b4db7bc3c713ba47df663bd41789a30a706399a78b902e630f4c80dbc21d9c2bd4bffb42a6676b91fc134a36a6abfb7c727937726713",
      "ef229647969046edc07fb1a5820ef06a4d04fc0b65421143115266b7f7133d7ca0902e79965929c3885c14178db9cc13ef141aff58121d4c3fe1c481465a2e7ecb77cd9ee41d2740a7251487717590417adfaa3c79308abef7472050d12cfd08832103c4615a2ef262171b4fff9e0be3a5f2dc51c15a49b0fdab4d761d0d550b124676148e7ee5c1251961380ae3080091263a2d9316c361659c3127b4bc9729957a461eb7d56bc4baf939b4a8c53156a488a6b7f76a28ad70a9a5e06214390e49537f7b3f78ecc75973b21c8787198dbefb58831e32d217e4274e494441766d3671b77ebf68117d4c1c8c63c4c0b7103aced00d6f4c5aad3591dedde22ef4a699ad7220044d5316ecf83fd2477e1a9d122abd331eaab31819369a931ffba6004ec5db6a10548a140b788bec74a9c5e6b58515f6a09c8d95bedd16b72eb110b09af7af5c8a85dc8170d89679907e480b0e849193fcd0dd2950c856a7f463b63fe38820b79c000788ca2983508ef04ee69a060f66d68e176556beee33dd6a1c1569c6e2820fa96a71215562685f3c27cc949cac0d9792a3cd0eb0b4321dd1bad10672dd49f09e60890929524cd4d9031051726f8693085dffb40e72a34ea802d5ad11272156646c15bc88dff0fdc00f3ce6995e50e3a2ca537d3bfb24c115cb0aabe67523e2344774c7a966cffc28ff8e7c93cd3ce2df441b22cb002b0ca16df325efe6dd5df4a045f121dd564480050433eb814d1aa25ec5af44fbe498947ac775004719649f4f277b82e7a6d6a03b5b0c6eecabb8f92434aec218f7b102cf0d",
      // test 4
      "49bbd58731f37966f36c1d2907fd430aba23cd716b93a6d4e8c0a5c39e7c10a74d5fd67fca515a2e857966c318648a076b1768b03f3dd60496a36ce80e8dd8bf74eb0adb42b8fcaf143a2fffab6f5ff4ae77756cfae845d4cc55b2cf393765054a3060e0940c4b2bc3908526740a25d68705cc149e1f1af7c217c86b9f350d6be51dc426987097c66e19bd0677665909cc423c89040f81e0d0f4e90177dbc13c8ece4766d35084c72b4e4d293bf575ff6c5c8581d16e100f9e202b5d2b8f89127e259c61225f4b5275a3feea8017eb1dba1b6e2eda704174d90b3bd644c05081b199c5a8e9804ccf619ab83db5cf5f0be46bee9dc29c7c6a0664155c90fa8687db4111b4c33aa989d236b3155599d0a3674e6618c508a2e0abd1c58bd863220923afdbf117a9f050bca7860980a1989e44a06c0f9d808271d7cb8b15e0941646e1a3730b0294fcf56b7ba73407027d13bc8350bcbb08e8176fcfea482e97b1b958a107ab4cf08e9626d86d378d9685e853927f9296d5bbaf20bf5cea88d2470809511aebeceec15e82771e74d93f4740a6aa22f73a814315320bfc7718514c92c8f9a09c4a71dab807231bf8c7dd87017a53f27eefbd60d569caff6c8f5dcc9233c1e6ba1d3dd66f905913e130d33adb7baa1c669fa0b3319ec0aa8ffc42660b325236cb44c6fc6a7e59a23ccd7818492a42a07a7c973b3d62a8dff75f47f5407758a7e2665d50ef198902d86034970b64c48d827a63a29bf292208e9c6d187c7d1a657cb34ebf197c3384b7a697f20fc1f988e683a8adf4ea4fcdc3cb0abe0c",
      "010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000",
    };

    for( ulong i=0; i<sizeof(tests)/8/2; i++ ) {
      ulong in_sz = strlen( tests[2*i] ) / 2;

      fd_hex_decode( in, tests[2*i], in_sz );

      n = in_sz / (96*3);
      b = in + 96*n;

      FD_TEST( fd_bls12_381_pairing_syscall( r, a, b, n, 0 /*LE*/ )==0 );

      ulong out_sz = strlen( tests[2*i+1] ) / 2;
      fd_hex_decode( re, tests[2*i+1], out_sz );
      if( !fd_memeq( r, re, out_sz ) ) {
        FD_LOG_HEXDUMP_WARNING(( "res", r, out_sz ));
        FD_LOG_HEXDUMP_WARNING(( "exp", re, out_sz ));
        FD_LOG_ERR(( "FAIL: fd_bls12_381_pairing_syscall big_endian=0 %lu, %s", i, "res != exp" ));
      }
    }
  }
  {
    ulong iter = 100UL;
    long dt = fd_log_wallclock();
    for( ulong rem=iter; rem; rem-- ) {
      fd_bls12_381_pairing_syscall( r, a, b, n, 0 /*LE*/ );
    }
    dt = fd_log_wallclock() - dt;
    log_bench( "fd_bls12_381_pairing_syscall", iter, dt );
  }
}

/**********************************************************************/

int
main( int     argc,
      char ** argv ) {
  fd_boot( &argc, &argv );
  fd_rng_t _rng[1]; fd_rng_t * rng = fd_rng_join( fd_rng_new( _rng, 0U, 0UL ) );

  test_g1_val( rng );
  test_g1_dec( rng );
  test_g1_add( rng );
  test_g1_sub( rng );
  test_g1_mul( rng );

  test_g2_val( rng );
  test_g2_dec( rng );
  test_g2_add( rng );
  test_g2_sub( rng );
  test_g2_mul( rng );

  test_pairing( rng );

  FD_LOG_NOTICE(( "pass" ));
  fd_halt();
  return 0;
}
