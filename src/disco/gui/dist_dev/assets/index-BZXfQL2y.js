import{r as j,o as Be,a as Ie,i as Ae,n as Oe,b as Q,j as n,T as V,p as b,c as C,m as ve,d as ce,P as $,f as F,e as je,R as _e,g as I,l as H,u as Pe,h as he,k as U,q as A,A as Z,$ as $e,s as De,t as qe,v as R,w as Ne,x as Ge,y as Ve,Z as He,z as Ue,B as We,C as Xe,D as Ye,E as Je,F as Ke,G as Qe,H as de,I as Ze,J as et,K as tt,L as nt,V as rt,M as st,N as it,S as at,O,Q as ye,_ as y,U as ot,W as lt,X as ut,Y as ct,a0 as ht,a1 as dt}from"./index-DQ68BVgN.js";var pt=Ae?window:null,be=function(e){return!!e.addEventListener},we=function(e){return!!e.on},gt=function(e,t,r,s){r===void 0&&(r=pt),j.useEffect(function(){if(t&&r)return be(r)?Be(r,e,t,s):we(r)&&r.on(e,t,s),function(){be(r)?Ie(r,e,t,s):we(r)&&r.off(e,t,s)}},[e,t,r,JSON.stringify(s)])},ft=function(e){return function(t){return t.key===e}},xt=function(e,t,r,s){t===void 0&&(t=Oe),r===void 0&&(r={}),s===void 0&&(s=[e]);var i=r.event,o=i===void 0?"keydown":i,l=r.target,c=r.options,p=j.useMemo(function(){var d=ft(e),u=function(g){if(d(g))return t(g)};return u},s);gt(o,p,l,c)};const pe={forceUpdateIntervalMs:1e3,halfLifeMs:1e4};function mt(e,{forceUpdateIntervalMs:t,halfLifeMs:r}=pe){const s=j.useMemo(()=>(r??pe.halfLifeMs)/Math.log(2),[r]),[i,o]=j.useState(),l=j.useRef(),c=j.useRef(e);c.current=e;const p=j.useCallback(()=>{o(void 0),l.current=void 0,u.current!==void 0&&(clearTimeout(u.current),u.current=void 0)},[]),d=j.useCallback(g=>{g??(g=c.current);const a=performance.now();if(l.current===void 0){g!=null&&(l.current={value:g,tsMs:a});return}g??(g=l.current.value);const{value:f,tsMs:v}=l.current,m=a-v;if(!isFinite(m)||m<=0)return;const h=g-f;if(!isFinite(h)||h<0){p();return}l.current={value:g,tsMs:a},o(x=>{const _=h/m*1e3;if(x===void 0)return _;const w=-Math.expm1(-m/s);return x*(1-w)+_*w})},[p,s]),u=j.useRef();return j.useEffect(()=>{if(u.current!==void 0&&(clearTimeout(u.current),u.current=void 0),d(e),t!==void 0){let g=function(){u.current=setTimeout(()=>{d(),g()},t)};g()}return()=>{u.current!==void 0&&(clearTimeout(u.current),u.current=void 0)}},[t,d,e]),{ema:i,reset:p}}function M(e,t=pe){return mt(e,t).ema??0}function D({inBytes:e,value:t}){const r=M(t)??0,s=r!==void 0?e?Q(r).toString():Math.trunc(r).toLocaleString():"-";return n.jsx(V,{align:"right",children:s})}const ee=["ContactInfoV1","Vote","LowestSlot","SnapshotHashes","AccountsHashes","EpochSlots","VersionV1","VersionV2","NodeInstance","DuplicateShred","IncrementalSnapshotHashes","ContactInfoV2","RestartLastVotedForkSlots","RestartHeaviestFork"],vt=["pull_request","pull_response","push","ping","pong","prune"],jt="_root_zd40k_1",Me={root:jt};function _t({storage:e}){const t=j.useMemo(()=>{if(e!=null&&e.count)return e.count.map((r,s)=>{var i,o,l;return{type:ee[s],activeEntries:(i=e.count)==null?void 0:i[s],egressCount:(o=e.count_tx)==null?void 0:o[s],egressBytes:(l=e.bytes_tx)==null?void 0:l[s]}}).sort((r,s)=>s.activeEntries-r.activeEntries)},[e]);if(t)return n.jsxs(b,{direction:"column",gap:"1",style:{contain:"size",minHeight:"250px"},children:[n.jsx(C,{size:"4",children:"Storage Stats"}),n.jsxs(ve,{variant:"surface",className:Me.root,style:{minHeight:0},size:"1",children:[n.jsx(ce,{children:n.jsxs($,{children:[n.jsx(F,{children:"Entry Type"}),n.jsx(F,{align:"right",children:"Total Entries"}),n.jsx(F,{align:"right",children:"Egress /s"}),n.jsx(F,{align:"right",children:"Egress Throughput /s"})]})}),n.jsx(je,{children:t==null?void 0:t.map(r=>n.jsxs($,{children:[n.jsx(_e,{children:r.type}),n.jsx(V,{align:"right",children:r.activeEntries.toLocaleString()}),n.jsx(D,{value:r.egressCount??0}),n.jsx(D,{value:r.egressBytes??0,inBytes:!0})]},r.type))})]})]})}function B(e){return n.jsx(I,{children:n.jsx(E,{...e})})}function E({value:e,label:t,valueColor:r,size:s}){const i=typeof e=="string"?e:e.toLocaleString();return n.jsxs(b,{direction:"column",children:[n.jsx(C,{size:"5",style:{color:"var(--gray-10)"},children:t}),n.jsx(C,{size:s==="sm"?"7":"8",style:{color:r??"var(--gray-11)"},children:i})]})}function yt({storage:e}){var l;const t=j.useMemo(()=>{if(e!=null&&e.count)return e.count.map((c,p)=>{var d,u,g;return{type:ee[p],activeEntries:(d=e.count)==null?void 0:d[p],egressCount:(u=e.count_tx)==null?void 0:u[p],egressBytes:(g=e.bytes_tx)==null?void 0:g[p]}})},[e]),r=j.useMemo(()=>{const c=H.sum(e.count),p=e.capacity-c;return`${Math.round(c/p*100)}%`},[e.capacity,e.count]),s=Pe(e.expired_count,1e4),i=j.useRef([]);j.useMemo(()=>{i.current.push({ts:performance.now(),value:e.expired_count})},[e.expired_count]),he(()=>{const c=performance.now();for(;i.current.length>1&&c-i.current[0].ts>6e4;)i.current.shift()},1e3);const o=e.expired_count-(((l=i.current[0])==null?void 0:l.value)??0);if(t)return n.jsxs(b,{direction:"column",gap:"1",children:[n.jsx(C,{size:"4",children:"Storage Stats"}),n.jsxs(b,{gap:"1",children:[n.jsxs(U,{columns:"repeat(auto-fill, minmax(160px, 1fr)",gap:"4",flexGrow:"1",children:[n.jsx(B,{label:"Expired /s",value:`${Math.trunc(s.valuePerSecond??0)}`}),n.jsx(B,{label:"Expired last min",value:`${o.toLocaleString()}`}),n.jsx(B,{label:"Total Evicted",value:e.evicted_count}),n.jsx(B,{label:"Capacity Used",value:r})]}),n.jsx(A,{flexGrow:"1",children:n.jsx(wt,{storage:e,usedCapacity:r})})]})]})}const Se=["#48295C","#562800","#132D21"],bt=e=>Se[e%Se.length];function wt({storage:e,usedCapacity:t}){const r=j.useMemo(()=>{const s=H.sum(e.count);return[{id:"unused",label:"Unused",value:e.capacity-s,color:"#222"},...e.count.map((i,o)=>({id:ee[o]+o,label:ee[o],value:i})).sort((i,o)=>o.value-i.value).map((i,o)=>({...i,color:bt(o)}))]},[e]);return n.jsx(Z,{children:({height:s,width:i})=>n.jsx($e,{height:s,width:i,data:r,colors:o=>o.data.color,arcLabelsSkipAngle:10,arcLinkLabelsSkipAngle:10,arcLabelsTextColor:"#9F9F9F",enableArcLinkLabels:!1,layers:["arcs","arcLabels",Mt(t)],tooltip:St,animate:!1,innerRadius:.7,arcLabel:o=>o.data.label})})}function Mt(e){return function({dataWithArc:t,centerX:r,centerY:s}){return n.jsx("text",{y:s-6,textAnchor:"middle",dominantBaseline:"central",style:{fontSize:"28px",fill:"#9F9F9F"},children:n.jsx("tspan",{x:r,dy:5,children:e})})}}function St(e){const t=e.datum.value;return n.jsx("div",{className:De.tooltip,children:n.jsxs(C,{style:{whiteSpace:"nowrap"},children:[e.datum.label,":\xA0",t]})})}function Ct({messages:e}){const t=j.useMemo(()=>e.num_bytes_rx.map((r,s)=>{var i,o,l,c;return{type:vt[s],ingressBytes:(i=e.num_bytes_rx)==null?void 0:i[s],egressBytes:(o=e.num_bytes_tx)==null?void 0:o[s],ingressMessages:(l=e.num_messages_rx)==null?void 0:l[s],egressMessages:(c=e.num_messages_tx)==null?void 0:c[s]}}),[e]);if(t)return n.jsxs(b,{direction:"column",gap:"1",children:[n.jsx(C,{size:"4",children:"Message Stats"}),n.jsxs(ve,{variant:"surface",className:Me.root,size:"1",children:[n.jsx(ce,{children:n.jsxs($,{children:[n.jsx(F,{children:"Message Type"}),n.jsx(F,{align:"right",children:"Ingress /s"}),n.jsx(F,{align:"right",children:"Egress /s"}),n.jsx(F,{align:"right",children:"Ingress Throughput /s"}),n.jsx(F,{align:"right",children:"Egress Throughput /s"})]})}),n.jsx(je,{children:t==null?void 0:t.map((r,s)=>n.jsxs($,{children:[n.jsx(_e,{children:r.type}),n.jsx(D,{value:r.ingressMessages??0}),n.jsx(D,{value:r.egressMessages??0}),n.jsx(D,{value:r.ingressBytes??0,inBytes:!0}),n.jsx(D,{value:r.egressBytes??0,inBytes:!0})]},r.type))})]})]})}const Ce={id:"Stake",direction:-1};function Et(){const e=qe(),t=R(Ne),r=R(Ge),s=j.useRef(new Map),[i,o]=j.useState([]),[l,c]=j.useState(Ce);j.useEffect(()=>{var g;if(!t)return;const u=Object.entries(t);if(!i.length&&((g=u[0])!=null&&g[1])){const a=Object.keys(u[0][1]);o(a),c(Ce)}for(const[a,f]of u)s.current.set(a,f)},[i,t]),j.useEffect(()=>{if(r)for(const u of r.changes){const g=s.current.get(u.row_index.toString());g&&(g[u.column_name]=u.new_value)}},[r]);const p=j.useCallback((u,g)=>{if(g<u||u<0)return;const a={start_row:u,row_cnt:g-u};e({topic:"gossip",key:"query_scroll",id:16,params:a})},[e]),d=j.useCallback(u=>{(i==null?void 0:i.indexOf(u))!==void 0&&c(g=>{let a=-1;g.id===u&&(a=-g.direction);const f=i.filter(h=>h!==u),v=new Array(f.length).fill(0),m={col:[u,...f],dir:[a,...v]};return e({topic:"gossip",key:"query_sort",id:32,params:m}),{id:u,direction:a}})},[i,e]);return{query:p,sort:d,colIds:i,rowsCacheRef:s,colSorting:l}}const Lt=1e3,ge=0,te=e=>{if(typeof e=="number"){const t=Q(e);return`${t.value} ${t.unit}`}return e},kt={Stake:{width:80,align:"right",format:e=>typeof e=="number"?Math.abs(Math.trunc(e/Je)).toLocaleString():e},Pubkey:{width:200},"IP Addr":{width:80},"Ingress Pull":{width:80,align:"right",format:te},"Ingress Push":{width:80,align:"right",format:te},"Egress Pull":{width:80,align:"right",format:te},"Egress Push":{width:80,align:"right",format:te}},ne={width:150};function W(e){return kt[e]??ne}function Ft(){const e=R(Ve)??Lt,{query:t,sort:r,colIds:s,rowsCacheRef:i,colSorting:o}=Et(),[l,c]=j.useState(()=>({row:-1,colId:""})),[p,d]=j.useState(!1),[u,g]=j.useState(Object.fromEntries(s.map(h=>[h,W(h).width??ne.width])));j.useEffect(()=>{g(Object.fromEntries(s.map(h=>[h,W(h).width??ne.width])))},[s]);const a=j.useCallback(({startIndex:h,endIndex:x})=>{const _=Math.max(0,h-ge),w=Math.min(x+ge,e>0?e-1:x+ge);t(_,w)},[t,e]),f=j.useMemo(()=>Tt(s,u),[s,u]),v=j.useRef(l);v.current=l,xt("c",h=>{var x,_;if(h.ctrlKey){const w=(_=(x=i.current)==null?void 0:x.get(v.current.row.toString()))==null?void 0:_[v.current.colId];w&&(Ke(w.toString()),d(!0),setTimeout(()=>{d(!1)},500))}});const m=j.useCallback((h,x)=>{g(_=>({..._,[h]:Math.max(x,W(h).width??ne.width)}))},[]);return n.jsxs(b,{direction:"column",flexGrow:"1",children:[n.jsx(C,{size:"4",children:"Peers"}),n.jsx(A,{flexGrow:"1",minHeight:"300px",asChild:!0,children:n.jsx(He,{className:"rt-TableRoot rt-r-size-1 rt-variant-surface",totalCount:e,increaseViewportBy:200,rangeChanged:a,components:f,itemContent:h=>{var _;const x=(_=i.current)==null?void 0:_.get(h.toString());return x?s.map(w=>{const S=W(w),k=S.align,L=S.format,z=x==null?void 0:x[w],T=l.row===h&&l.colId===w;return n.jsx(V,{align:k,onClick:()=>c({row:h,colId:w}),style:{outline:T?`1px dashed var(--gray-${p?11:10})`:"none",outlineOffset:-2},children:n.jsx(C,{truncate:!0,as:"div",children:L?L(z):z})},w)}):s!=null&&s.length?n.jsx(n.Fragment,{children:s.map(w=>n.jsx(V,{children:"\xA0"},w))}):n.jsx(n.Fragment,{children:n.jsx(V,{children:"&nsbsp;"})})},fixedHeaderContent:()=>n.jsx($,{children:s.map(h=>{const{align:x}=W(h),_=o.id===h?o.direction:void 0,w=S=>{S.preventDefault();const k=S.clientX,L=u[h],z=G=>m(h,L+(G.clientX-k)),T=()=>{window.removeEventListener("pointermove",z),window.removeEventListener("pointerup",T)};window.addEventListener("pointermove",z),window.addEventListener("pointerup",T)};return n.jsx(F,{align:x,p:"0",children:n.jsxs(b,{align:"center",height:"100%",children:[n.jsx(Ue,{children:n.jsx(A,{flexGrow:"1",style:{padding:"var(--table-cell-padding)"},asChild:!0,children:n.jsx("button",{onClick:()=>r(h),children:n.jsxs(b,{align:"center",gap:"1",justify:x==="right"?"end":"start",children:[x==="right"&&n.jsx(Ee,{direction:_}),n.jsx(C,{truncate:!0,title:h,as:"div",children:h}),x!=="right"&&n.jsx(Ee,{direction:_})]})})})}),n.jsx("div",{style:{paddingLeft:"8px",paddingRight:"2px",cursor:"col-resize"},onPointerDown:w,children:n.jsx(We,{orientation:"vertical",size:"2",style:{background:"var(--gray-7)"}})})]})},h)})})})})]})}function Ee({direction:e}){return n.jsxs(n.Fragment,{children:[e===-1&&n.jsx(Xe,{height:12,width:12}),e===1&&n.jsx(Ye,{height:12,width:12})]})}function Tt(e,t){return{Table:r=>n.jsxs("table",{...r,className:"rt-TableRootTable",style:{...r.style,overflow:"inherit",tableLayout:"fixed"},children:[n.jsx("colgroup",{children:e.map(s=>n.jsx("col",{style:{width:t[s]}},s))}),r.children]}),TableHead:r=>n.jsx(ce,{...r,style:{...r.style,background:"#0e131c"}}),TableRow:r=>n.jsx($,{...r})}}function zt(){{const e=R(Qe);if(!e)return null;const t=de(e.activeStake),r=de(e.delinquentStake);return n.jsxs(b,{gap:"1",direction:"column",children:[n.jsx(C,{size:"4",children:"Validator Stats"}),n.jsxs(b,{align:"stretch",justify:"between",gap:"2",children:[n.jsxs(U,{columns:"repeat(auto-fit, minmax(200px, 1fr)",gap:"4",flexGrow:".6",children:[n.jsx(B,{label:"Total Validators",value:e.validatorCount.toLocaleString(),valueColor:Ze}),n.jsx(B,{label:"Non-delinquent Stake",value:t,valueColor:et}),n.jsx(B,{label:"RPC Nodes",value:e.rpcCount.toLocaleString(),valueColor:tt}),n.jsx(B,{label:"Delinquent Stake",value:r,valueColor:nt})]}),n.jsx(A,{minWidth:"100px",minHeight:"100px",flexGrow:"1",children:n.jsx(rt,{activeStake:e.activeStake,delinquentStake:e.delinquentStake})})]})]})}}const re="#30A46C",se="#A39073",q="#E5484D",N="#3E63DD";function Rt({health:e}){return n.jsxs(b,{gap:"2",children:[n.jsxs(b,{direction:"column",flexGrow:"1",gap:"2",children:[n.jsx(qt,{health:e}),n.jsx(Nt,{health:e})]}),n.jsxs(b,{direction:"column",flexGrow:"1",gap:"2",children:[n.jsx(Bt,{health:e}),n.jsx(It,{health:e})]}),n.jsxs(b,{direction:"column",flexGrow:"1",gap:"2",children:[n.jsx(Gt,{health:e}),n.jsx(Vt,{health:e})]})]})}function Bt({health:e}){return n.jsx(I,{children:n.jsxs(U,{columns:"auto 1fr",gapX:"6",gapY:"3",children:[n.jsx(At,{health:e}),n.jsx(Ot,{health:e})]})})}function It({health:e}){return n.jsx(I,{children:n.jsxs(U,{columns:"auto 1fr",gapX:"6",gapY:"3",children:[n.jsx(Pt,{health:e}),n.jsx($t,{health:e})]})})}function At({health:e}){const t=M(e.num_push_entries_rx_success+e.num_push_entries_rx_failure),r=M(e.num_push_entries_rx_duplicate);return n.jsx(ie,{label:"Push Duplicate /s",value:r,total:t,color:N})}function Ot({health:e}){const t=M(e.num_pull_response_entries_rx_success+e.num_pull_response_entries_rx_failure),r=M(e.num_pull_response_entries_rx_duplicate);return n.jsx(ie,{label:"Pull Duplicate /s",value:r,total:t,color:N})}function Pt({health:e}){const t=M(e.num_push_entries_rx_success+e.num_push_entries_rx_failure),r=M(e.num_push_entries_rx_failure-e.num_push_entries_rx_duplicate);return n.jsx(ie,{label:"Push Failure /s",value:r,total:t,color:q})}function $t({health:e}){const t=M(e.num_pull_response_entries_rx_success+e.num_pull_response_entries_rx_failure),r=M(e.num_pull_response_entries_rx_failure-e.num_pull_response_entries_rx_duplicate);return n.jsx(ie,{label:"Pull Failure /s",value:r,total:t,color:q})}function ie({label:e,value:t,total:r,color:s}){let i=t/r;isFinite(i)||(i=0);const o=`${Math.trunc(i*100).toLocaleString()}%`;return n.jsxs(n.Fragment,{children:[n.jsxs(b,{align:"end",justify:"between",minWidth:"170px",children:[n.jsx(E,{label:e,value:Math.trunc(t),valueColor:s,size:"sm"}),n.jsx(C,{style:{color:`color-mix(in srgb, ${st}, ${it} ${i*100}%)`,margin:"4px 0"},children:o??"-"})]}),n.jsx(Dt,{pct:i})]})}function Dt({pct:e}){const t=j.useRef(),[r,s]=j.useState([]);he(()=>{s(o=>{let l=[...o];return o.length>ae&&(l=l.slice(l.length-ae)),l.push(1-e),l})},fe);const i=j.useMemo(()=>{if(!t.current||!r.length)return;const{height:o,width:l}=t.current,c=r.length,p=l/c,d=o-10;return r.map((u,g)=>({x:g*p,y:u*d+5}))},[r]);return n.jsx(A,{flexGrow:"1",children:n.jsx(Z,{children:({height:o,width:l})=>(t.current={height:o,width:l},i?n.jsx(A,{height:`${o}px`,width:`${l}px`,children:n.jsx(at,{height:o,scaledDataPoints:i})}):null)})})}function qt({health:e}){const t=M(e.num_push_entries_rx_success+e.num_pull_response_entries_rx_success),r=M(e.num_push_entries_rx_success),s=M(e.num_pull_response_entries_rx_success);return n.jsx(I,{style:{flexGrow:1},children:n.jsxs(b,{gap:"6",children:[n.jsxs(b,{direction:"column",children:[n.jsx(E,{label:"Entries /s",value:Math.trunc(t).toLocaleString()}),n.jsxs(b,{gap:"3",children:[n.jsx(E,{label:"Push /s",value:Math.trunc(r).toLocaleString(),valueColor:"var(--green-9)",size:"sm"}),n.jsx(E,{label:"Pull /s",value:Math.trunc(s).toLocaleString(),valueColor:"var(--gold-10)",size:"sm"})]})]}),n.jsx(oe,{values:[s,r],colors:[se,re]})]})})}function Nt({health:e}){const t=M(e.num_push_messages_rx_success+e.num_pull_response_messages_rx_success),r=M(e.num_push_messages_rx_success),s=M(e.num_pull_response_messages_rx_success);return n.jsx(I,{style:{flexGrow:1},children:n.jsxs(b,{gap:"6",children:[n.jsxs(b,{direction:"column",children:[n.jsx(E,{label:"Messages /s",value:Math.trunc(t).toLocaleString()}),n.jsxs(b,{gap:"3",children:[n.jsx(E,{label:"Push /s",value:Math.trunc(r).toLocaleString(),valueColor:"var(--green-9)",size:"sm"}),n.jsx(E,{label:"Pull /s",value:Math.trunc(s).toLocaleString(),valueColor:"var(--gold-10)",size:"sm"})]})]}),n.jsx(oe,{values:[s,r],colors:[se,re]})]})})}function Gt({health:e}){const t=M(e.num_push_entries_rx_success),r=M(e.num_push_entries_rx_failure),s=M(e.num_push_entries_rx_duplicate),i=Math.max(r-s,0);return n.jsx(I,{style:{flexGrow:1},children:n.jsxs(b,{gap:"6",children:[n.jsxs(b,{direction:"column",children:[n.jsx(E,{label:"Push Entries /s",value:Math.trunc(t).toLocaleString(),valueColor:re}),n.jsxs(b,{gap:"3",children:[n.jsx(E,{label:"Duplicates /s",value:Math.trunc(s).toLocaleString(),valueColor:N,size:"sm"}),n.jsx(E,{label:"Failures /s",value:Math.trunc(i).toLocaleString(),valueColor:q,size:"sm"})]})]}),n.jsx(oe,{values:[i,s,t],colors:[q,N,re]})]})})}function Vt({health:e}){const t=M(e.num_pull_response_entries_rx_success),r=M(e.num_pull_response_entries_rx_failure),s=M(e.num_pull_response_entries_rx_duplicate),i=Math.max(r-s,0);return n.jsx(I,{style:{flexGrow:1},children:n.jsxs(b,{gap:"6",children:[n.jsxs(b,{direction:"column",children:[n.jsx(E,{label:"Pull Entries /s",value:Math.trunc(t).toLocaleString(),valueColor:se}),n.jsxs(b,{gap:"3",children:[n.jsx(E,{label:"Duplicates /s",value:Math.trunc(s).toLocaleString(),valueColor:N,size:"sm"}),n.jsx(E,{label:"Failures /s",value:Math.trunc(i).toLocaleString(),valueColor:q,size:"sm"})]})]}),n.jsx(oe,{values:[i,s,t],colors:[q,N,se]})]})})}const fe=150,Ht=3e4,ae=Math.trunc(Ht/fe),Ut=(e,t,r)=>e.length?(e[e.length-1].x=r,"M"+e.map(({x:s,y:i})=>`L ${s} ${t-i}`).join(" ").slice(1)+`L ${e[e.length-1].x} ${t} L ${e[0].x} ${t}, L ${e[0].x} ${e[0].y}`):"";function oe({values:e,colors:t}){const r=j.useRef(),[s,i]=j.useState([]);he(()=>{i(l=>{let c=[...l];return l.length>ae&&(c=c.slice(c.length-ae)),c.push(e),c})},fe);const o=j.useMemo(()=>{if(!r.current||!s.length)return;const{height:l,width:c}=r.current,p=s.length,d=c/p,u=l,g=s[0].length,a=new Array(g).fill(0).map(()=>new Array(s.length).fill(1));for(let f=0;f<s.length;f++){const v=H.sum(s[f]);for(let m=1;m<s[f].length;m++){const h=v?s[f][m-1]/v:0,x=h!==0&&h!==1?H.clamp(h,.02,.98):h;a[m][f]=a[m-1][f]-x}}return a.map((f,v)=>{const m=f.map((h,x)=>({x:x*d,y:h*u}));return{path:Ut(m,l,c),color:t[v]}})},[s,t]);return n.jsx(A,{flexGrow:"1",children:n.jsx(Z,{children:({height:l,width:c})=>(r.current={height:l,width:c},o?n.jsx(n.Fragment,{children:n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:c,height:l,children:o.map(({path:p,color:d})=>n.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:p,fill:d},d))})}):null)})})}var Wt=["top","left","transform","className","children","innerRef"];function xe(){return xe=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},xe.apply(this,arguments)}function Xt(e,t){if(e==null)return{};var r={},s=Object.keys(e),i,o;for(o=0;o<s.length;o++)i=s[o],!(t.indexOf(i)>=0)&&(r[i]=e[i]);return r}function X(e){var t=e.top,r=t===void 0?0:t,s=e.left,i=s===void 0?0:s,o=e.transform,l=e.className,c=e.children,p=e.innerRef,d=Xt(e,Wt);return O.createElement("g",xe({ref:p,className:ye("visx-group",l),transform:o||"translate("+i+", "+r+")"},d),c)}X.propTypes={top:y.number,left:y.number,transform:y.string,className:y.string,children:y.node,innerRef:y.oneOfType([y.string,y.func,y.object])};function Yt(e){var t=0,r=e.children,s=r&&r.length;if(!s)t=1;else for(;--s>=0;)t+=r[s].value;e.value=t}function Jt(){return this.eachAfter(Yt)}function Kt(e){var t=this,r,s=[t],i,o,l;do for(r=s.reverse(),s=[];t=r.pop();)if(e(t),i=t.children,i)for(o=0,l=i.length;o<l;++o)s.push(i[o]);while(s.length);return this}function Qt(e){for(var t=this,r=[t],s,i;t=r.pop();)if(e(t),s=t.children,s)for(i=s.length-1;i>=0;--i)r.push(s[i]);return this}function Zt(e){for(var t=this,r=[t],s=[],i,o,l;t=r.pop();)if(s.push(t),i=t.children,i)for(o=0,l=i.length;o<l;++o)r.push(i[o]);for(;t=s.pop();)e(t);return this}function en(e){return this.eachAfter(function(t){for(var r=+e(t.data)||0,s=t.children,i=s&&s.length;--i>=0;)r+=s[i].value;t.value=r})}function tn(e){return this.eachBefore(function(t){t.children&&t.children.sort(e)})}function nn(e){for(var t=this,r=rn(t,e),s=[t];t!==r;)t=t.parent,s.push(t);for(var i=s.length;e!==r;)s.splice(i,0,e),e=e.parent;return s}function rn(e,t){if(e===t)return e;var r=e.ancestors(),s=t.ancestors(),i=null;for(e=r.pop(),t=s.pop();e===t;)i=e,e=r.pop(),t=s.pop();return i}function sn(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t}function an(){var e=[];return this.each(function(t){e.push(t)}),e}function on(){var e=[];return this.eachBefore(function(t){t.children||e.push(t)}),e}function ln(){var e=this,t=[];return e.each(function(r){r!==e&&t.push({source:r.parent,target:r})}),t}function me(e,t){var r=new le(e),s=+e.value&&(r.value=e.value),i,o=[r],l,c,p,d;for(t==null&&(t=cn);i=o.pop();)if(s&&(i.value=+i.data.value),(c=t(i.data))&&(d=c.length))for(i.children=new Array(d),p=d-1;p>=0;--p)o.push(l=i.children[p]=new le(c[p])),l.parent=i,l.depth=i.depth+1;return r.eachBefore(dn)}function un(){return me(this).eachBefore(hn)}function cn(e){return e.children}function hn(e){e.data=e.data.data}function dn(e){var t=0;do e.height=t;while((e=e.parent)&&e.height<++t)}function le(e){this.data=e,this.depth=this.height=0,this.parent=null}le.prototype=me.prototype={constructor:le,count:Jt,each:Kt,eachAfter:Zt,eachBefore:Qt,sum:en,sort:tn,path:nn,ancestors:sn,descendants:an,leaves:on,links:ln,copy:un};function pn(e){if(typeof e!="function")throw new Error;return e}function Y(){return 0}function J(e){return function(){return e}}function gn(e){e.x0=Math.round(e.x0),e.y0=Math.round(e.y0),e.x1=Math.round(e.x1),e.y1=Math.round(e.y1)}function fn(e,t,r,s,i){for(var o=e.children,l,c=-1,p=o.length,d=e.value&&(s-t)/e.value;++c<p;)l=o[c],l.y0=r,l.y1=i,l.x0=t,l.x1=t+=l.value*d}function xn(e,t,r,s,i){for(var o=e.children,l,c=-1,p=o.length,d=e.value&&(i-r)/e.value;++c<p;)l=o[c],l.x0=t,l.x1=s,l.y0=r,l.y1=r+=l.value*d}var mn=(1+Math.sqrt(5))/2;function vn(e,t,r,s,i,o){for(var l=[],c=t.children,p,d,u=0,g=0,a=c.length,f,v,m=t.value,h,x,_,w,S,k,L;u<a;){f=i-r,v=o-s;do h=c[g++].value;while(!h&&g<a);for(x=_=h,k=Math.max(v/f,f/v)/(m*e),L=h*h*k,S=Math.max(_/L,L/x);g<a;++g){if(h+=d=c[g].value,d<x&&(x=d),d>_&&(_=d),L=h*h*k,w=Math.max(_/L,L/x),w>S){h-=d;break}S=w}l.push(p={value:h,dice:f<v,children:c.slice(u,g)}),p.dice?fn(p,r,s,i,m?s+=v*h/m:o):xn(p,r,s,m?r+=f*h/m:i,o),m-=h,u=g}return l}const Le=function e(t){function r(s,i,o,l,c){vn(t,s,i,o,l,c)}return r.ratio=function(s){return e((s=+s)>1?s:1)},r}(mn);function jn(){var e=Le,t=!1,r=1,s=1,i=[0],o=Y,l=Y,c=Y,p=Y,d=Y;function u(a){return a.x0=a.y0=0,a.x1=r,a.y1=s,a.eachBefore(g),i=[0],t&&a.eachBefore(gn),a}function g(a){var f=i[a.depth],v=a.x0+f,m=a.y0+f,h=a.x1-f,x=a.y1-f;h<v&&(v=h=(v+h)/2),x<m&&(m=x=(m+x)/2),a.x0=v,a.y0=m,a.x1=h,a.y1=x,a.children&&(f=i[a.depth+1]=o(a)/2,v+=d(a)-f,m+=l(a)-f,h-=c(a)-f,x-=p(a)-f,h<v&&(v=h=(v+h)/2),x<m&&(m=x=(m+x)/2),e(a,v,m,h,x))}return u.round=function(a){return arguments.length?(t=!!a,u):t},u.size=function(a){return arguments.length?(r=+a[0],s=+a[1],u):[r,s]},u.tile=function(a){return arguments.length?(e=pn(a),u):e},u.padding=function(a){return arguments.length?u.paddingInner(a).paddingOuter(a):u.paddingInner()},u.paddingInner=function(a){return arguments.length?(o=typeof a=="function"?a:J(+a),u):o},u.paddingOuter=function(a){return arguments.length?u.paddingTop(a).paddingRight(a).paddingBottom(a).paddingLeft(a):u.paddingTop()},u.paddingTop=function(a){return arguments.length?(l=typeof a=="function"?a:J(+a),u):l},u.paddingRight=function(a){return arguments.length?(c=typeof a=="function"?a:J(+a),u):c},u.paddingBottom=function(a){return arguments.length?(p=typeof a=="function"?a:J(+a),u):p},u.paddingLeft=function(a){return arguments.length?(d=typeof a=="function"?a:J(+a),u):d},u}function ke(e){var t=e.node,r=t.x0,s=t.x1,i=t.y0,o=t.y1;return O.createElement("rect",{x:r,y:i,width:Math.abs(s-r),height:Math.abs(o-i),fill:"#21D4FD"})}ke.propTypes={node:y.shape({x0:y.number.isRequired,x1:y.number.isRequired,y0:y.number.isRequired,y1:y.number.isRequired}).isRequired};function P(e,t){e(t)}function Fe(e){var t=e.top,r=e.left,s=e.className,i=e.root,o=e.tile,l=e.size,c=e.round,p=e.padding,d=e.paddingInner,u=e.paddingOuter,g=e.paddingTop,a=e.paddingRight,f=e.paddingBottom,v=e.paddingLeft,m=e.children,h=e.nodeComponent,x=h===void 0?ke:h,_=jn();o&&_.tile(o),l&&_.size(l),c&&_.round(c),p&&P(_.padding,p),d&&P(_.paddingInner,d),u&&P(_.paddingOuter,u),g&&P(_.paddingTop,g),a&&P(_.paddingRight,a),f&&P(_.paddingBottom,f),v&&P(_.paddingLeft,v);var w=_(i);return m?O.createElement(O.Fragment,null,m(w)):O.createElement(X,{top:t,left:r,className:ye("visx-treemap",s)},x&&w.descendants().map(function(S,k){return O.createElement(X,{key:"treemap-node-"+k},O.createElement(x,{node:S}))}))}Fe.propTypes={children:y.func,top:y.number,left:y.number,className:y.string,round:y.bool,padding:y.oneOfType([y.number,y.func]),paddingInner:y.oneOfType([y.number,y.func]),paddingOuter:y.oneOfType([y.number,y.func]),paddingTop:y.oneOfType([y.number,y.func]),paddingRight:y.oneOfType([y.number,y.func]),paddingBottom:y.oneOfType([y.number,y.func]),paddingLeft:y.oneOfType([y.number,y.func])};const Te=["#00F0FF","#00B5FF","#5BFFFF","#00FFD1","#0EEAD5","#D9F8FF"];function ze({networkTraffic:e,label:t,includeAll:r=!1}){const s=R(ot),i=j.useMemo(()=>{var g,a;if(!e.peer_throughput)return;const l=.7;let c=0,p=0;const d=[];for(;p<e.peer_throughput.length&&c*l<(e.total_throughput??0);){const f=((g=e.peer_names)==null?void 0:g[p])||((a=e.peer_identities)==null?void 0:a[p])||"",v=Te[Math.trunc(Math.random()*Te.length)];d.push({id:f,value:e.peer_throughput[p],color:v}),c+=e.peer_throughput[p],p++}let u=0;for(p;p<e.peer_throughput.length;p++)u+=e.peer_throughput[p];return d.push({id:"rest",value:r?(e.total_throughput??0)-c:u,color:"#1CE7C2"}),{id:"peers",children:d,color:void 0,value:e.total_throughput}},[r,e]),o=j.useCallback(l=>{var a,f,v;const c=s[l];if(!c)return;const p=H.sum(c.vote.map(m=>m.delinquent?0:Number(m.activated_stake))),d=p?`${de(p)} SOL`:void 0,u=((a=c.info)==null?void 0:a.icon_url)||((f=c.info)!=null&&f.keybase_username?`https://keybase.io/${c.info.keybase_username}/picture`:void 0)||void 0,g=((v=c.info)==null?void 0:v.name)??void 0;return{stake:d,iconUrl:u,name:g}},[s]);if(i)return n.jsxs(b,{direction:"column",minHeight:"300px",children:[n.jsxs(b,{justify:"between",children:[n.jsx(C,{size:"4",children:t}),n.jsxs("span",{children:[n.jsx(C,{size:"4",style:{color:"var(--gray-11)"},children:"Total:"}),n.jsxs(C,{size:"4",children:["\xA0",Q(e.total_throughput).toString(),"\xA0/s"]})]})]}),n.jsx(Z,{children:({height:l,width:c})=>n.jsx(Mn,{data:i,width:c,height:l,getPeerValues:o})})]})}const K=(()=>{let e=null,t=null;return(r,s)=>(e||(e=document.createElement("canvas")),t||(t=e.getContext("2d")),t?(t.font=s,t.measureText(r).width):r.length*7)})();function _n(e,t,r){if(K(e,t)<=r)return e;const s="\u2026";if(K(s,t)>r)return"";let i=0,o=e.length;for(;i<o;){const l=Math.ceil((i+o)/2),c=e.slice(0,l)+s;K(c,t)<=r?i=l:o=l-1}return e.slice(0,i)+s}const Re=55,yn=40,bn=8,wn=2;function Mn({data:e,width:t,height:r,colors:s,getPeerValues:i}){const o=j.useMemo(()=>e.children.reduce((d,u)=>d+(u.value||0),0),[e]),l=j.useMemo(()=>me({name:e.id,children:e.children.map(d=>({name:d.id,value:d.value}))}).sum(d=>d.value||0).sort((d,u)=>(u.value||0)-(d.value||0)),[e]),c=j.useMemo(()=>{const d=s??["#48295C","#562800","#132D21","#331E0B","#0D2847","#292929"];return lt().domain(e.children.map(u=>u.id)).range(d)},[e,s]),p=j.useMemo(()=>Le.ratio(1.1),[]);return n.jsx("svg",{width:t,height:r,children:n.jsx(Fe,{root:l,size:[t,r],tile:p,round:!0,paddingInner:2,children:d=>n.jsx(X,{children:d.leaves().map(u=>{const g=u.x0,a=u.y0,f=u.x1-u.x0,v=u.y1-u.y0,m=String(u.data.name);return n.jsxs(X,{children:[n.jsx("rect",{x:g,y:a,width:f,height:v,rx:1,ry:1,fill:c(m)}),n.jsx(Sn,{leaf:u,total:o,getPeerValues:i})]},m)})})})})}function Sn({leaf:e,total:t,getPeerValues:r}){const s=e.x0,i=e.y0,o=e.x1-e.x0,l=e.y1-e.y0,c=String(e.data.name),p=t>0?100*(e.value||0)/t:0,d=o>=Re&&l>=yn,u=l>30*2,g=Math.max(11,Math.min(16,Math.floor(o/12))),a=r(c),f=`${g}px Inter Tight`,v=s+o/2,m=g+wn,h=i+l/3,x=2,_=g+4,w=Math.max(0,o-2*bn-(_?_+x:0)),S=_n((a==null?void 0:a.name)??c,f,w),k=K(S,f),L=(_?_+x:0)+k,z=v-L/2,T=h,G=Q(e.value??0);let ue=`${G?`${G.toString()} `:""}(${p.toFixed(1)}%)`;if(K(ue,f)<w||(ue=`${G.toString()}`),!(o<Re))return n.jsxs(n.Fragment,{children:[a!=null&&a.iconUrl?n.jsxs(n.Fragment,{children:["(",n.jsx("image",{href:a.iconUrl,x:z,y:T,width:_,height:_,preserveAspectRatio:"xMidYMid meet",crossOrigin:"anonymous"}),n.jsx("text",{x:z+_+x,y:T,fontSize:g,alignmentBaseline:"text-before-edge",fontFamily:"Inter Tight",fontWeight:600,fill:"#CCCCCC",textAnchor:"start",pointerEvents:"none",children:S}),")"]}):n.jsx("text",{x:v,y:T,fontSize:g,fontFamily:"Inter Tight",fontWeight:600,fill:"#CCCCCC",alignmentBaseline:"text-before-edge",textAnchor:"middle",pointerEvents:"none",children:S}),d&&n.jsx(n.Fragment,{children:n.jsxs("text",{x:v,y:T+12,fontSize:g,fontFamily:"Inter Tight",fill:"#CCCCCC",pointerEvents:"none",alignmentBaseline:"text-before-edge",textAnchor:"middle",children:[n.jsx("tspan",{x:v,dy:m,fill:"#8A8A8A",children:ue}),u&&n.jsx("tspan",{x:v,dy:m,fill:"#8A8A8A",children:a==null?void 0:a.stake})]})})]})}function Cn(){const e=R(ut),t=R(ct),[r]=ht(t,5e3,{maxWait:5e3}),s=t==null?void 0:t.health,i=t==null?void 0:t.storage,o=R(dt)==="running"?"running":"startup";if(e==="Firedancer"&&!(!s||!i||!r))return n.jsxs(b,{gap:"6",direction:"column",align:"stretch",justify:"center",mx:"4",height:"100%",children:[n.jsxs(U,{columns:"repeat(auto-fit, minmax(min(100%, 600px), 1fr))",gapX:"6",gapY:"6",children:[n.jsx(ze,{networkTraffic:r.ingress,label:"Ingress Peers"}),n.jsx(ze,{networkTraffic:r.egress,label:"Egress Peers"}),n.jsx(yt,{storage:i}),n.jsx(zt,{}),n.jsx(_t,{storage:i}),n.jsx(Ct,{messages:t.messages})]},o),n.jsx(Rt,{health:s}),n.jsx(Ft,{})]})}export{Cn as default};
