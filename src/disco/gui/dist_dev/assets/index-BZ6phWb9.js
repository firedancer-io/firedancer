import{u as me,b as W,j as t,T as G,r as v,p as y,a as E,m as je,d as le,P as L,f as k,c as ve,R as _e,o as B,l as N,e as oe,g as V,h as R,A as J,$ as Re,i as Ae,k as $,n as Pe,q as Ie,s as Oe,Z as qe,C as De,t as We,v as Ge,w as Ne,x as ue,y as Ve,z as He,B as Ue,D as Xe,E as Ye,F as Je,G as Ke,S as Ze,H as A,I as ye,_ as j,J as Qe,K as et,L as tt,M as nt,N as rt,O as st}from"./index-euWjzME9.js";function O({inBytes:e,value:n}){const{valuePerSecond:s}=me(n,5e3)??0,r=s!==void 0?e?W(s).toString():Math.trunc(s).toLocaleString():"-";return t.jsx(G,{align:"right",children:r})}const K=["ContactInfoV1","Vote","LowestSlot","SnapshotHashes","AccountsHashes","EpochSlots","VersionV1","VersionV2","NodeInstance","DuplicateShred","IncrementalSnapshotHashes","ContactInfoV2","RestartLastVotedForkSlots","RestartHeaviestFork"],it=["pull_request","pull_response","push","ping","pong","prune"],at="_root_zd40k_1",be={root:at};function lt({storage:e}){const n=v.useMemo(()=>{if(e!=null&&e.count)return e.count.map((s,r)=>{var i,o,l;return{type:K[r],activeEntries:(i=e.count)==null?void 0:i[r],egressCount:(o=e.count_tx)==null?void 0:o[r],egressBytes:(l=e.bytes_tx)==null?void 0:l[r]}}).sort((s,r)=>r.activeEntries-s.activeEntries)},[e]);if(n)return t.jsxs(y,{direction:"column",gap:"1",style:{contain:"size",minHeight:"250px"},children:[t.jsx(E,{size:"4",children:"Storage Stats"}),t.jsxs(je,{variant:"surface",className:be.root,style:{minHeight:0},children:[t.jsx(le,{children:t.jsxs(L,{children:[t.jsx(k,{children:"Entry Type"}),t.jsx(k,{align:"right",children:"Total Entries"}),t.jsx(k,{align:"right",children:"Egress /s"}),t.jsx(k,{align:"right",children:"Egress Throughput /s"})]})}),t.jsx(ve,{children:n==null?void 0:n.map(s=>t.jsxs(L,{children:[t.jsx(_e,{children:s.type}),t.jsx(G,{align:"right",children:s.activeEntries.toLocaleString()}),t.jsx(O,{value:s.egressCount??0}),t.jsx(O,{value:s.egressBytes??0,inBytes:!0})]},s.type))})]})]})}function z(e){return t.jsx(B,{children:t.jsx(w,{...e})})}function w({value:e,label:n,valueColor:s,size:r}){const i=typeof e=="string"?e:e.toLocaleString();return t.jsxs(y,{direction:"column",children:[t.jsx(E,{size:"5",style:{color:"var(--gray-10)"},children:n}),t.jsx(E,{size:r==="sm"?"7":"8",style:{color:s??"var(--gray-11)"},children:i})]})}function ot({storage:e}){var l;const n=v.useMemo(()=>{if(e!=null&&e.count)return e.count.map((c,d)=>{var h,u,g;return{type:K[d],activeEntries:(h=e.count)==null?void 0:h[d],egressCount:(u=e.count_tx)==null?void 0:u[d],egressBytes:(g=e.bytes_tx)==null?void 0:g[d]}})},[e]),s=v.useMemo(()=>{const c=N.sum(e.count),d=e.capacity-c;return`${Math.round(c/d*100)}%`},[e.capacity,e.count]),r=me(e.expired_count,1e4),i=v.useRef([]);v.useMemo(()=>{i.current.push({ts:performance.now(),value:e.expired_count})},[e.expired_count]),oe(()=>{const c=performance.now();for(;i.current.length>1&&c-i.current[0].ts>6e4;)i.current.shift()},1e3);const o=e.expired_count-(((l=i.current[0])==null?void 0:l.value)??0);if(n)return t.jsxs(y,{direction:"column",gap:"1",children:[t.jsx(E,{size:"4",children:"Storage Stats"}),t.jsxs(y,{gap:"1",children:[t.jsxs(V,{columns:"repeat(auto-fill, minmax(160px, 1fr)",gap:"4",flexGrow:"1",children:[t.jsx(z,{label:"Expired /s",value:`${Math.trunc(r.valuePerSecond??0)}`}),t.jsx(z,{label:"Expired last min",value:`${o.toLocaleString()}`}),t.jsx(z,{label:"Total Evicted",value:e.evicted_count}),t.jsx(z,{label:"Capacity Used",value:s})]}),t.jsx(R,{flexGrow:"1",children:t.jsx(ut,{storage:e})})]})]})}const Me=["#48295C","#562800","#132D21"],Se=e=>Me[e%Me.length];function ut({storage:e}){const{data:n,usedCapacityLabel:s}=v.useMemo(()=>{const r=N.sum(e.count),i=e.capacity-r;return{usedCapacityLabel:`${Math.round(r/i*100)}%`,data:[{id:"unused",label:"Unused",value:i,color:"#222"},...e.count.map((o,l)=>({id:K[l]+l,label:K[l],value:o,color:Se(l)})).sort((o,l)=>l.value-o.value).map((o,l)=>({...o,color:Se(l)}))]}},[e]);return t.jsx(J,{children:({height:r,width:i})=>t.jsx(Re,{height:r,width:i,data:n,colors:o=>o.data.color,arcLabelsSkipAngle:10,arcLinkLabelsSkipAngle:10,arcLabelsTextColor:"#9F9F9F",enableArcLinkLabels:!1,layers:["arcs","arcLabels",ct(s)],animate:!1,innerRadius:.7,arcLabel:o=>o.data.label})})}const ct=e=>({dataWithArc:n,centerX:s,centerY:r})=>t.jsx("text",{y:r-6,textAnchor:"middle",dominantBaseline:"central",style:{fontSize:"28px",fill:"#9F9F9F"},children:t.jsx("tspan",{x:s,dy:5,children:e})});function ht({messages:e}){const n=v.useMemo(()=>e.num_bytes_rx.map((s,r)=>{var i,o,l,c;return{type:it[r],ingressBytes:(i=e.num_bytes_rx)==null?void 0:i[r],egressBytes:(o=e.num_bytes_tx)==null?void 0:o[r],ingressMessages:(l=e.num_messages_rx)==null?void 0:l[r],egressMessages:(c=e.num_messages_tx)==null?void 0:c[r]}}),[e]);if(n)return t.jsxs(y,{direction:"column",gap:"1",children:[t.jsx(E,{size:"4",children:"Message Stats"}),t.jsxs(je,{variant:"surface",className:be.root,children:[t.jsx(le,{children:t.jsxs(L,{children:[t.jsx(k,{children:"Message Type"}),t.jsx(k,{align:"right",children:"Ingress /s"}),t.jsx(k,{align:"right",children:"Egress /s"}),t.jsx(k,{align:"right",children:"Ingress Throughput /s"}),t.jsx(k,{align:"right",children:"Egress Throughput /s"})]})}),t.jsx(ve,{children:n==null?void 0:n.map((s,r)=>t.jsxs(L,{children:[t.jsx(_e,{children:s.type}),t.jsx(O,{value:s.ingressMessages??0}),t.jsx(O,{value:s.egressMessages??0}),t.jsx(O,{value:s.ingressBytes??0,inBytes:!0}),t.jsx(O,{value:s.egressBytes??0,inBytes:!0})]},s.type))})]})]})}const we={id:"Stake",direction:-1};function dt(){const e=Ae(),n=$(Pe),s=$(Ie),r=v.useRef(new Map),[i,o]=v.useState([]),[l,c]=v.useState(we);v.useEffect(()=>{var g;if(!n)return;const u=Object.entries(n);if(!i.length&&((g=u[0])!=null&&g[1])){const a=Object.keys(u[0][1]);o(a),c(we)}u.forEach(([a,p])=>{r.current.set(a,p)})},[i,n]),v.useEffect(()=>{if(s)for(const u of s.changes){const g=r.current.get(u.row_index.toString());g&&(g[u.column_name]=u.new_value)}},[s]);const d=v.useCallback((u,g)=>{if(g<u||u<0)return;const a={start_row:u,row_cnt:g-u};e({topic:"gossip",key:"query_scroll",id:16,params:a})},[e]),h=v.useCallback(u=>{(i==null?void 0:i.indexOf(u))!==void 0&&c(g=>{let a=-1;g.id===u&&(a=-g.direction);const p=i.filter(x=>x!==u),m=new Array(p.length).fill(0),f={col:[u,...p],dir:[a,...m]};return e({topic:"gossip",key:"query_sort",id:32,params:f}),{id:u,direction:a}})},[i,e]);return{query:d,sort:h,cols:i,rowsCacheRef:r,colSorting:l}}const gt="_header-cell_eqr0d_27",pt={headerCell:gt},ft=1e3,ce=0,Z=e=>{if(typeof e=="number"){const n=W(e);return`${n.value} ${n.unit}`}return e},he={Stake:{minWidth:100,align:"right",format:e=>typeof e=="number"?Math.abs(Math.trunc(e/Ge)).toLocaleString():e},Pubkey:{minWidth:400},"IP Addr":{minWidth:160},"Ingress Pull":{minWidth:100,align:"right",format:Z},"Ingress Push":{minWidth:100,align:"right",format:Z},"Egress Pull":{minWidth:100,align:"right",format:Z},"Egress Push":{minWidth:100,align:"right",format:Z}};function xt(){const e=$(Oe)??ft,{query:n,sort:s,cols:r,rowsCacheRef:i,colSorting:o}=dt(),l=v.useCallback(({startIndex:c,endIndex:d})=>{const h=Math.max(0,c-ce),u=Math.min(d+ce,e>0?e-1:d+ce);n(h,u)},[n,e]);return t.jsxs(y,{direction:"column",flexGrow:"1",children:[t.jsx(E,{size:"4",children:"Peers"}),t.jsx(R,{className:"rt-TableRoot rt-r-size-2 rt-variant-surface",flexGrow:"1",minHeight:"300px",children:t.jsx(qe,{className:"rt-TableRootTable",style:{overflow:"auto"},totalCount:e,increaseViewportBy:200,rangeChanged:l,itemContent:c=>{var u;const d=(u=i.current)==null?void 0:u.get(c.toString());if(!d)return r!=null&&r.length?t.jsx(L,{children:r.map(g=>{const a=he[g].minWidth??30;return t.jsx(G,{style:{minWidth:a},children:"\xA0"},g)})}):t.jsx(L,{children:t.jsx(G,{children:"&nsbsp;"})});const h=Object.entries(d);return t.jsx(L,{children:h.map(([g,a])=>{const p=he[g],m=p.minWidth,f=p.align,x=p.format;return t.jsx(G,{align:f,style:{minWidth:m},children:x?x(a):a},g)})})},fixedHeaderContent:()=>t.jsx(t.Fragment,{children:t.jsx(le,{style:{background:"#0e131c"},children:t.jsx(L,{children:r==null?void 0:r.map(c=>{const d=he[c],h=d.minWidth,u=d.align,g=o.id===c?o.direction:void 0;return t.jsx(k,{align:u,onClick:()=>s(c),className:pt.headerCell,style:{minWidth:h},children:t.jsxs(y,{children:[t.jsx(E,{children:c}),t.jsx(R,{flexGrow:"1"}),g===-1&&t.jsx(De,{}),g===1&&t.jsx(We,{})]})},c)})})})})})})]})}function mt(){{const e=$(Ne);if(!e)return null;const n=ue(e.activeStake),s=ue(e.delinquentStake);return t.jsxs(y,{gap:"1",direction:"column",children:[t.jsx(E,{size:"4",children:"Validator Stats"}),t.jsxs(y,{align:"stretch",justify:"between",gap:"2",children:[t.jsxs(V,{columns:"repeat(auto-fit, minmax(200px, 1fr)",gap:"4",flexGrow:".6",children:[t.jsx(z,{label:"Total Validators",value:e.validatorCount.toLocaleString(),valueColor:Ve}),t.jsx(z,{label:"Non-delinquent Stake",value:n,valueColor:He}),t.jsx(z,{label:"RPC Nodes",value:e.rpcCount.toLocaleString(),valueColor:Ue}),t.jsx(z,{label:"Delinquent Stake",value:s,valueColor:Xe})]}),t.jsx(R,{style:{minWidth:"100px",minHeight:"100px"},flexGrow:"1",children:t.jsx(Ye,{activeStake:e.activeStake,delinquentStake:e.delinquentStake})})]})]})}}const de={forceUpdateIntervalMs:1e3,halfLifeMs:1e4};function jt(e,{forceUpdateIntervalMs:n,halfLifeMs:s}=de){const r=v.useMemo(()=>(s??de.halfLifeMs)/Math.log(2),[s]),[i,o]=v.useState(),l=v.useRef(),c=v.useRef(e);c.current=e;const d=v.useCallback(g=>{var _;g=g!==void 0?g:c.current;const a=performance.now();if(l.current===void 0){g!=null&&(l.current={value:g,tsMs:a});return}g==null&&(g=(_=l.current)==null?void 0:_.value);const{value:p,tsMs:m}=l.current,f=a-m;if(!isFinite(f)||f<=0)return;const x=g-p;!isFinite(x)||x<0||(l.current={value:g,tsMs:a},o(b=>{const M=x/f*1e3;if(b===void 0)return M;const C=-Math.expm1(-f/r);return b*(1-C)+M*C}))},[r]),h=v.useRef();v.useEffect(()=>{if(h.current!==void 0&&clearTimeout(h.current),d(e),n!==void 0){let g=function(){h.current=setTimeout(()=>{d(),g()},n)};g()}return()=>{h.current!==void 0&&clearTimeout(h.current)}},[n,d,e]);const u=v.useCallback(()=>{o(void 0),l.current=void 0,h.current!==void 0&&(clearTimeout(h.current),h.current=void 0)},[]);return{ema:i,reset:u}}function S(e,n=de){return jt(e,n).ema??0}const Q="#30A46C",ee="#A39073",q="#E5484D",D="#3E63DD";function vt({health:e}){return t.jsxs(y,{gap:"2",children:[t.jsxs(y,{direction:"column",flexGrow:"1",gap:"2",children:[t.jsx(Tt,{health:e}),t.jsx(Et,{health:e})]}),t.jsxs(y,{direction:"column",flexGrow:"1",gap:"2",children:[t.jsx(_t,{health:e}),t.jsx(yt,{health:e})]}),t.jsxs(y,{direction:"column",flexGrow:"1",gap:"2",children:[t.jsx(Ft,{health:e}),t.jsx(kt,{health:e})]})]})}function _t({health:e}){return t.jsx(B,{children:t.jsxs(V,{columns:"auto 1fr",gapX:"6",gapY:"3",children:[t.jsx(bt,{health:e}),t.jsx(Mt,{health:e})]})})}function yt({health:e}){return t.jsx(B,{children:t.jsxs(V,{columns:"auto 1fr",gapX:"6",gapY:"3",children:[t.jsx(St,{health:e}),t.jsx(wt,{health:e})]})})}function bt({health:e}){const n=S(e.num_push_entries_rx_success+e.num_push_entries_rx_failure),s=S(e.num_push_entries_rx_duplicate);return t.jsx(te,{label:"Push Duplicate /s",value:s,total:n,color:D})}function Mt({health:e}){const n=S(e.num_pull_response_entries_rx_success+e.num_pull_response_entries_rx_failure),s=S(e.num_pull_response_entries_rx_duplicate);return t.jsx(te,{label:"Pull Duplicate /s",value:s,total:n,color:D})}function St({health:e}){const n=S(e.num_push_entries_rx_success+e.num_push_entries_rx_failure),s=S(e.num_push_entries_rx_failure-e.num_push_entries_rx_duplicate);return t.jsx(te,{label:"Push Failure /s",value:s,total:n,color:q})}function wt({health:e}){const n=S(e.num_pull_response_entries_rx_success+e.num_pull_response_entries_rx_failure),s=S(e.num_pull_response_entries_rx_failure-e.num_pull_response_entries_rx_duplicate);return t.jsx(te,{label:"Pull Failure /s",value:s,total:n,color:q})}function te({label:e,value:n,total:s,color:r}){let i=n/s;isFinite(i)||(i=0);const o=`${Math.trunc(i*100).toLocaleString()}%`;return t.jsxs(t.Fragment,{children:[t.jsxs(y,{align:"end",justify:"between",minWidth:"170px",children:[t.jsx(w,{label:e,value:Math.trunc(n),valueColor:r,size:"sm"}),t.jsx(E,{style:{color:`color-mix(in srgb, ${Je}, ${Ke} ${i*100}%)`,margin:"4px 0"},children:o??"-"})]}),t.jsx(Ct,{pct:i})]})}function Ct({pct:e}){const n=v.useRef(),[s,r]=v.useState([]);oe(()=>{r(o=>{let l=[...o];return o.length>ne&&(l=l.slice(l.length-ne)),l.push(1-e),l})},ge);const i=v.useMemo(()=>{if(!n.current||!s.length)return;const{height:o,width:l}=n.current,c=s.length,d=l/c,h=o-10;return s.map((u,g)=>({x:g*d,y:u*h+5}))},[s]);return t.jsx(R,{flexGrow:"1",children:t.jsx(J,{children:({height:o,width:l})=>(n.current={height:o,width:l},i?t.jsx(R,{height:`${o}px`,width:`${l}px`,children:t.jsx(Ze,{height:o,scaledDataPoints:i})}):null)})})}function Tt({health:e}){const n=S(e.num_push_entries_rx_success+e.num_pull_response_entries_rx_success),s=S(e.num_push_entries_rx_success),r=S(e.num_pull_response_entries_rx_success);return t.jsx(B,{style:{flexGrow:1},children:t.jsxs(y,{gap:"6",children:[t.jsxs(y,{direction:"column",children:[t.jsx(w,{label:"Entries /s",value:Math.trunc(n).toLocaleString()}),t.jsxs(y,{gap:"3",children:[t.jsx(w,{label:"Push /s",value:Math.trunc(s).toLocaleString(),valueColor:"var(--green-9)",size:"sm"}),t.jsx(w,{label:"Pull /s",value:Math.trunc(r).toLocaleString(),valueColor:"var(--gold-10)",size:"sm"})]})]}),t.jsx(re,{values:[r,s],colors:[ee,Q]})]})})}function Et({health:e}){const n=S(e.num_push_messages_rx_success+e.num_pull_response_messages_rx_success),s=S(e.num_push_messages_rx_success),r=S(e.num_pull_response_messages_rx_success);return t.jsx(B,{style:{flexGrow:1},children:t.jsxs(y,{gap:"6",children:[t.jsxs(y,{direction:"column",children:[t.jsx(w,{label:"Messages /s",value:Math.trunc(n).toLocaleString()}),t.jsxs(y,{gap:"3",children:[t.jsx(w,{label:"Push /s",value:Math.trunc(s).toLocaleString(),valueColor:"var(--green-9)",size:"sm"}),t.jsx(w,{label:"Pull /s",value:Math.trunc(r).toLocaleString(),valueColor:"var(--gold-10)",size:"sm"})]})]}),t.jsx(re,{values:[r,s],colors:[ee,Q]})]})})}function Ft({health:e}){const n=S(e.num_push_entries_rx_success),s=S(e.num_push_entries_rx_failure),r=S(e.num_push_entries_rx_duplicate),i=Math.max(s-r,0);return t.jsx(B,{style:{flexGrow:1},children:t.jsxs(y,{gap:"6",children:[t.jsxs(y,{direction:"column",children:[t.jsx(w,{label:"Push Entries /s",value:Math.trunc(n).toLocaleString(),valueColor:Q}),t.jsxs(y,{gap:"3",children:[t.jsx(w,{label:"Duplicates /s",value:Math.trunc(r).toLocaleString(),valueColor:D,size:"sm"}),t.jsx(w,{label:"Failures /s",value:Math.trunc(i).toLocaleString(),valueColor:q,size:"sm"})]})]}),t.jsx(re,{values:[i,r,n],colors:[q,D,Q]})]})})}function kt({health:e}){const n=S(e.num_pull_response_entries_rx_success),s=S(e.num_pull_response_entries_rx_failure),r=S(e.num_pull_response_entries_rx_duplicate),i=Math.max(s-r,0);return t.jsx(B,{style:{flexGrow:1},children:t.jsxs(y,{gap:"6",children:[t.jsxs(y,{direction:"column",children:[t.jsx(w,{label:"Pull Entries /s",value:Math.trunc(n).toLocaleString(),valueColor:ee}),t.jsxs(y,{gap:"3",children:[t.jsx(w,{label:"Duplicates /s",value:Math.trunc(r).toLocaleString(),valueColor:D,size:"sm"}),t.jsx(w,{label:"Failures /s",value:Math.trunc(i).toLocaleString(),valueColor:q,size:"sm"})]})]}),t.jsx(re,{values:[i,r,n],colors:[q,D,ee]})]})})}const ge=150,Lt=3e4,ne=Math.trunc(Lt/ge),$t=(e,n,s)=>e.length?(e[e.length-1].x=s,"M"+e.map(({x:r,y:i})=>`L ${r} ${n-i}`).join(" ").slice(1)+`L ${e[e.length-1].x} ${n} L ${e[0].x} ${n}, L ${e[0].x} ${e[0].y}`):"";function re({values:e,colors:n}){const s=v.useRef(),[r,i]=v.useState([]);oe(()=>{i(l=>{let c=[...l];return l.length>ne&&(c=c.slice(c.length-ne)),c.push(e),c})},ge);const o=v.useMemo(()=>{if(!s.current||!r.length)return;const{height:l,width:c}=s.current,d=r.length,h=c/d,u=l,g=r[0].length,a=new Array(g).fill(0).map(()=>new Array(r.length).fill(1));for(let p=0;p<r.length;p++){const m=N.sum(r[p]);for(let f=1;f<r[p].length;f++){const x=m?r[p][f-1]/m:0,_=x!==0&&x!==1?N.clamp(x,.02,.98):x;a[f][p]=a[f-1][p]-_}}return a.map((p,m)=>{const f=p.map((x,_)=>({x:_*h,y:x*u}));return{path:$t(f,l,c),color:n[m]}})},[r,n]);return t.jsx(R,{flexGrow:"1",children:t.jsx(J,{children:({height:l,width:c})=>(s.current={height:l,width:c},o?t.jsx(t.Fragment,{children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:c,height:l,children:o.map(({path:d,color:h})=>t.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d,fill:h},h))})}):null)})})}var zt=["top","left","transform","className","children","innerRef"];function pe(){return pe=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var s=arguments[n];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e},pe.apply(this,arguments)}function Bt(e,n){if(e==null)return{};var s={},r=Object.keys(e),i,o;for(o=0;o<r.length;o++)i=r[o],!(n.indexOf(i)>=0)&&(s[i]=e[i]);return s}function H(e){var n=e.top,s=n===void 0?0:n,r=e.left,i=r===void 0?0:r,o=e.transform,l=e.className,c=e.children,d=e.innerRef,h=Bt(e,zt);return A.createElement("g",pe({ref:d,className:ye("visx-group",l),transform:o||"translate("+i+", "+s+")"},h),c)}H.propTypes={top:j.number,left:j.number,transform:j.string,className:j.string,children:j.node,innerRef:j.oneOfType([j.string,j.func,j.object])};function Rt(e){var n=0,s=e.children,r=s&&s.length;if(!r)n=1;else for(;--r>=0;)n+=s[r].value;e.value=n}function At(){return this.eachAfter(Rt)}function Pt(e){var n=this,s,r=[n],i,o,l;do for(s=r.reverse(),r=[];n=s.pop();)if(e(n),i=n.children,i)for(o=0,l=i.length;o<l;++o)r.push(i[o]);while(r.length);return this}function It(e){for(var n=this,s=[n],r,i;n=s.pop();)if(e(n),r=n.children,r)for(i=r.length-1;i>=0;--i)s.push(r[i]);return this}function Ot(e){for(var n=this,s=[n],r=[],i,o,l;n=s.pop();)if(r.push(n),i=n.children,i)for(o=0,l=i.length;o<l;++o)s.push(i[o]);for(;n=r.pop();)e(n);return this}function qt(e){return this.eachAfter(function(n){for(var s=+e(n.data)||0,r=n.children,i=r&&r.length;--i>=0;)s+=r[i].value;n.value=s})}function Dt(e){return this.eachBefore(function(n){n.children&&n.children.sort(e)})}function Wt(e){for(var n=this,s=Gt(n,e),r=[n];n!==s;)n=n.parent,r.push(n);for(var i=r.length;e!==s;)r.splice(i,0,e),e=e.parent;return r}function Gt(e,n){if(e===n)return e;var s=e.ancestors(),r=n.ancestors(),i=null;for(e=s.pop(),n=r.pop();e===n;)i=e,e=s.pop(),n=r.pop();return i}function Nt(){for(var e=this,n=[e];e=e.parent;)n.push(e);return n}function Vt(){var e=[];return this.each(function(n){e.push(n)}),e}function Ht(){var e=[];return this.eachBefore(function(n){n.children||e.push(n)}),e}function Ut(){var e=this,n=[];return e.each(function(s){s!==e&&n.push({source:s.parent,target:s})}),n}function fe(e,n){var s=new se(e),r=+e.value&&(s.value=e.value),i,o=[s],l,c,d,h;for(n==null&&(n=Yt);i=o.pop();)if(r&&(i.value=+i.data.value),(c=n(i.data))&&(h=c.length))for(i.children=new Array(h),d=h-1;d>=0;--d)o.push(l=i.children[d]=new se(c[d])),l.parent=i,l.depth=i.depth+1;return s.eachBefore(Kt)}function Xt(){return fe(this).eachBefore(Jt)}function Yt(e){return e.children}function Jt(e){e.data=e.data.data}function Kt(e){var n=0;do e.height=n;while((e=e.parent)&&e.height<++n)}function se(e){this.data=e,this.depth=this.height=0,this.parent=null}se.prototype=fe.prototype={constructor:se,count:At,each:Pt,eachAfter:Ot,eachBefore:It,sum:qt,sort:Dt,path:Wt,ancestors:Nt,descendants:Vt,leaves:Ht,links:Ut,copy:Xt};function Zt(e){if(typeof e!="function")throw new Error;return e}function U(){return 0}function X(e){return function(){return e}}function Qt(e){e.x0=Math.round(e.x0),e.y0=Math.round(e.y0),e.x1=Math.round(e.x1),e.y1=Math.round(e.y1)}function en(e,n,s,r,i){for(var o=e.children,l,c=-1,d=o.length,h=e.value&&(r-n)/e.value;++c<d;)l=o[c],l.y0=s,l.y1=i,l.x0=n,l.x1=n+=l.value*h}function tn(e,n,s,r,i){for(var o=e.children,l,c=-1,d=o.length,h=e.value&&(i-s)/e.value;++c<d;)l=o[c],l.x0=n,l.x1=r,l.y0=s,l.y1=s+=l.value*h}var nn=(1+Math.sqrt(5))/2;function rn(e,n,s,r,i,o){for(var l=[],c=n.children,d,h,u=0,g=0,a=c.length,p,m,f=n.value,x,_,b,M,C,T,F;u<a;){p=i-s,m=o-r;do x=c[g++].value;while(!x&&g<a);for(_=b=x,T=Math.max(m/p,p/m)/(f*e),F=x*x*T,C=Math.max(b/F,F/_);g<a;++g){if(x+=h=c[g].value,h<_&&(_=h),h>b&&(b=h),F=x*x*T,M=Math.max(b/F,F/_),M>C){x-=h;break}C=M}l.push(d={value:x,dice:p<m,children:c.slice(u,g)}),d.dice?en(d,s,r,i,f?r+=m*x/f:o):tn(d,s,r,f?s+=p*x/f:i,o),f-=x,u=g}return l}const Ce=function e(n){function s(r,i,o,l,c){rn(n,r,i,o,l,c)}return s.ratio=function(r){return e((r=+r)>1?r:1)},s}(nn);function sn(){var e=Ce,n=!1,s=1,r=1,i=[0],o=U,l=U,c=U,d=U,h=U;function u(a){return a.x0=a.y0=0,a.x1=s,a.y1=r,a.eachBefore(g),i=[0],n&&a.eachBefore(Qt),a}function g(a){var p=i[a.depth],m=a.x0+p,f=a.y0+p,x=a.x1-p,_=a.y1-p;x<m&&(m=x=(m+x)/2),_<f&&(f=_=(f+_)/2),a.x0=m,a.y0=f,a.x1=x,a.y1=_,a.children&&(p=i[a.depth+1]=o(a)/2,m+=h(a)-p,f+=l(a)-p,x-=c(a)-p,_-=d(a)-p,x<m&&(m=x=(m+x)/2),_<f&&(f=_=(f+_)/2),e(a,m,f,x,_))}return u.round=function(a){return arguments.length?(n=!!a,u):n},u.size=function(a){return arguments.length?(s=+a[0],r=+a[1],u):[s,r]},u.tile=function(a){return arguments.length?(e=Zt(a),u):e},u.padding=function(a){return arguments.length?u.paddingInner(a).paddingOuter(a):u.paddingInner()},u.paddingInner=function(a){return arguments.length?(o=typeof a=="function"?a:X(+a),u):o},u.paddingOuter=function(a){return arguments.length?u.paddingTop(a).paddingRight(a).paddingBottom(a).paddingLeft(a):u.paddingTop()},u.paddingTop=function(a){return arguments.length?(l=typeof a=="function"?a:X(+a),u):l},u.paddingRight=function(a){return arguments.length?(c=typeof a=="function"?a:X(+a),u):c},u.paddingBottom=function(a){return arguments.length?(d=typeof a=="function"?a:X(+a),u):d},u.paddingLeft=function(a){return arguments.length?(h=typeof a=="function"?a:X(+a),u):h},u}function Te(e){var n=e.node,s=n.x0,r=n.x1,i=n.y0,o=n.y1;return A.createElement("rect",{x:s,y:i,width:Math.abs(r-s),height:Math.abs(o-i),fill:"#21D4FD"})}Te.propTypes={node:j.shape({x0:j.number.isRequired,x1:j.number.isRequired,y0:j.number.isRequired,y1:j.number.isRequired}).isRequired};function P(e,n){e(n)}function Ee(e){var n=e.top,s=e.left,r=e.className,i=e.root,o=e.tile,l=e.size,c=e.round,d=e.padding,h=e.paddingInner,u=e.paddingOuter,g=e.paddingTop,a=e.paddingRight,p=e.paddingBottom,m=e.paddingLeft,f=e.children,x=e.nodeComponent,_=x===void 0?Te:x,b=sn();o&&b.tile(o),l&&b.size(l),c&&b.round(c),d&&P(b.padding,d),h&&P(b.paddingInner,h),u&&P(b.paddingOuter,u),g&&P(b.paddingTop,g),a&&P(b.paddingRight,a),p&&P(b.paddingBottom,p),m&&P(b.paddingLeft,m);var M=b(i);return f?A.createElement(A.Fragment,null,f(M)):A.createElement(H,{top:n,left:s,className:ye("visx-treemap",r)},_&&M.descendants().map(function(C,T){return A.createElement(H,{key:"treemap-node-"+T},A.createElement(_,{node:C}))}))}Ee.propTypes={children:j.func,top:j.number,left:j.number,className:j.string,round:j.bool,padding:j.oneOfType([j.number,j.func]),paddingInner:j.oneOfType([j.number,j.func]),paddingOuter:j.oneOfType([j.number,j.func]),paddingTop:j.oneOfType([j.number,j.func]),paddingRight:j.oneOfType([j.number,j.func]),paddingBottom:j.oneOfType([j.number,j.func]),paddingLeft:j.oneOfType([j.number,j.func])};const Fe=["#00F0FF","#00B5FF","#5BFFFF","#00FFD1","#0EEAD5","#D9F8FF"];function ke({networkTraffic:e,label:n,includeAll:s=!1}){const r=$(Qe),i=v.useMemo(()=>{var g,a;if(!e.peer_throughput)return;const l=.7;let c=0,d=0;const h=[];for(;d<e.peer_throughput.length&&c*l<(e.total_throughput??0);){const p=((g=e.peer_names)==null?void 0:g[d])||((a=e.peer_identities)==null?void 0:a[d])||"",m=Fe[Math.trunc(Math.random()*Fe.length)];h.push({id:p,value:e.peer_throughput[d],color:m}),c+=e.peer_throughput[d],d++}let u=0;for(d;d<e.peer_throughput.length;d++)u+=e.peer_throughput[d];return h.push({id:"rest",value:s?(e.total_throughput??0)-c:u,color:"#1CE7C2"}),{id:"peers",children:h,color:void 0}},[s,e]),o=v.useCallback(l=>{var a,p,m;const c=r[l];if(!c)return;const d=N.sum(c.vote.map(f=>f.delinquent?0:Number(f.activated_stake))),h=d?`${ue(d)} SOL`:void 0,u=((a=c.info)==null?void 0:a.icon_url)||((p=c.info)!=null&&p.keybase_username?`https://keybase.io/${c.info.keybase_username}/picture`:void 0)||void 0,g=((m=c.info)==null?void 0:m.name)??void 0;return{stake:h,iconUrl:u,name:g}},[r]);if(i)return t.jsxs(y,{direction:"column",minHeight:"300px",children:[t.jsxs(y,{justify:"between",children:[t.jsx(E,{size:"4",children:n}),t.jsxs("span",{children:[t.jsx(E,{size:"4",style:{color:"var(--gray-11)"},children:"Total:"}),t.jsxs(E,{size:"4",children:["\xA0",W(e.total_throughput).toString(),"\xA0/s"]})]})]}),t.jsx(J,{children:({height:l,width:c})=>t.jsx(on,{data:i,width:c,height:l,getPeerValues:o})})]})}const I=(()=>{let e=null,n=null;return(s,r)=>(e||(e=document.createElement("canvas")),n||(n=e.getContext("2d")),n?(n.font=r,n.measureText(s).width):s.length*7)})();function Le(e,n,s){if(I(e,n)<=s)return e;const r="\u2026";if(I(r,n)>s)return"";let i=0,o=e.length;for(;i<o;){const l=Math.ceil((i+o)/2),c=e.slice(0,l)+r;I(c,n)<=s?i=l:o=l-1}return e.slice(0,i)+r}const $e=55,an=40,ze=8,ln=2;function on({data:e,width:n,height:s,colors:r,getPeerValues:i}){const o=v.useMemo(()=>e.children.reduce((h,u)=>h+(u.value||0),0),[e]),l=v.useMemo(()=>fe({name:e.id,children:e.children.map(h=>({name:h.id,value:h.value}))}).sum(h=>h.value||0).sort((h,u)=>(u.value||0)-(h.value||0)),[e]),c=v.useMemo(()=>{const h=r??["#48295C","#562800","#132D21","#331E0B","#0D2847","#292929"];return et().domain(e.children.map(u=>u.id)).range(h)},[e,r]),d=v.useMemo(()=>Ce.ratio(1.1),[]);return t.jsx("svg",{width:n,height:s,children:t.jsx(Ee,{root:l,size:[n,s],tile:d,round:!0,paddingInner:2,children:h=>t.jsx(H,{children:h.leaves().map(u=>{const g=u.x0,a=u.y0,p=u.x1-u.x0,m=u.y1-u.y0,f=String(u.data.name),x=o>0?100*(u.value||0)/o:0,_=i(f),b=`${Math.max(11,Math.min(16,Math.floor(p/14)))}px Inter Tight`,M=Math.max(0,p-2*ze),C=Le((_==null?void 0:_.name)??f,b,M);I(C,b);const T=W(u.value??0);let F=`${T?`${T.toString()} `:""}(${x.toFixed(1)}%)`;return I(F,b)<M||(F=`${T.toString()}`),t.jsxs(H,{children:[t.jsx("rect",{x:g,y:a,width:p,height:m,rx:1,ry:1,fill:c(f)}),t.jsx(un,{leaf:u,total:o,getPeerValues:i})]},f)})})})})}function un({leaf:e,total:n,getPeerValues:s}){const r=e.x0,i=e.y0,o=e.x1-e.x0,l=e.y1-e.y0,c=String(e.data.name),d=n>0?100*(e.value||0)/n:0,h=o>=$e&&l>=an,u=l>30*2,g=Math.max(11,Math.min(14,Math.floor(o/12))),a=s(c),p=Math.max(11,Math.min(16,Math.floor(o/14))),m=`${p}px Inter Tight`,f=r+o/2,x=p+ln,_=i+l/3,b=2,M=p+4,C=Math.max(0,o-2*ze-(M?M+b:0)),T=Le((a==null?void 0:a.name)??c,m,C),F=I(T,m),Be=(M?M+b:0)+F,xe=f-Be/2,Y=_,ie=W(e.value??0);let ae=`${ie?`${ie.toString()} `:""}(${d.toFixed(1)}%)`;if(I(ae,m)<C||(ae=`${ie.toString()}`),!(o<$e))return t.jsxs(t.Fragment,{children:[a!=null&&a.iconUrl?t.jsxs(t.Fragment,{children:["(",t.jsx("image",{href:a.iconUrl,x:xe,y:Y,width:M,height:M,preserveAspectRatio:"xMidYMid meet",crossOrigin:"anonymous"}),t.jsx("text",{x:xe+M+b,y:Y,fontSize:g,alignmentBaseline:"text-before-edge",fontFamily:"Inter Tight",fontWeight:600,fill:"#CCCCCC",textAnchor:"start",pointerEvents:"none",children:T}),")"]}):t.jsx("text",{x:f,y:Y,fontSize:g,fontFamily:"Inter Tight",fontWeight:600,fill:"#CCCCCC",alignmentBaseline:"text-before-edge",textAnchor:"middle",pointerEvents:"none",children:T}),h&&t.jsx(t.Fragment,{children:t.jsxs("text",{x:f,y:Y+12,fontSize:g,fontFamily:"Inter Tight",fill:"#CCCCCC",pointerEvents:"none",alignmentBaseline:"text-before-edge",textAnchor:"middle",children:[t.jsx("tspan",{x:f,dy:x,fill:"#8A8A8A",children:ae}),u&&t.jsx("tspan",{x:f,dy:x,fill:"#8A8A8A",children:a==null?void 0:a.stake})]})})]})}function cn(){const e=$(tt),n=$(nt),[s]=rt(n,5e3,{maxWait:5e3}),r=n==null?void 0:n.health,i=n==null?void 0:n.storage,o=$(st)==="running"?"running":"startup";if(e==="Firedancer")return!r||!i||!s?null:t.jsxs(y,{gap:"6",direction:"column",align:"stretch",justify:"center",mx:"4",height:"100%",children:[t.jsxs(V,{columns:"repeat(auto-fit, minmax(min(100%, 600px), 1fr))",gapX:"6",gapY:"6",children:[t.jsx(ke,{networkTraffic:s.ingress,label:"Ingress Peers"}),t.jsx(ke,{networkTraffic:s.egress,label:"Egress Peers"}),t.jsx(ot,{storage:i}),t.jsx(mt,{}),t.jsx(lt,{storage:i}),t.jsx(ht,{messages:n.messages})]},o),t.jsx(vt,{health:r}),t.jsx(xt,{})]})}export{cn as default};
