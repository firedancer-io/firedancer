name: Ledgers
on:
  workflow_call:
  workflow_dispatch:
  pull_request:
jobs:
  Ledgers:
    runs-on: private
    env:
      CC: gcc
    strategy:
      matrix:
        test_case:
          - run-runtime-test-1
          - run-runtime-test-2
          - run-runtime-test-3
          - run-runtime-native
    steps:
      - uses: actions/checkout@v4
        with:
          lfs:        true
          submodules: recursive

      - uses: ./.github/actions/deps
      - uses: ./.github/actions/hugepages

      - name: build
        run: |
          . /opt/rh/gcc-toolset-12/enable
          ./contrib/make-j all

      - name: make ${{ matrix.test_case }}
        run: |
          sudo prlimit --pid $$ --memlock=-1:-1
          . /opt/rh/gcc-toolset-12/enable
          make ${{ matrix.test_case }}
